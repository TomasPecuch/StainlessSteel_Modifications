; SS 6.4 Late Era Campaign Script
; by gracul Jan-2011
; Edited for SS6.4 Bugfix Compilation
; by Melooo182 Sep-2014
;===================== CONTENTS =========================
;---- 1)AI STUFF & CAMP PREPARE
;---- Setup AI
;---- Is the AI?
;---- Byzantine Leader Battle Models
;---- G5 Looting Script Compact
;---- Ageing Script
;---- Church Titles
;---- Hanseatic System
;---- Faction Leader Global Traits
;---- AI Reinforcements
;---- Faction Economy Script (GSTHOED)
;---- 2)PLAYER PART
;---- Faction Killer Workaround
;---- Besiege Upkeep
;---- Setup Events
;---- City Reveal
;---- Major Events
;---- Teutonic Order Death Workaround (OBSOLETE)
;---- Player Notification
;---- Interactive Events
;---- 3)EMERGENT FACTIONS/NATIONAL UPRISINGS
;---- William Wallace Uprising
;---- Golden Horde Emergent
;---- Bulgarian Uprising
;---- Timurids Invasion
;---- 4)G5 BAI STUFF
;========================================================
;=============== AI STUFF & CAMP PREPARE ================
;========================================================
script
restrict_strat_radar false

;====================== Setup AI ========================
monitor_event PreFactionTurnStart FactionIsLocal
	and CampaignDifficulty = easy

	set_event_counter DifficultyLevel 1

	historic_event difficulty_easy

	link_faction_ai england default
	link_faction_ai france default
	link_faction_ai hre default
	link_faction_ai spain default
	link_faction_ai venice default
	link_faction_ai sicily default
	link_faction_ai milan default
	link_faction_ai scotland default
	link_faction_ai cumans default
	link_faction_ai byzantium default
	link_faction_ai russia default
	link_faction_ai moors default
	link_faction_ai turks default
	link_faction_ai egypt default
	link_faction_ai denmark default
	link_faction_ai portugal default
	link_faction_ai poland default
	link_faction_ai hungary default
	link_faction_ai lithuania default
	link_faction_ai kievan_rus default
	link_faction_ai aragon default
	link_faction_ai norway default
	link_faction_ai kwarezm default
	link_faction_ai papal_states papal_faction
	link_faction_ai mongols default
	link_faction_ai timurids default
	link_faction_ai teutonic_order default
	link_faction_ai jerusalem default
	link_faction_ai slave default

	if I_IsFactionAIControlled england
		increment_kings_purse england 700
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 600
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 500
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 500
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 700
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 700
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 400
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 400
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 600
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 600
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 500
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 500
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 600
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 600
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 700
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 600
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 600
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 600
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 500
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 600
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 500
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 600
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 300
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 700
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 500
	end_if

	if I_IsFactionAIControlled mongols
		increment_kings_purse mongols 600
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 700
	end_if

	increment_kings_purse papal_states 200
	increment_kings_purse slave 1500

	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
	and CampaignDifficulty = medium

	set_event_counter DifficultyLevel 2

	historic_event difficulty_medium

	link_faction_ai england catholic
	link_faction_ai france catholic
	link_faction_ai hre catholic
	link_faction_ai spain catholic
	link_faction_ai venice catholic
	link_faction_ai sicily catholic
	link_faction_ai milan catholic
	link_faction_ai scotland catholic
	link_faction_ai cumans pagan
	link_faction_ai byzantium default
	link_faction_ai russia default
	link_faction_ai moors islam
	link_faction_ai turks islam
	link_faction_ai egypt islam
	link_faction_ai denmark catholic
	link_faction_ai portugal catholic
	link_faction_ai poland catholic
	link_faction_ai hungary catholic
	link_faction_ai lithuania pagan
	link_faction_ai kievan_rus default
	link_faction_ai aragon catholic
	link_faction_ai norway catholic
	link_faction_ai kwarezm islam
	link_faction_ai papal_states papal_faction
	link_faction_ai mongols mongols_faction
	link_faction_ai timurids islam
	link_faction_ai teutonic_order catholic
	link_faction_ai jerusalem catholic
	link_faction_ai slave slave_faction

	if I_IsFactionAIControlled england
		increment_kings_purse england 800
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 700
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 600
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 600
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 800
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 800
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 600
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 500
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 700
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 700
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 600
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 600
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 600
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 600
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 800
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 700
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 800
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 700
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 600
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 700
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 600
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 800
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 400
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 800
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 600
	end_if

	if I_IsFactionAIControlled mongols
		increment_kings_purse mongols 1000
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 800
	end_if

	increment_kings_purse papal_states 300
	increment_kings_purse slave 2700

	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
	and CampaignDifficulty = hard

	set_event_counter DifficultyLevel 3

	historic_event difficulty_hard

	link_faction_ai england catholic
	link_faction_ai france catholic
	link_faction_ai hre catholic
	link_faction_ai spain catholic
	link_faction_ai venice catholic
	link_faction_ai sicily catholic
	link_faction_ai milan catholic
	link_faction_ai scotland catholic
	link_faction_ai cumans pagan
	link_faction_ai byzantium byzantium_faction
	link_faction_ai russia default
	link_faction_ai moors islam
	link_faction_ai turks islam
	link_faction_ai egypt islam
	link_faction_ai denmark catholic
	link_faction_ai portugal catholic
	link_faction_ai poland catholic
	link_faction_ai hungary catholic
	link_faction_ai lithuania pagan
	link_faction_ai kievan_rus default
	link_faction_ai aragon catholic
	link_faction_ai norway catholic
	link_faction_ai kwarezm islam
	link_faction_ai papal_states papal_faction
	link_faction_ai mongols mongols_faction
	link_faction_ai timurids islam
	link_faction_ai teutonic_order catholic
	link_faction_ai jerusalem catholic
	link_faction_ai slave slave_faction

	if I_IsFactionAIControlled england
		increment_kings_purse england 1300
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 1200
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 1100
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 1100
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 1300
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 1300
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 1100
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 1000
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 1200
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 1200
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 1100
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 1100
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 1100
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 1100
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 1200
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 1200
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 1300
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 1200
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 1100
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 1200
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 1100
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 1300
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 900
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 1300
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 1100
	end_if

	if I_IsFactionAIControlled mongols
		increment_kings_purse mongols 1900
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 1300
	end_if

	increment_kings_purse papal_states 400
	increment_kings_purse slave 2000

	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
	and CampaignDifficulty = very_hard

	set_event_counter DifficultyLevel 4

	historic_event difficulty_very_hard

	link_faction_ai england catholic
	link_faction_ai france catholic
	link_faction_ai hre catholic
	link_faction_ai spain catholic
	link_faction_ai venice catholic
	link_faction_ai sicily catholic
	link_faction_ai milan catholic
	link_faction_ai scotland catholic
	link_faction_ai cumans pagan
	link_faction_ai byzantium byzantium_faction
	link_faction_ai russia default
	link_faction_ai moors islam
	link_faction_ai turks islam
	link_faction_ai egypt islam
	link_faction_ai denmark catholic
	link_faction_ai portugal catholic
	link_faction_ai poland catholic
	link_faction_ai hungary catholic
	link_faction_ai lithuania pagan
	link_faction_ai kievan_rus default
	link_faction_ai aragon catholic
	link_faction_ai norway catholic
	link_faction_ai kwarezm islam
	link_faction_ai papal_states papal_faction
	link_faction_ai mongols mongols_faction
	link_faction_ai timurids islam
	link_faction_ai teutonic_order catholic
	link_faction_ai jerusalem catholic
	link_faction_ai slave slave_faction

	if I_IsFactionAIControlled england
		increment_kings_purse england 2000
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 1900
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 1800
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 1800
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 2000
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 2000
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 1800
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 1700
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 1900
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 1900
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 1800
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 1800
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 1800
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 1800
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 1900
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 1900
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 2000
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 1900
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 1800
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 1900
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 1800
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 1900
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 1450
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 1800
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 1800
	end_if

	if I_IsFactionAIControlled mongols
		increment_kings_purse mongols 3000
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 1800
	end_if

	increment_kings_purse papal_states 400
	increment_kings_purse slave 3500

	terminate_monitor
end_monitor

;===================== Is the AI? =======================
;----- counter used in Identifying Faction's Turn ---------
declare_counter turn_fid ; 1=egypt, 2=turks etc
;----- campaign year script counters ---------
declare_counter spawncount
set_counter spawncount 0
declare_counter campaign_year
set_counter campaign_year 1220; Late Era
declare_counter campaign_year_set
set_counter campaign_year_set -1

;Used Both in AI and Player Turns
monitor_event PreFactionTurnStart TrueCondition
	set_event_counter freeze_recr_pool 0
	set_event_counter citadel_boost 0

;*** campaign_year script ***
	if I_CompareCounter turn_fid = 0
		inc_counter campaign_year_set 1
		;Adjust value for turn times, 1=1TPY, 2=2TPY, etc;
		if I_CompareCounter campaign_year_set = 1
		;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
			inc_counter campaign_year 1
			set_counter campaign_year_set 0
		end_if
	end_if
;*** end of campaign_year script ***

	;slave faction's turn and new turn starting
	set_counter turn_fid 0
	
	; used in Faction Killer Workaround
	set_event_counter killed_factions_count 0
end_monitor

;Used For Player Turns Only
monitor_event PreFactionTurnStart not IsFactionAIControlled
	set_event_counter is_the_ai 0
end_monitor

;Used For AI Turns Only
monitor_event PreFactionTurnStart IsFactionAIControlled
	set_event_counter is_the_ai 1
end_monitor

;*** Determine which faction's turn were on ***
; it's egypt 's turn
monitor_event PreFactionTurnStart FactionType egypt
	set_counter turn_fid 1
end_monitor

; it's turks 's turn
monitor_event PreFactionTurnStart FactionType turks
	set_counter turn_fid 2
end_monitor

; it's timurids 's turn
monitor_event PreFactionTurnStart FactionType timurids
	set_counter turn_fid 3
end_monitor

; it's kwarezm 's turn
monitor_event PreFactionTurnStart FactionType kwarezm
	set_counter turn_fid 4
end_monitor

; it's moors 's turn
monitor_event PreFactionTurnStart FactionType moors
	set_counter turn_fid 5
end_monitor

; it's lithuania 's turn
monitor_event PreFactionTurnStart FactionType lithuania
	set_counter turn_fid 6
end_monitor

; it's cumans 's turn
monitor_event PreFactionTurnStart FactionType cumans
	set_counter turn_fid 7
end_monitor

; it's mongols 's turn
monitor_event PreFactionTurnStart FactionType mongols
	set_counter turn_fid 8
end_monitor

; it's byzantium 's turn
monitor_event PreFactionTurnStart FactionType byzantium
	set_counter turn_fid 9
end_monitor

; it's russia 's turn
monitor_event PreFactionTurnStart FactionType russia
	set_counter turn_fid 10
end_monitor

; it's kievan_rus 's turn
monitor_event PreFactionTurnStart FactionType kievan_rus
	set_counter turn_fid 11
end_monitor

; it's venice 's turn
monitor_event PreFactionTurnStart FactionType venice
	set_counter turn_fid 12
end_monitor

; it's sicily 's turn
monitor_event PreFactionTurnStart FactionType sicily
	set_counter turn_fid 13
end_monitor

; it's milan 's turn
monitor_event PreFactionTurnStart FactionType milan
	set_counter turn_fid 14
end_monitor

; it's denmark 's turn
monitor_event PreFactionTurnStart FactionType denmark
	set_counter turn_fid 15
end_monitor

; it's scotland 's turn
monitor_event PreFactionTurnStart FactionType scotland
	set_counter turn_fid 16
end_monitor

; it's france 's turn
monitor_event PreFactionTurnStart FactionType france
	set_counter turn_fid 17
end_monitor

; it's hre 's turn
monitor_event PreFactionTurnStart FactionType hre
	set_counter turn_fid 18
end_monitor

; it's england 's turn
monitor_event PreFactionTurnStart FactionType england
	set_counter turn_fid 19
end_monitor

; it's portugal 's turn
monitor_event PreFactionTurnStart FactionType portugal
	set_counter turn_fid 20
end_monitor

; it's poland 's turn
monitor_event PreFactionTurnStart FactionType poland
	set_counter turn_fid 21
end_monitor

; it's spain 's turn
monitor_event PreFactionTurnStart FactionType spain
	set_counter turn_fid 22
end_monitor

; it's hungary 's turn
monitor_event PreFactionTurnStart FactionType hungary
	set_counter turn_fid 23
end_monitor

; it's aragon 's turn
monitor_event PreFactionTurnStart FactionType aragon
	set_counter turn_fid 24
end_monitor

; it's teutonic_order 's turn
monitor_event PreFactionTurnStart FactionType teutonic_order
	set_counter turn_fid 25
end_monitor

; it's norway 's turn
monitor_event PreFactionTurnStart FactionType norway
	set_counter turn_fid 26
end_monitor

; it's jerusalem 's turn
monitor_event PreFactionTurnStart FactionType jerusalem
	set_counter turn_fid 27
end_monitor

; it's papal_states 's turn
monitor_event PreFactionTurnStart FactionType papal_states
	set_counter turn_fid 28
end_monitor

;--- AI Citadel check
monitor_event PreFactionTurnStart IsFactionAIControlled
	and not FactionBuildingExists = citadel
	and I_TurnNumber > 60
	;and I_CompareCounter campaign_year > 1280

	set_event_counter citadel_boost 1
end_monitor

;========== BYZANTINE LEADER BATTLE MODELS ==============
monitor_event BecomesFactionLeader FactionType byzantium
	change_battle_model byzantium leader byzantine_emperor
end_monitor

monitor_event BecomesFactionHeir FactionType byzantium
	change_battle_model byzantium heir byzantine_heir
end_monitor

;============ G5 LOOTING SCRIPT COMPACT =================
declare_counter small_army
declare_counter medium_army
declare_counter large_army
declare_counter battle_no
set_counter small_army 0
set_counter medium_army 0
set_counter large_army 0
set_counter battle_no 0

monitor_event BattleConflictPhaseCommenced FactionIsLocal

	if I_BattleEnemyArmyNumberOfUnits < 9
	and I_BattleEnemyArmyNumberOfUnits > 2
		set_counter small_army 1
	end_if

	if I_BattleEnemyArmyNumberOfUnits > 8
	and I_BattleEnemyArmyNumberOfUnits < 15
		set_counter medium_army 1
	end_if

	if I_BattleEnemyArmyNumberOfUnits > 14
		set_counter large_army 1
	end_if

	set_counter battle_no 1
end_monitor

monitor_event PostBattle FactionIsLocal
	and WonBattle
	and not I_ConflictType Naval
	and I_CompareCounter battle_no = 1

	if I_CompareCounter small_army = 1
	and RandomPercent > 25
		console_command add_money 50
	end_if

	if I_CompareCounter medium_army = 1
	and RandomPercent > 25
		console_command add_money 100
	end_if

	if I_CompareCounter large_army = 1
	and RandomPercent > 25
		console_command add_money 200
	end_if

;		historic_event sack_ai

	set_counter battle_no 0
end_monitor

monitor_event PostBattle FactionIsLocal
	and not WonBattle
	and not I_ConflictType Naval
	and I_CompareCounter battle_no = 1

	if RandomPercent > 90
		console_command add_money -100
	end_if

	if RandomPercent > 55
		console_command add_money -100
	end_if

	console_command add_money -100

;	historic_event sack_player

	set_counter battle_no 0
end_monitor

;=================== AGEING SCRIPT ======================
declare_counter season
declare_counter turn
set_counter turn 0

monitor_event FactionTurnEnd FactionType slave
	console_command season winter
	set_counter turn 1
end_monitor

monitor_event PreFactionTurnStart I_CompareCounter turn = 1

	inc_counter season 1
	if I_CompareCounter season = 1
		console_command season summer
	end_if

	if I_CompareCounter season = 2
		console_command season winter
		set_counter season 0
	end_if

	set_counter turn 0

end_monitor

;=================== CHURCH TITLES ======================
declare_counter bishop_count
declare_counter holiness_count

monitor_event PreFactionTurnStart TrueCondition
	and not FactionReligion pagan
	and not FactionReligion islam

	set_counter bishop_count 0
	set_counter holiness_count 0
	set_event_counter Patriarch 0
	set_event_counter AppointBishop 0
	set_event_counter StripBishop 0
	set_event_counter Antipope 1
end_monitor

;if you don't have a 5 piety priest when exocommed you won't get an antipope at all!
;can do a monitor_event PreFactionTurnStart FactionExcommunicated check, but let's leave it like this, since it seems more 'real'
monitor_event FactionExcommunicated TrueCondition
	and not FactionType venice
	and not FactionType sicily
	and not FactionType milan
	and not FactionType denmark
	and not FactionType scotland
;	and not FactionType france
;	and not FactionType hre
	and not FactionType england
	and not FactionType portugal
	and not FactionType poland
	and not FactionType teutonic_order
	and not FactionType spain
	and not FactionType hungary
	and not FactionType aragon
	and not FactionType norway
	and not FactionType jerusalem

	set_event_counter Antipope 0
end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and Trait PriestLevel = 4
	and FactionExcommunicated
	and FactionReligion catholic

	set_event_counter Antipope 1

end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and Attribute Piety > 4
	and FactionReligion catholic

	if I_CompareCounter holiness_count = 1
		set_event_counter Antipope 1
	end_if

	inc_counter holiness_count 1

end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and Trait PriestLevel = 3
	and FactionReligion orthodox

	set_event_counter Patriarch 1

end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and Attribute Piety > 4
	and FactionReligion orthodox

	if I_CompareCounter holiness_count = 1
		set_event_counter Patriarch 1
	end_if

	inc_counter holiness_count 1

end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and not FactionReligion pagan
	and not FactionReligion islam
	and Trait PriestLevel = 1

	inc_counter bishop_count 1
end_monitor

monitor_event SettlementTurnStart TrueCondition
	and not FactionReligion pagan
	and not FactionReligion islam

	inc_counter bishop_count -1
end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and not CharacterReligion pagan
	and not CharacterReligion islam
	and Trait PriestLevel = 0

	if I_CompareCounter bishop_count = 0
		set_event_counter AppointBishop 0
	end_if

	if I_CompareCounter bishop_count < 0
		set_event_counter AppointBishop 1
		inc_counter bishop_count 1
	end_if
end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and not CharacterReligion pagan
	and not CharacterReligion islam
	and Trait PriestLevel = 1

	if I_CompareCounter bishop_count = 0
		set_event_counter StripBishop 0
	end_if

	if I_CompareCounter bishop_count > 0
		set_event_counter StripBishop 1
		inc_counter bishop_count -1
	end_if
end_monitor

;================== HANSEATIC SYSTEM ====================
monitor_event PreFactionTurnStart TrueCondition
	set_event_counter hanseatic_count -1
end_monitor

monitor_event CharacterTurnStart GovernorPlugInExists = hansa
	and I_EventCounter hanseatic_league = 1

	inc_event_counter hanseatic_count 1
end_monitor

monitor_event CharacterTurnStart GovernorPlugInExists = c_hansa
	and I_EventCounter hanseatic_league = 1

	inc_event_counter hanseatic_count 1
end_monitor

set_event_counter hanseatic_constructed 0

monitor_event GuildUpgraded BuildingName = hanseatic_guild
	set_event_counter hanseatic_constructed 1
	reset_guild_standing hanseatic_guild
end_monitor

monitor_event BuildingDestroyed BuildingName = hanseatic_guild
	set_event_counter hanseatic_constructed 0
	reset_guild_standing hanseatic_guild
end_monitor

;=========== FACTION LEADER GLOBAL TRAITS ===============
monitor_event PreFactionTurnStart TrueCondition

	set_event_counter thinks_of_his_people 0
	set_event_counter wise_administrator 0
	set_event_counter strictly_religious 0
	set_event_counter protector 0
	set_event_counter merchant_skills 0
	set_event_counter greedy_ruler 0
	set_event_counter shady_connections 0

end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait ThinksOfHisPeople > 0
	set_event_counter thinks_of_his_people 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait WiseAdministrator > 0
	set_event_counter wise_administrator 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait StrictlyReligious > 0
	and not FactionReligion pagan
	set_event_counter strictly_religious 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait Protector > 0
	set_event_counter protector 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait MerchantSkills > 0
	set_event_counter merchant_skills 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait GreedyRuler > 0
	set_event_counter greedy_ruler 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait ShadyConnections > 0
	set_event_counter shady_connections 1
end_monitor

;============= AI Reinforcements =================
;---- Contents
;- Genoese and Seljuk Reinforcement if Player is Byzantium
;- Constantinople JIHAD garrison script
;- Startup Reinforcements
;-Main AI reinforcements
;-- Merchant&Priest&Ship Support Spawn
;-- Turn 10 Reinforcement
;-No Heir Reinforcement

;---- Genoese and Seljuk Reinforcement if Player is Byzantium
if not I_IsFactionAIControlled byzantium
	if I_IsFactionAIControlled milan
		spawn_army 
			faction milan
			character	Francesco, general, age 28, x 329, y 170
			unit		Feudal Knights				exp 2 armour 0 weapon_lvl 0
			unit		Armored Sergeants				exp 1 armour 1 weapon_lvl 0
			unit		Armored Sergeants				exp 0 armour 1 weapon_lvl 0
			unit		Urban Crossbow Militia				exp 2 armour 2 weapon_lvl 0
			unit		Urban Crossbow Militia				exp 2 armour 2 weapon_lvl 0
			unit		Urban Crossbow Militia				exp 2 armour 2 weapon_lvl 0
			unit		Urban Crossbow Militia				exp 1 armour 2 weapon_lvl 0
			unit		Feudal Knights				exp 2 armour 0 weapon_lvl 0
			unit		Feudal Knights				exp 2 armour 0 weapon_lvl 0
			unit		Dismounted Feudal Knights				exp 2 armour 0 weapon_lvl 0
		end
		add_money milan, 8000
	end_if
	if I_IsFactionAIControlled turks
		spawn_army 
			faction turks
			character	Kasim, general, age 28, x 293, y 135
			unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
			unit		Turkish Archers				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		Turkomans				exp 1 armour 0 weapon_lvl 0
			unit		Turkish Archers				exp 0 armour 0 weapon_lvl 0
			unit		Turkish Archers				exp 0 armour 0 weapon_lvl 0
			unit		Turkish Archers				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		ME Spear Militia				exp 0 armour 0 weapon_lvl 0
			unit		Turkomans				exp 1 armour 0 weapon_lvl 0
			unit		Turkomans				exp 1 armour 0 weapon_lvl 0
		end
		add_money turks, 8000
	end_if
end_if

;---- Constantinople JIHAD garrison script
declare_counter constantinople_siege_by_jihadists
monitor_event SettlementTurnStart IsJihadTarget
	and SettlementName Constantinople
	and I_SettlementOwner Constantinople = byzantium

	if not I_HotseatEnabled
	and I_LocalFaction byzantium
		terminate_monitor
	end_if

	if I_IsFactionAIControlled byzantium
		if not I_SettlementUnderSiege Constantinople
			set_counter constantinople_siege_by_jihadists 0
		end_if
		if I_SettlementUnderSiege Constantinople
		and I_CompareCounter constantinople_siege_by_jihadists = 0
			console_command create_unit Constantinople "Contaratoi" 3 0 0 0
			console_command create_unit Constantinople "Toxotae" 4 0 1 0
			set_counter constantinople_siege_by_jihadists 1
		end_if
	end_if
end_monitor

;------------------------ Startup Reinforcements ------------------------
monitor_event FactionTurnStart FactionIsLocal
if I_EventCounter DifficultyLevel <= 2
	if I_IsFactionAIControlled england
		spawn_army
		faction england
		character	David Plantagenet, named character, age 20, x 83, y 220, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled france
		spawn_army 
		faction france
		character	Amaury Capet, named character, age 20, x 92, y 202, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hre
		spawn_army
		faction hre
		character	Arnoldt von_Hohenstaufen, named character, age 20, x 143, y 207, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled spain
		spawn_army
		faction spain
		character	Enrique de_Castilla, named character, age 20, x 32, y 148, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Spanish 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled venice
		spawn_army
		faction venice
		character	Barbus Ziani, named character, age 20, x 161, y 173, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Venetian 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled sicily
		spawn_army
		faction sicily
		character	Ettore d_Altavilla, named character, age 20, x 177, y 114, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled milan
		spawn_army
		faction milan
		character	Azolino Buvalelli, named character, age 20, x 137, y 168, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Milanese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled scotland
		spawn_army
		faction scotland
		character	Comgell mac_Donnchada, named character, age 20, x 53, y 253, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Scottish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled cumans
		spawn_army
		faction cumans
		character	Balamir of_the_Tatar, named character, age 20, x 440, y 250, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Cumans 1 , BiologicalSon 1
		unit	Cuman Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled byzantium
		spawn_army
		faction byzantium
		character	Areovindos Laskaris, named character, age 20, x 278, y 148, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Greek 1 , BiologicalSon 1
		unit	Greek Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled russia
		spawn_army
		faction russia
		character	Domazhir Novgorodskii, named character, age 20, x 301, y 275, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Russian 1 , BiologicalSon 1
		unit	EE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled poland
		spawn_army
		faction poland
		character	Dobromir Piast, named character, age 20, x 222, y 213, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Polish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled moors
		spawn_army
		faction moors
		character	Ayyub al_Andalusi, named character, age 20, x 40, y 113, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Moorish 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled turks
		spawn_army
		faction turks
		character	Bahadir al-Din, named character, age 20, x 339, y 133, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Turkish 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled egypt
		spawn_army
		faction egypt
		character	Abdul-Malik Al_Ayyubi, named character, age 20, x 309, y 60, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Egyptian 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled denmark
		spawn_army
		faction denmark
		character	Birger Vermundsen, named character, age 20, x 146, y 253, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Danish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled portugal
		spawn_army
		faction portugal
		character	Claudio de_Portugal, named character, age 20, x 17, y 123, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Portuguese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hungary
		spawn_army
		faction hungary
		character	Bod Arpadhazi, named character, age 20, x 206, y 179, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Hungarian 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled jerusalem
		spawn_army 
		faction jerusalem
		character	Bouchard de_Brienne, named character, age 20, x 329, y 78, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Jerusalem 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled lithuania
		spawn_army
		faction lithuania
		character	Kestutis, named character, age 20, x 262, y 240, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Lithuanian 1 , BiologicalSon 1
		unit	Lith Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kievan_rus
		spawn_army
		faction kievan_rus
		character	Dobroslav Yaroslavich, named character, age 20, x 292, y 214, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kievan 1 , BiologicalSon 1
		unit	EE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled aragon
		spawn_army
		faction aragon
		character	Alvar Ramirez, named character, age 20, x 83, y 150, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Aragonese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled norway
		spawn_army
		faction norway
		character	Erik Haakonsson, named character, age 20, x 114, y 280, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Norwegian 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kwarezm
		spawn_army
		faction kwarezm
		character	Batu Khwarezmshah, named character, age 20, x 449, y 93, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kwarezm 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled teutonic_order
		spawn_army 
		faction teutonic_order
		character	random_name, named character, age 20, x 232, y 237, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
		unit	TO Bodyguard	exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled mongols
		spawn_army 
		faction mongols
		character	Bavdai Khan, named character, age 20, x 502, y 160, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
		unit	Keshikten Bodyguard	exp 2 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 3 armour 0 weapon_lvl 0
		end
	end_if
end_if
if I_EventCounter DifficultyLevel >= 3
	if I_IsFactionAIControlled england
		spawn_army
		faction england
		character	David Plantagenet, named character, age 30, x 78, y 218, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Norman Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Fyrd Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Norman Serjeants	exp 1 armour 0 weapon_lvl 0
		unit	Norman Serjeants	exp 0 armour 0 weapon_lvl 0
		unit	Norman Serjeants	exp 0 armour 0 weapon_lvl 0
		unit	Longbowmen	exp 2 armour 0 weapon_lvl 0
		unit	Longbowmen	exp 1 armour 0 weapon_lvl 0
		unit	Longbowmen	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled france
		spawn_army
		faction france
		character	Amaury Capet, named character, age 30, x 94, y 199, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Mailed Knights	exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 0 armour 0 weapon_lvl 0
		unit	Light Men at Arms	exp 0 armour 0 weapon_lvl 0
		unit	Light Men at Arms	exp 0 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 2 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hre
		spawn_army
		faction hre
		character	Arnoldt von_Hohenstaufen, named character, age 30, x 156, y 201, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Mailed Knights	exp 1 armour 0 weapon_lvl 0
		unit	Light Swordsmen	exp 2 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 1 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 0 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 1 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 1 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled spain
		spawn_army
		faction spain
		character	Enrique de_Castilla, named character, age 30, x 38, y 152, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Spanish 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Jinetes	exp 1 armour 0 weapon_lvl 0
		unit	Jinetes	exp 1 armour 0 weapon_lvl 0
		unit	Light Swordsmen	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	Swordsmen Militia	exp 1 armour 0 weapon_lvl 0
		unit	Swordsmen Militia	exp 0 armour 0 weapon_lvl 0
		unit	Peasant Archers	exp 2 armour 0 weapon_lvl 0
		unit	Peasant Archers	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled venice
		spawn_army
		faction venice
		character	Barbus Ziani, named character, age 30, x 165, y 173, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Venetian 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Italian Cavalry Militia	exp 1 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 0 armour 0 weapon_lvl 0
		unit	Armored Sergeants	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 2 armour 2 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 1 armour 2 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 1 armour 2 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled sicily
		spawn_army
		faction sicily
		character	Ettore d_Altavilla, named character, age 30, x 170, y 117, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Norman Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Sicilian Muslim Archers	exp 1 armour 0 weapon_lvl 0
		unit	Sicilian Muslim Archers	exp 0 armour 0 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 1 armour 2 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 0 armour 2 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled milan
		spawn_army
		faction milan
		character	Azolino Buvalelli, named character, age 30, x 139, y 168, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Milanese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Italian Cavalry Militia	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Sergeant Spearmen	exp 2 armour 0 weapon_lvl 0
		unit	Sergeant Spearmen	exp 1 armour 0 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 0 armour 2 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 0 armour 2 weapon_lvl 0
		unit	Urban Crossbow Militia	exp 0 armour 2 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled scotland
		spawn_army
		faction scotland
		character	Comgell mac_Donnchada, named character, age 30, x 62, y 247, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Scottish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Border Horse	exp 1 armour 0 weapon_lvl 0
		unit	Highlanders	exp 1 armour 0 weapon_lvl 0
		unit	Highlanders	exp 0 armour 0 weapon_lvl 0
		unit	Highland Nobles	exp 1 armour 0 weapon_lvl 0
		unit	Scots Pike Militia	exp 1 armour 0 weapon_lvl 0
		unit	Scots Pike Militia	exp 2 armour 0 weapon_lvl 0
		unit	Scots Pike Militia	exp 2 armour 0 weapon_lvl 0
		unit	Highland Archers	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled cumans
		spawn_army
		faction cumans
		character	Balamir of_the_Tatar, named character, age 30, x 431, y 250, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Cumans 1 , BiologicalSon 1
		unit	Cuman Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Yasi Archers	exp 1 armour 0 weapon_lvl 0
		unit	Cuman Horse Militia	exp 2 armour 0 weapon_lvl 0
		unit	Cuman Horse Militia	exp 1 armour 0 weapon_lvl 0
		unit	Cuman Horse Militia	exp 1 armour 0 weapon_lvl 0
		unit	Kasogi Senior Militia	exp 0 armour 0 weapon_lvl 0
		unit	Kasogi Senior Militia	exp 0 armour 0 weapon_lvl 0
		unit	Steppe Alans	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled byzantium
		spawn_army
		faction byzantium
		character	Areovindos Laskaris, named character, age 30, x 282, y 143, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Greek 1 , BiologicalSon 1
		unit	Greek Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Stratiotae	exp 1 armour 0 weapon_lvl 0
		unit	Skythikoi	exp 1 armour 0 weapon_lvl 0
		unit	Scoutatoi	exp 0 armour 0 weapon_lvl 0
		unit	Scoutatoi	exp 0 armour 0 weapon_lvl 0
		unit	Scoutatoi	exp 1 armour 0 weapon_lvl 0
		unit	Scoutatoi	exp 0 armour 0 weapon_lvl 0
		unit	Scoutatoi Swordsmen	exp 1 armour 0 weapon_lvl 0
		unit	Scoutatoi Swordsmen	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled russia
		spawn_army
		faction russia
		character	Domazhir Novgorodskii, named character, age 30, x 301, y 269, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Russian 1 , BiologicalSon 1
		unit	EE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Druzhina		exp 1 armour 0 weapon_lvl 0
		unit	Pechenegs		exp 1 armour 0 weapon_lvl 0
		unit	Pechenegs	exp 0 armour 0 weapon_lvl 0
		unit	Dismounted Druzhina	exp 1 armour 0 weapon_lvl 0
		unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
		unit	Rus Senior Militia	exp 1 armour 0 weapon_lvl 0
		unit	Rus Senior Militia	exp 0 armour 0 weapon_lvl 0
		unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
		unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled poland
		spawn_army
		faction poland
		character	Dobromir Piast, named character, age 30, x 215, y 210, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 3 , ReligionStarter 1 , Royal_Blood_Polish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Polish Shooters	exp 1 armour 0 weapon_lvl 0
		unit	Polish Nobles	exp 1 armour 0 weapon_lvl 0
		unit	Light Swordsmen	exp 0 armour 0 weapon_lvl 0
		unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
		unit	EE Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Lithuanian Archers	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled moors
		spawn_army
		faction moors
		character	Ayyub al_Andalusi, named character, age 30, x 44, y 119, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 3 , ReligionStarter 1 , Royal_Blood_Moorish 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Desert Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Urban Militia	exp 1 armour 0 weapon_lvl 0
		unit	Urban Militia	exp 0 armour 0 weapon_lvl 0
		unit	ME Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Dismounted Arab Cavalry	exp 0 armour 0 weapon_lvl 0
		unit	Dismounted Arab Cavalry	exp 0 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 1 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 0 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 1 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 0 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 1 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled turks
		spawn_army
		faction turks
		character	Bahadir al-Din, named character, age 30, x 312, y 119, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Turkish 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Turkomans	exp 1 armour 0 weapon_lvl 0
		unit	Turkomans	exp 1 armour 0 weapon_lvl 0
		unit	Saracen Militia	exp 1 armour 0 weapon_lvl 0
		unit	Saracen Militia	exp 0 armour 0 weapon_lvl 0
		unit	Ottoman Infantry	exp 1 armour 0 weapon_lvl 0
		unit	Ottoman Infantry	exp 0 armour 0 weapon_lvl 0
		unit	Turkish Archers	exp 0 armour 0 weapon_lvl 0
		unit	Turkish Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled egypt
		spawn_army
		faction egypt
		character	Abdul-Malik Al_Ayyubi, named character, age 30, x 302, y 59, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Egyptian 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Arab Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Dismounted Arab Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Dismounted Arab Cavalry	exp 0 armour 0 weapon_lvl 0
		unit	ME Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	ME Archer Militia	exp 0 armour 0 weapon_lvl 0
		unit	ME Archer Militia	exp 1 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 0 armour 0 weapon_lvl 0
		unit	Desert Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled denmark
		spawn_army
		faction denmark
		character	Birger Vermundsen, named character, age 30, x 147, y 246, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Danish 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Huscarls	exp 1 armour 0 weapon_lvl 0
		unit	Norse Swordsmen	exp 1 armour 0 weapon_lvl 0
		unit	Dismounted Huscarls	exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Norse Archers	exp 1 armour 0 weapon_lvl 0
		unit	Norse Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled portugal
		spawn_army
		faction portugal
		character	Claudio de_Portugal, named character, age 30, x 19, y 128, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Portuguese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Jinetes		exp 1 armour 0 weapon_lvl 0
		unit	Light Swordsmen		exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Lusitanian Javelinmen	exp 1 armour 0 weapon_lvl 0
		unit	Lusitanian Javelinmen	exp 0 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 0 armour 0 weapon_lvl 0
		unit	Crossbow Militia	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hungary
		spawn_army
		faction hungary
		character	Bod Arpadhazi, named character, age 30, x 215, y 188, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Hungarian 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Magyar Cavalry	exp 2 armour 0 weapon_lvl 0
		unit	Hungarian Nobles	exp 1 armour 0 weapon_lvl 0
		unit	Pavise Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Pavise Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	EE Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	EE Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Bosnian Archers	exp 0 armour 0 weapon_lvl 0
		unit	Bosnian Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled jerusalem
		spawn_army 
		faction jerusalem
		character	Bouchard de_Brienne, named character, age 30, x 331, y 77, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Jerusalem 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Knights of Jerusalem	exp 1 armour 0 weapon_lvl 0
		unit	Mounted Sergeants	exp 1 armour 0 weapon_lvl 0
		unit	Templar Sergeant	exp 1 armour 0 weapon_lvl 0
		unit	Templar Sergeant	exp 1 armour 0 weapon_lvl 0
		unit	Templar Sergeant	exp 1 armour 0 weapon_lvl 0
		unit	Templar Sergeant	exp 1 armour 0 weapon_lvl 0
		unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
		unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
		unit	Dismounted Knights Of Jerusalem	exp 1 armour 0 weapon_lvl 0	   
		unit	Dismounted Knights Of Jerusalem	exp 1 armour 0 weapon_lvl 0
		unit	Dismounted Knights Of Jerusalem	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled lithuania
		spawn_army
		faction lithuania
		character	Kestutis, named character, age 30, x 258, y 239, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Lithuanian 1 , BiologicalSon 1
		unit	Lith Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Lithuanian Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Ducal Cavalry	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Axemen	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Axemen	exp 0 armour 0 weapon_lvl 0
		unit	Baltic Spearmen	exp 1 armour 0 weapon_lvl 0
		unit	Baltic Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Lithuanian Archers	exp 1 armour 0 weapon_lvl 0
		unit	Lithuanian Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kievan_rus
		spawn_army
		faction kievan_rus
		character	Dobroslav Yaroslavich, named character, age 30, x 295, y 209, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kievan 1 , BiologicalSon 1
		unit	EE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Pechenegs		exp 1 armour 0 weapon_lvl 0
		unit	Aldari	exp 1 armour 0 weapon_lvl 0
		unit	Berdiche Militia	exp 0 armour 0 weapon_lvl 0
		unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
		unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
		unit	EE Archer Militia	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled aragon
		spawn_army
		faction aragon
		character	Alvar Ramirez, named character, age 30, x 76, y 147, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Aragonese 1 , BiologicalSon 1
		unit	SE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Mailed Knights	exp 0 armour 0 weapon_lvl 0
		unit	Almughavars	exp 1 armour 0 weapon_lvl 0
		unit	Almughavars	exp 0 armour 0 weapon_lvl 0
		unit	Light Men at Arms	exp 1 armour 0 weapon_lvl 0
		unit	Light Men at Arms	exp 0 armour 0 weapon_lvl 0
		unit	Peasant Archers	exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 2 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled norway
		spawn_army
		faction norway
		character	Erik Haakonsson, named character, age 30, x 116, y 279, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Norwegian 1 , BiologicalSon 1
		unit	NE Bodyguard	exp 1 armour 1 weapon_lvl 0
		unit	Svenner	exp 1 armour 1 weapon_lvl 0
		unit	Dismounted Huscarls	exp 2 armour 0 weapon_lvl 0
		unit	Norse Swordsmen	exp 2 armour 0 weapon_lvl 0
		unit	Norse Swordsmen	exp 1 armour 0 weapon_lvl 0
		unit	Viking Raiders	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 1 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Spear Militia	exp 0 armour 0 weapon_lvl 0
		unit	Norse Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kwarezm
		spawn_army
		faction kwarezm
		character	Batu Khwarezmshah, named character, age 30, x 499, y 93, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kwarezm 1 , BiologicalSon 1
		unit	ME Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Turkomans	exp 1 armour 0 weapon_lvl 0
		unit	Ghulams	exp 1 armour 0 weapon_lvl 0
		unit	Persian Spearmen	exp 1 armour 0 weapon_lvl 0
		unit	Persian Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Saracen Militia	exp 2 armour 0 weapon_lvl 0
		unit	Saracen Militia	exp 1 armour 0 weapon_lvl 0
		unit	Saracen Militia	exp 0 armour 0 weapon_lvl 0
		unit	Dismounted Ghulams	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled teutonic_order
		spawn_army 
		faction teutonic_order
		character	random_name, named character, age 30, x 224, y 238, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
		unit	NE Bodyguard	exp 2 armour 1 weapon_lvl 0
		unit	Christ Knights	exp 2 armour 0 weapon_lvl 0
		unit	Christ Knights	exp 1 armour 0 weapon_lvl 0
		unit	Sword Brethren	exp 1 armour 0 weapon_lvl 0
		unit	Sword Brethren	exp 0 armour 0 weapon_lvl 0
		unit	Order Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Order Spearmen	exp 0 armour 0 weapon_lvl 0
		unit	Prussian Archers	exp 1 armour 0 weapon_lvl 0
		unit	Prussian Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled mongols
		spawn_army 
		faction mongols
		character	Bavdai Khan, named character, age 25, x 498, y 157, label mongols4gen, family
		traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
		unit	Keshikten Bodyguard	exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 1 armour 0 weapon_lvl 0
		unit	Khabutu Archers	exp 3 armour 0 weapon_lvl 0
		unit	Khabutu Archers	exp 3 armour 0 weapon_lvl 0
		unit	Khabutu Archers	exp 2 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 2 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 2 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 2 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 2 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 2 armour 0 weapon_lvl 0
		end
	end_if
end_if
;-- Merchant&Priest&Ship Support Spawn Turn 1
spawn_character slave random_name, merchant, age 20, x 138, y 101
spawn_character slave random_name, merchant, age 20, x 66, y 131
spawn_character slave random_name, merchant, age 20, x 349, y 89
spawn_character slave random_name, merchant, age 20, x 428, y 218
spawn_character slave random_name, merchant, age 20, x 234, y 218
spawn_character slave random_name, merchant, age 20, x 81, y 184
spawn_character slave random_name, merchant, age 20, x 57, y 233
spawn_character slave random_name, merchant, age 20, x 178, y 248
spawn_character slave random_name, merchant, age 20, x 184, y 144
spawn_character slave random_name, merchant, age 20, x 223, y 157
spawn_character slave random_name, merchant, age 20, x 482, y 104
spawn_character slave random_name, merchant, age 20, x 20, y 125
spawn_character slave random_name, merchant, age 20, x 30, y 237
spawn_character slave random_name, merchant, age 20, x 238, y 118
;-- End of Merchant&Priest&Ship Support Spawn Turn 1
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType slave

;------ Merchant&Priest&Ship Support Spawn ------
if I_TurnNumber = 5
;if I_CompareCounter campaign_year = 1225
;and I_CompareCounter spawncount < 1
;	set_counter spawncount 1
	if I_IsFactionAIControlled england
	and I_NumberOfSettlements england > 1
		spawn_character england random_name, merchant, age 20, x 222, y 238
	end_if
	if I_IsFactionAIControlled france
	and I_NumberOfSettlements france > 1
		spawn_character france random_name, merchant, age 20, x 94, y 199
	end_if
	if I_IsFactionAIControlled hre
	and I_NumberOfSettlements hre > 1
		spawn_character hre random_name, merchant, age 20, x 156, y 201
	end_if
	if I_IsFactionAIControlled spain
	and I_NumberOfSettlements spain > 1
		spawn_character spain random_name, merchant, age 20, x 38, y 152
	end_if
	if I_IsFactionAIControlled venice
	and I_NumberOfSettlements venice > 1
		spawn_character venice random_name, merchant, age 20, x 165, y 173
	end_if
	if I_IsFactionAIControlled sicily
	and I_NumberOfSettlements sicily > 1
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
	end_if
	if I_IsFactionAIControlled milan
	and I_NumberOfSettlements milan > 1
		spawn_character milan random_name, merchant, age 20, x 139, y 168
	end_if
	if I_IsFactionAIControlled scotland
	and I_NumberOfSettlements scotland > 1
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
	end_if
	if I_IsFactionAIControlled cumans
	and I_NumberOfSettlements cumans > 1
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
	end_if
	if I_IsFactionAIControlled byzantium
	and I_NumberOfSettlements byzantium > 1
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
	end_if
	if I_IsFactionAIControlled russia
	and I_NumberOfSettlements russia > 1
		spawn_character russia random_name, merchant, age 20, x 301, y 269
	end_if
	if I_IsFactionAIControlled moors
	and I_NumberOfSettlements moors > 1
		spawn_character moors random_name, merchant, age 20, x 44, y 119
	end_if
	if I_IsFactionAIControlled turks
	and I_NumberOfSettlements turks > 1
		spawn_character turks random_name, merchant, age 20, x 312, y 119
	end_if
	if I_IsFactionAIControlled egypt
	and I_NumberOfSettlements egypt > 1
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
	end_if
	if I_IsFactionAIControlled denmark
	and I_NumberOfSettlements denmark > 1
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
	end_if
	if I_IsFactionAIControlled portugal
	and I_NumberOfSettlements portugal > 1
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
	end_if
	if I_IsFactionAIControlled poland
	and I_NumberOfSettlements poland > 1
		spawn_character poland random_name, merchant, age 20, x 215, y 210
	end_if
	if I_IsFactionAIControlled hungary
	and I_NumberOfSettlements hungary > 1
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
	end_if
	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfSettlements kievan_rus > 1
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
	end_if
	if I_IsFactionAIControlled aragon
	and I_NumberOfSettlements aragon > 1
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
	end_if
	if I_IsFactionAIControlled norway
	and I_NumberOfSettlements norway > 1
		spawn_character norway random_name, merchant, age 20, x 116, y 279
	end_if
	if I_IsFactionAIControlled lithuania
	and I_NumberOfSettlements lithuania > 1
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
	end_if
	if I_IsFactionAIControlled kwarezm
	and I_NumberOfSettlements kwarezm > 1
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
	end_if
	if I_IsFactionAIControlled jerusalem
	and I_NumberOfSettlements jerusalem > 1
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
	end_if
end_if
if I_TurnNumber = 30
;if I_CompareCounter campaign_year = 1250
;and I_CompareCounter spawncount < 2
;	set_counter spawncount 2
	if I_IsFactionAIControlled england
	and I_NumberOfSettlements england > 1
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, priest, age 20, x 222, y 238
	end_if
	if I_IsFactionAIControlled france
	and I_NumberOfSettlements france > 1
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, priest, age 20, x 94, y 199
	end_if
	if I_IsFactionAIControlled hre
	and I_NumberOfSettlements hre > 1
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, priest, age 20, x 156, y 201
	end_if
	if I_IsFactionAIControlled spain
	and I_NumberOfSettlements spain > 1
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, priest, age 20, x 38, y 152
	end_if
	if I_IsFactionAIControlled venice
	and I_NumberOfSettlements venice > 1
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, priest, age 20, x 165, y 173
	end_if
	if I_IsFactionAIControlled sicily
	and I_NumberOfSettlements sicily > 1
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, priest, age 20, x 170, y 117
	end_if
	if I_IsFactionAIControlled milan
	and I_NumberOfSettlements milan > 1
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, priest, age 20, x 139, y 168
	end_if
	if I_IsFactionAIControlled scotland
	and I_NumberOfSettlements scotland > 1
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, priest, age 20, x 62, y 247
	end_if
	if I_IsFactionAIControlled cumans
	and I_NumberOfSettlements cumans > 1
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, priest, age 20, x 431, y 250
	end_if
	if I_IsFactionAIControlled byzantium
	and I_NumberOfSettlements byzantium > 1
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, priest, age 20, x 282, y 143
	end_if
	if I_IsFactionAIControlled russia
	and I_NumberOfSettlements russia > 1
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, priest, age 20, x 301, y 269
	end_if
	if I_IsFactionAIControlled moors
	and I_NumberOfSettlements moors > 1
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, priest, age 20, x 44, y 119
	end_if
	if I_IsFactionAIControlled turks
	and I_NumberOfSettlements turks > 1
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, priest, age 20, x 312, y 119
	end_if
	if I_IsFactionAIControlled egypt
	and I_NumberOfSettlements egypt > 1
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, priest, age 20, x 302, y 59
	end_if
	if I_IsFactionAIControlled denmark
	and I_NumberOfSettlements denmark > 1
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, priest, age 20, x 147, y 246
	end_if
	if I_IsFactionAIControlled portugal
	and I_NumberOfSettlements portugal > 1
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, priest, age 20, x 19, y 128
	end_if
	if I_IsFactionAIControlled poland
	and I_NumberOfSettlements poland > 1
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, priest, age 20, x 215, y 210
	end_if
	if I_IsFactionAIControlled hungary
	and I_NumberOfSettlements hungary > 1
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, priest, age 20, x 215, y 188
	end_if
	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfSettlements kievan_rus > 1
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, priest, age 20, x 295, y 209
	end_if
	if I_IsFactionAIControlled aragon
	and I_NumberOfSettlements aragon > 1
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, priest, age 20, x 76, y 147
	end_if
	if I_IsFactionAIControlled norway
	and I_NumberOfSettlements norway > 1
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, priest, age 20, x 116, y 279
	end_if
	if I_IsFactionAIControlled lithuania
	and I_NumberOfSettlements lithuania > 1
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, priest, age 20, x 258, y 239
	end_if
	if I_IsFactionAIControlled kwarezm
	and I_NumberOfSettlements kwarezm > 1
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, priest, age 20, x 449, y 93
	end_if
	if I_IsFactionAIControlled jerusalem
	and I_NumberOfSettlements jerusalem > 1
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, priest, age 20, x 331, y 77
	end_if
end_if
if I_TurnNumber = 70
;if I_CompareCounter campaign_year = 1290
;and I_CompareCounter spawncount < 3
;	set_counter spawncount 3
	spawn_character slave random_name, merchant, age 20, x 138, y 101
	spawn_character slave random_name, merchant, age 20, x 66, y 131
	spawn_character slave random_name, merchant, age 20, x 349, y 89
	spawn_character slave random_name, merchant, age 20, x 428, y 218
	spawn_character slave random_name, merchant, age 20, x 234, y 218
	spawn_character slave random_name, merchant, age 20, x 81, y 184
	spawn_character slave random_name, merchant, age 20, x 57, y 233
	spawn_character slave random_name, merchant, age 20, x 178, y 248
	spawn_character slave random_name, merchant, age 20, x 184, y 144
	spawn_character slave random_name, merchant, age 20, x 223, y 157
	spawn_character slave random_name, merchant, age 20, x 482, y 104
	spawn_character slave random_name, merchant, age 20, x 20, y 125
	spawn_character slave random_name, merchant, age 20, x 30, y 237
	spawn_character slave random_name, merchant, age 20, x 238, y 118
end_if
if I_TurnNumber = 80
;if I_CompareCounter campaign_year = 1300
;and I_CompareCounter spawncount < 4
;	set_counter spawncount 4
	if I_IsFactionAIControlled england
	and I_NumberOfSettlements england > 1
		spawn_army
			faction england
			character random_name, admiral, age 20, x 76, y 211
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled venice
	and I_NumberOfSettlements venice > 1
		spawn_army
			faction venice
			character random_name, admiral, age 20, x 171, y 170
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled sicily
	and I_NumberOfSettlements sicily > 1
		spawn_army
			faction sicily
			character random_name, admiral, age 20, x 170, y 122
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled milan
	and I_NumberOfSettlements milan > 1
		spawn_army
			faction milan
			character random_name, admiral, age 20, x 76, y 211
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
			unit	galley		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled scotland
	and I_NumberOfSettlements scotland > 1
		spawn_army
			faction scotland
			character random_name, admiral, age 20, x 61, y 253
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled egypt
	and I_NumberOfSettlements egypt > 1
		spawn_army
			faction egypt
			character random_name, admiral, age 20, x 76, y 211
			unit	dhow		exp 0 armour 0 weapon_lvl 0
			unit	dhow		exp 0 armour 0 weapon_lvl 0
			unit	dhow		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled denmark
	and I_NumberOfSettlements denmark > 1
		spawn_army
			faction denmark
			character random_name, admiral, age 20, x 170, y 242
			unit	longboat		exp 0 armour 0 weapon_lvl 0
			unit	longboat		exp 0 armour 0 weapon_lvl 0
			unit	longboat		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled portugal
	and I_NumberOfSettlements portugal > 1
		spawn_army
			faction portugal
			character random_name, admiral, age 20, x 12, y 144
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled aragon
	and I_NumberOfSettlements aragon > 1
		spawn_army
			faction aragon
			character random_name, admiral, age 20, x 96, y 143
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
			unit	cog		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled norway
	and I_NumberOfSettlements norway > 1
		spawn_army
			faction norway
			character random_name, admiral, age 20, x 154, y 270
			unit	longboat		exp 0 armour 0 weapon_lvl 0
			unit	longboat		exp 0 armour 0 weapon_lvl 0
			unit	longboat		exp 0 armour 0 weapon_lvl 0
		end
	end_if
end_if
if I_TurnNumber = 90
;if I_CompareCounter campaign_year = 1310
;and I_CompareCounter spawncount < 5
;	set_counter spawncount 5
	if I_IsFactionAIControlled england
	and I_NumberOfSettlements england > 1
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, priest, age 20, x 222, y 238
	end_if
	if I_IsFactionAIControlled france
	and I_NumberOfSettlements france > 1
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, priest, age 20, x 94, y 199
	end_if
	if I_IsFactionAIControlled hre
	and I_NumberOfSettlements hre > 1
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, priest, age 20, x 156, y 201
	end_if
	if I_IsFactionAIControlled spain
	and I_NumberOfSettlements spain > 1
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, priest, age 20, x 38, y 152
	end_if
	if I_IsFactionAIControlled venice
	and I_NumberOfSettlements venice > 1
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, priest, age 20, x 165, y 173
	end_if
	if I_IsFactionAIControlled sicily
	and I_NumberOfSettlements sicily > 1
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, priest, age 20, x 170, y 117
	end_if
	if I_IsFactionAIControlled milan
	and I_NumberOfSettlements milan > 1
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, priest, age 20, x 139, y 168
	end_if
	if I_IsFactionAIControlled scotland
	and I_NumberOfSettlements scotland > 1
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, priest, age 20, x 62, y 247
	end_if
	if I_IsFactionAIControlled cumans
	and I_NumberOfSettlements cumans > 1
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, priest, age 20, x 431, y 250
	end_if
	if I_IsFactionAIControlled byzantium
	and I_NumberOfSettlements byzantium > 1
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, priest, age 20, x 282, y 143
	end_if
	if I_IsFactionAIControlled russia
	and I_NumberOfSettlements russia > 1
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, priest, age 20, x 301, y 269
	end_if
	if I_IsFactionAIControlled moors
	and I_NumberOfSettlements moors > 1
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, priest, age 20, x 44, y 119
	end_if
	if I_IsFactionAIControlled turks
	and I_NumberOfSettlements turks > 1
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, priest, age 20, x 312, y 119
	end_if
	if I_IsFactionAIControlled egypt
	and I_NumberOfSettlements egypt > 1
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, priest, age 20, x 302, y 59
	end_if
	if I_IsFactionAIControlled denmark
	and I_NumberOfSettlements denmark > 1
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, priest, age 20, x 147, y 246
	end_if
	if I_IsFactionAIControlled portugal
	and I_NumberOfSettlements portugal > 1
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, priest, age 20, x 19, y 128
	end_if
	if I_IsFactionAIControlled poland
	and I_NumberOfSettlements poland > 1
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, priest, age 20, x 215, y 210
	end_if
	if I_IsFactionAIControlled hungary
	and I_NumberOfSettlements hungary > 1
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, priest, age 20, x 215, y 188
	end_if
	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfSettlements kievan_rus > 1
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, priest, age 20, x 295, y 209
	end_if
	if I_IsFactionAIControlled aragon
	and I_NumberOfSettlements aragon > 1
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, priest, age 20, x 76, y 147
	end_if
	if I_IsFactionAIControlled norway
	and I_NumberOfSettlements norway > 1
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, priest, age 20, x 116, y 279
	end_if
	if I_IsFactionAIControlled lithuania
	and I_NumberOfSettlements lithuania > 1
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, priest, age 20, x 258, y 239
	end_if
	if I_IsFactionAIControlled kwarezm
	and I_NumberOfSettlements kwarezm > 1
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, priest, age 20, x 449, y 93
	end_if
	if I_IsFactionAIControlled jerusalem
	and I_NumberOfSettlements jerusalem > 1
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, priest, age 20, x 331, y 77
	end_if
end_if
if I_TurnNumber = 140
;if I_CompareCounter campaign_year = 1360
;and I_CompareCounter spawncount < 6
;	set_counter spawncount 6
	if I_IsFactionAIControlled england
	and I_NumberOfSettlements england > 1
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, merchant, age 20, x 222, y 238
		spawn_character england random_name, priest, age 20, x 222, y 238
	end_if
	if I_IsFactionAIControlled france
	and I_NumberOfSettlements france > 1
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, merchant, age 20, x 94, y 199
		spawn_character france random_name, priest, age 20, x 94, y 199
	end_if
	if I_IsFactionAIControlled hre
	and I_NumberOfSettlements hre > 1
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, merchant, age 20, x 156, y 201
		spawn_character hre random_name, priest, age 20, x 156, y 201
	end_if
	if I_IsFactionAIControlled spain
	and I_NumberOfSettlements spain > 1
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, merchant, age 20, x 38, y 152
		spawn_character spain random_name, priest, age 20, x 38, y 152
	end_if
	if I_IsFactionAIControlled venice
	and I_NumberOfSettlements venice > 1
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, merchant, age 20, x 165, y 173
		spawn_character venice random_name, priest, age 20, x 165, y 173
	end_if
	if I_IsFactionAIControlled sicily
	and I_NumberOfSettlements sicily > 1
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, merchant, age 20, x 170, y 117
		spawn_character sicily random_name, priest, age 20, x 170, y 117
	end_if
	if I_IsFactionAIControlled milan
	and I_NumberOfSettlements milan > 1
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, merchant, age 20, x 139, y 168
		spawn_character milan random_name, priest, age 20, x 139, y 168
	end_if
	if I_IsFactionAIControlled scotland
	and I_NumberOfSettlements scotland > 1
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, merchant, age 20, x 62, y 247
		spawn_character scotland random_name, priest, age 20, x 62, y 247
	end_if
	if I_IsFactionAIControlled cumans
	and I_NumberOfSettlements cumans > 1
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, merchant, age 20, x 431, y 250
		spawn_character cumans random_name, priest, age 20, x 431, y 250
	end_if
	if I_IsFactionAIControlled byzantium
	and I_NumberOfSettlements byzantium > 1
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, merchant, age 20, x 282, y 143
		spawn_character byzantium random_name, priest, age 20, x 282, y 143
	end_if
	if I_IsFactionAIControlled russia
	and I_NumberOfSettlements russia > 1
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, merchant, age 20, x 301, y 269
		spawn_character russia random_name, priest, age 20, x 301, y 269
	end_if
	if I_IsFactionAIControlled moors
	and I_NumberOfSettlements moors > 1
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, merchant, age 20, x 44, y 119
		spawn_character moors random_name, priest, age 20, x 44, y 119
	end_if
	if I_IsFactionAIControlled turks
	and I_NumberOfSettlements turks > 1
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, merchant, age 20, x 312, y 119
		spawn_character turks random_name, priest, age 20, x 312, y 119
	end_if
	if I_IsFactionAIControlled egypt
	and I_NumberOfSettlements egypt > 1
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, merchant, age 20, x 302, y 59
		spawn_character egypt random_name, priest, age 20, x 302, y 59
	end_if
	if I_IsFactionAIControlled denmark
	and I_NumberOfSettlements denmark > 1
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, merchant, age 20, x 147, y 246
		spawn_character denmark random_name, priest, age 20, x 147, y 246
	end_if
	if I_IsFactionAIControlled portugal
	and I_NumberOfSettlements portugal > 1
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, merchant, age 20, x 19, y 128
		spawn_character portugal random_name, priest, age 20, x 19, y 128
	end_if
	if I_IsFactionAIControlled poland
	and I_NumberOfSettlements poland > 1
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, merchant, age 20, x 215, y 210
		spawn_character poland random_name, priest, age 20, x 215, y 210
	end_if
	if I_IsFactionAIControlled hungary
	and I_NumberOfSettlements hungary > 1
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, merchant, age 20, x 215, y 188
		spawn_character hungary random_name, priest, age 20, x 215, y 188
	end_if
	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfSettlements kievan_rus > 1
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, merchant, age 20, x 295, y 209
		spawn_character kievan_rus random_name, priest, age 20, x 295, y 209
	end_if
	if I_IsFactionAIControlled aragon
	and I_NumberOfSettlements aragon > 1
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, merchant, age 20, x 76, y 147
		spawn_character aragon random_name, priest, age 20, x 76, y 147
	end_if
	if I_IsFactionAIControlled norway
	and I_NumberOfSettlements norway > 1
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, merchant, age 20, x 116, y 279
		spawn_character norway random_name, priest, age 20, x 116, y 279
	end_if
	if I_IsFactionAIControlled lithuania
	and I_NumberOfSettlements lithuania > 1
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, merchant, age 20, x 258, y 239
		spawn_character lithuania random_name, priest, age 20, x 258, y 239
	end_if
	if I_IsFactionAIControlled kwarezm
	and I_NumberOfSettlements kwarezm > 1
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, merchant, age 20, x 449, y 93
		spawn_character kwarezm random_name, priest, age 20, x 449, y 93
	end_if
	if I_IsFactionAIControlled jerusalem
	and I_NumberOfSettlements jerusalem > 1
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, merchant, age 20, x 331, y 77
		spawn_character jerusalem random_name, priest, age 20, x 331, y 77
	end_if
	
end_if

;--- Turn 10 Reinforcement
if I_TurnNumber = 10
;if I_CompareCounter campaign_year = 1230
;and I_CompareCounter spawncount < 7
;	set_counter spawncount 7
	if I_IsFactionAIControlled england
		spawn_army
			faction england
			character	Fulk Plantagenet, named character, age 30, x 78, y 218, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Norman Cavalry		exp 1 armour 0 weapon_lvl 0
			unit	Fyrd Spearmen		exp 0 armour 0 weapon_lvl 0
			unit	Longbowmen		exp 1 armour 0 weapon_lvl 0
			unit	Longbowmen		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled france
		spawn_army
			faction france
			character	Gautier Capet, named character, age 30, x 94, y 199, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Mailed Knights		exp 1 armour 0 weapon_lvl 0
			unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
			unit	Light Men at Arms		exp 0 armour 0 weapon_lvl 0
			unit	Light Men at Arms		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hre
		spawn_army
			faction hre
			character	Bruno von_Hohenstaufen, named character, age 30, x 156, y 201, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Dismounted Feudal Knights		exp 5 armour 0 weapon_lvl 0
			unit	Dismounted Feudal Knights		exp 5 armour 0 weapon_lvl 0
			unit	Dismounted Feudal Knights		exp 4 armour 0 weapon_lvl 0
			unit	Dismounted Feudal Knights		exp 4 armour 0 weapon_lvl 0
			unit	Dismounted Feudal Knights		exp 5 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 5 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 5 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 4 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 3 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 3 armour 0 weapon_lvl 0
			unit	Mailed Knights				exp 3 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled spain
		spawn_army
			faction spain
			character	Eusebio de_Castilla, named character, age 30, x 38, y 152, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Spanish 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Jinetes		exp 1 armour 0 weapon_lvl 0
			unit	Jinetes		exp 1 armour 0 weapon_lvl 0
			unit	Swordsmen Militia		exp 1 armour 0 weapon_lvl 0
			unit	Swordsmen Militia		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled venice
		spawn_army
			faction venice
			character	Bucello Ziani, named character, age 30, x 165, y 173, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Venetian 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Italian Cavalry Militia	exp 1 armour 0 weapon_lvl 0
			unit	Armored Sergeants	exp 0 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 1 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled sicily
		spawn_army
			faction sicily
			character	Guaimario d_Altavilla, named character, age 30, x 170, y 117, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Norman Cavalry	exp 1 armour 0 weapon_lvl 0
			unit	Urban Spear Militia	exp 2 armour 0 weapon_lvl 0
			unit	Sicilian Muslim Archers	exp 1 armour 0 weapon_lvl 0
			unit	Sicilian Muslim Archers	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled milan
		spawn_army
			faction milan
			character	Lapo Buvalelli, named character, age 30, x 139, y 168, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Milanese 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Italian Cavalry Militia	exp 1 armour 0 weapon_lvl 0
			unit	Urban Spear Militia	exp 1 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled scotland
		spawn_army
			faction scotland
			character	Amlaib mac_Donnchada, named character, age 30, x 62, y 247, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Scottish 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Border Horse		exp 1 armour 0 weapon_lvl 0
			unit	Highlanders		exp 1 armour 0 weapon_lvl 0
			unit	Scots Pike Militia		exp 2 armour 0 weapon_lvl 0
			unit	Scots Pike Militia		exp 2 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled cumans
		spawn_army
			faction cumans
			character	Bartan of_the_Tatar, named character, age 30, x 431, y 250, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Cumans 1 , BiologicalSon 1
			unit	Cuman Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Yasi Archers	exp 1 armour 0 weapon_lvl 0
			unit	Cuman Horse Militia	exp 2 armour 0 weapon_lvl 0
			unit	Steppe Alans	exp 0 armour 0 weapon_lvl 0
			unit	Steppe Alans	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled byzantium
		spawn_army
			faction byzantium
			character	Arsenios Laskaris, named character, age 30, x 282, y 143, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Greek 1 , BiologicalSon 1
			unit	Greek Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Cavalarii		exp 1 armour 0 weapon_lvl 0
			unit	Skythikoi		exp 1 armour 0 weapon_lvl 0
			unit	Scoutatoi Swordsmen	exp 1 armour 0 weapon_lvl 0
			unit	Scoutatoi Swordsmen	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled russia
		spawn_army
			faction russia
			character	Gorislav Novgorodskii, named character, age 30, x 301, y 269, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Russian 1 , BiologicalSon 1
			unit	EE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Druzhina			exp 1 armour 0 weapon_lvl 0
			unit	Pechenegs			exp 1 armour 0 weapon_lvl 0
			unit	Dismounted Druzhina	exp 1 armour 0 weapon_lvl 0
			unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
			unit	Rus Senior Militia	exp 1 armour 0 weapon_lvl 0
			unit	Rus Senior Militia	exp 1 armour 0 weapon_lvl 0
			unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled moors
		spawn_army
			faction moors
			character	Bakr al_Andalusi, named character, age 30, x 44, y 119, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Moorish 1 , BiologicalSon 1
			unit	ME Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Sipahis	exp 2 armour 0 weapon_lvl 0
			unit	Arab Cavalry	exp 2 armour 0 weapon_lvl 0
			unit	Arab Cavalry	exp 4 armour 0 weapon_lvl 0
			unit	Desert Archers	exp 3 armour 0 weapon_lvl 0
			unit	Desert Archers	exp 4 armour 0 weapon_lvl 0
			unit	Desert Archers	exp 2 armour 0 weapon_lvl 0
			unit	Desert Archers	exp 4 armour 0 weapon_lvl 0
			unit	Hashishim	exp 4 armour 0 weapon_lvl 0
			unit	Hashishim	exp 3 armour 0 weapon_lvl 0
			unit	Hashishim	exp 2 armour 0 weapon_lvl 0
			unit	Hashishim	exp 2 armour 0 weapon_lvl 0
			unit	Granadine Jinetes	exp 1 armour 0 weapon_lvl 0
			unit	Granadine Jinetes	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled turks
		spawn_army
			faction turks
			character	Ali al-Din, named character, age 30, x 312, y 119, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Turkish 1 , BiologicalSon 1
			unit	ME Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Turkomans		exp 1 armour 0 weapon_lvl 0
			unit	Turkomans		exp 1 armour 0 weapon_lvl 0
			unit	Ottoman Infantry		exp 1 armour 0 weapon_lvl 0
			unit	Ottoman Infantry		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled egypt
		spawn_army
			faction egypt
			character	Dinar Al_Ayyubi, named character, age 30, x 302, y 59, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Egyptian 1 , BiologicalSon 1
			unit	ME Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Arab Cavalry	exp 1 armour 0 weapon_lvl 0
			unit	Dismounted Arab Cavalry		exp 1 armour 0 weapon_lvl 0
			unit	Desert Archers		exp 0 armour 0 weapon_lvl 0
			unit	Desert Archers		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled denmark
		spawn_army
			faction denmark
			character	Bue Vermundsen, named character, age 30, x 147, y 246, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Danish 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Huscarls		exp 1 armour 0 weapon_lvl 0
			unit	Norse Swordsmen		exp 1 armour 0 weapon_lvl 0
			unit	Norse Swordsmen		exp 1 armour 0 weapon_lvl 0
			unit	Dismounted Huscarls		exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled portugal
		spawn_army
			faction portugal
			character	Baltazar de_Portugal, named character, age 30, x 19, y 128, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Portuguese 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Jinetes			exp 1 armour 0 weapon_lvl 0
			unit	Light Swordsmen			exp 1 armour 0 weapon_lvl 0
			unit	Lusitanian Javelinmen		exp 1 armour 0 weapon_lvl 0
			unit	Lusitanian Javelinmen		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled poland
		spawn_army
			faction poland
			character	Ignacy Piast, named character, age 30, x 215, y 210, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Polish 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Polish Shooters		exp 1 armour 0 weapon_lvl 0
			unit	Polish Nobles		exp 1 armour 0 weapon_lvl 0
			unit	Light Swordsmen		exp 0 armour 0 weapon_lvl 0
			unit	Smolensk Infantry		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled hungary
		spawn_army
			faction hungary
			character	Bank Arpadhazi, named character, age 30, x 215, y 188, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Hungarian 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
			unit	Hungarian Nobles		exp 1 armour 0 weapon_lvl 0
			unit	Pavise Spearmen		exp 0 armour 0 weapon_lvl 0
			unit	Pavise Spearmen		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kievan_rus
		spawn_army
			faction kievan_rus
			character	Gavriil Yaroslavich, named character, age 30, x 295, y 209, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kievan 1 , BiologicalSon 1
			unit	EE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Pechenegs			exp 1 armour 0 weapon_lvl 0
			unit	Aldari	exp 1 armour 0 weapon_lvl 0
			unit	Berdiche Militia	exp 0 armour 0 weapon_lvl 0
			unit	Smolensk Infantry	exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled aragon
		spawn_army
			faction aragon
			character	Jimeno Ramirez, named character, age 30, x 76, y 147, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Aragonese 1 , BiologicalSon 1
			unit	SE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Mailed Knights		exp 0 armour 0 weapon_lvl 0
			unit	Mailed Knights		exp 0 armour 0 weapon_lvl 0
			unit	Almughavars		exp 1 armour 0 weapon_lvl 0
			unit	Almughavars		exp 0 armour 0 weapon_lvl 0
			unit	Light Men at Arms		exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled norway
		spawn_army
			faction norway
			character	Yngwie Haakonsson, named character, age 30, x 116, y 279, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Norwegian 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
			unit	Dismounted Huscarls		exp 2 armour 0 weapon_lvl 0
			unit	Norse Swordsmen		exp 2 armour 0 weapon_lvl 0
			unit	Norse Swordsmen		exp 1 armour 0 weapon_lvl 0
			unit	Viking Raiders		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled lithuania
		spawn_army
			faction lithuania
			character	Vasalgas, named character, age 30, x 258, y 239, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Lithuanian 1 , BiologicalSon 1
			unit	Lith Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Lithuanian Cavalry	exp 1 armour 0 weapon_lvl 0
			unit	Ducal Cavalry		exp 2 armour 0 weapon_lvl 0
			unit	Baltic Spearmen		exp 3 armour 0 weapon_lvl 0
			unit	Baltic Spearmen		exp 2 armour 0 weapon_lvl 0
			unit	Baltic Spearmen		exp 1 armour 0 weapon_lvl 0
			unit	Baltic Spearmen		exp 5 armour 0 weapon_lvl 0
			unit	Lithuanian Cavalry	exp 3 armour 0 weapon_lvl 0
			unit	Lithuanian Cavalry	exp 4 armour 0 weapon_lvl 0
			unit	Lithuanian Cavalry	exp 3 armour 0 weapon_lvl 0
			unit	Lithuanian Cavalry	exp 2 armour 0 weapon_lvl 0
			unit	Lithuanian Archers		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled kwarezm
		spawn_army
			faction kwarezm
			character	Melik Khwarezmshah, named character, age 30, x 449, y 93, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kwarezm 1 , BiologicalSon 1
			unit	ME Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Turkomans		exp 1 armour 0 weapon_lvl 0
			unit	Ghulams		exp 1 armour 0 weapon_lvl 0
			unit	Persian Spearmen		exp 1 armour 0 weapon_lvl 0
			unit	Persian Spearmen		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled teutonic_order
		spawn_army
			faction teutonic_order
			character	random_name, named character, age 30, x 224, y 238, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Christ Knights		exp 2 armour 0 weapon_lvl 0
			unit	Sword Brethren		exp 1 armour 0 weapon_lvl 0
			unit	Order Spearmen		exp 0 armour 0 weapon_lvl 0
			unit	Prussian Archers	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	if I_IsFactionAIControlled jerusalem
		spawn_army
			faction jerusalem
			character	Simon de_Brienne, named character, age 30, x 331, y 77, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 1 weapon_lvl 0
			unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
			unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
			unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
			unit	Templar Crossbowmen	exp 0 armour 0 weapon_lvl 0
			unit	Dismounted Knights Of Jerusalem		exp 1 armour 0 weapon_lvl 0	  
			unit	Dismounted Knights Of Jerusalem		exp 1 armour 0 weapon_lvl 0
			unit	Dismounted Knights Of Jerusalem		exp 1 armour 0 weapon_lvl 0
			unit	Knights of Jerusalem		exp 1 armour 0 weapon_lvl 0
			unit	Knights of Jerusalem		exp 1 armour 0 weapon_lvl 0
			unit	Knights of Jerusalem		exp 1 armour 0 weapon_lvl 0
		end
	end_if
end_if
;--- End of Turn 10 Reinforcement
end_monitor

;--- No Heir Reinforcement
declare_counter heir_venice
declare_counter heir_sicily
declare_counter heir_milan
declare_counter heir_papal_states
declare_counter heir_denmark
declare_counter heir_egypt
declare_counter heir_scotland
declare_counter heir_cumans
declare_counter heir_mongols
declare_counter heir_turks
declare_counter heir_france
declare_counter heir_hre
declare_counter heir_england
declare_counter heir_portugal
declare_counter heir_poland
declare_counter heir_byzantium
declare_counter heir_moors
declare_counter heir_russia
declare_counter heir_spain
declare_counter heir_hungary
declare_counter heir_aragon
declare_counter heir_lithuania
declare_counter heir_kievan_rus
declare_counter heir_teutonic_order
declare_counter heir_timurids
declare_counter heir_norway
declare_counter heir_jerusalem
declare_counter heir_kwarezm
declare_counter no_other_heir_spawn

monitor_event FactionTurnStart FactionType slave

	if I_IsFactionAIControlled england
	and I_NumberOfHeirs england < 4
	and I_CompareCounter heir_england < 3
	and I_NumberOfSettlements england >= 1
		spawn_army
			faction england
			character	random_name, named character, age 20, x 83, y 220, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_england 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled scotland
	and I_NumberOfHeirs scotland < 4
	and I_CompareCounter heir_scotland < 3
	and I_NumberOfSettlements scotland >= 1
		spawn_army
			faction scotland
			character	random_name, named character, age 20, x 53, y 253, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_scotland 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled denmark
	and I_NumberOfHeirs denmark < 4
	and I_CompareCounter heir_denmark < 3
	and I_NumberOfSettlements denmark >= 1
		spawn_army
			faction denmark
			character	random_name, named character, age 20, x 146, y 253, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_denmark 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled norway
	and I_NumberOfHeirs norway < 4
	and I_CompareCounter heir_norway < 3
	and I_NumberOfSettlements norway >= 1
		spawn_army
			faction norway
			character	random_name, named character, age 20, x 114, y 280, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_norway 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled france
	and I_NumberOfHeirs france < 4
	and I_CompareCounter heir_france < 3
	and I_NumberOfSettlements france >= 1
		spawn_army
			faction france
			character	random_name, named character, age 20, x 92, y 202, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_france 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled hre
	and I_NumberOfHeirs hre < 4
	and I_CompareCounter heir_hre < 3
	and I_NumberOfSettlements hre >= 1
		spawn_army
			faction hre
			character	random_name, named character, age 20, x 143, y 207, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_hre 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled milan
	and I_NumberOfHeirs milan < 4
	and I_CompareCounter heir_milan < 3
	and I_NumberOfSettlements milan >= 1
		spawn_army
			faction milan
			character	random_name, named character, age 20, x 137, y 168, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_milan 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled aragon
	and I_NumberOfHeirs aragon < 4
	and I_CompareCounter heir_aragon < 3
	and I_NumberOfSettlements aragon >= 1
		spawn_army
			faction aragon
			character	random_name, named character, age 20, x 83, y 150, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_aragon 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled spain
	and I_NumberOfHeirs spain < 4
	and I_CompareCounter heir_spain < 3
	and I_NumberOfSettlements spain >= 1
		spawn_army
			faction spain
			character	random_name, named character, age 20, x 32, y 148, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_spain 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled portugal
	and I_NumberOfHeirs portugal < 4
	and I_CompareCounter heir_portugal < 3
	and I_NumberOfSettlements portugal >= 1
		spawn_army
			faction portugal
			character	random_name, named character, age 20, x 17, y 123, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_portugal 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled venice
	and I_NumberOfHeirs venice < 4
	and I_CompareCounter heir_venice < 3
	and I_NumberOfSettlements venice >= 1
		spawn_army
			faction venice
			character	random_name, named character, age 20, x 161, y 173, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_venice 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled sicily
	and I_NumberOfHeirs sicily < 4
	and I_CompareCounter heir_sicily < 3
	and I_NumberOfSettlements sicily >= 1
		spawn_army
			faction sicily
			character	random_name, named character, age 20, x 177, y 114, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_sicily 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled poland
	and I_NumberOfHeirs poland < 4
	and I_CompareCounter heir_poland < 3
	and I_NumberOfSettlements poland >= 1
		spawn_army
			faction poland
			character	random_name, named character, age 20, x 222, y 213, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_poland 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled hungary
	and I_NumberOfHeirs hungary < 4
	and I_CompareCounter heir_hungary < 3
	and I_NumberOfSettlements hungary >= 1
		spawn_army
			faction hungary
			character	random_name, named character, age 20, x 206, y 179, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_hungary 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfHeirs kievan_rus < 4
	and I_CompareCounter heir_kievan_rus < 3
	and I_NumberOfSettlements kievan_rus >= 1
		spawn_army
			faction kievan_rus
			character	random_name, named character, age 20, x 292, y 214, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_kievan_rus 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled russia
	and I_NumberOfHeirs russia < 4
	and I_CompareCounter heir_russia < 3
	and I_NumberOfSettlements russia >= 1
		spawn_army
			faction russia
			character	random_name, named character, age 20, x 301, y 275, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_russia 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled byzantium
	and I_NumberOfHeirs byzantium < 4
	and I_CompareCounter heir_byzantium < 3
	and I_NumberOfSettlements byzantium >= 1
		spawn_army
			faction byzantium
			character	random_name, named character, age 20, x 278, y 148, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Greek Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_byzantium 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled lithuania
	and I_NumberOfHeirs lithuania < 4
	and I_CompareCounter heir_lithuania < 3
	and I_NumberOfSettlements lithuania >= 1
		spawn_army
			faction lithuania
			character	random_name, named character, age 20, x 262, y 240, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Lith Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_lithuania 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled teutonic_order
	and I_EventCounter inquisition > 0
	and I_FactionLeaderAttribute teutonic_order Command < 999
	and I_NumberOfHeirs teutonic_order < 4
	and I_CompareCounter heir_teutonic_order < 3
		spawn_army
			faction teutonic_order
			character	random_name, named character, age 20, x 232, y 237, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	TO Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_teutonic_order 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled jerusalem
	and I_NumberOfHeirs jerusalem < 4
	and I_CompareCounter heir_jerusalem < 3
	and I_NumberOfSettlements jerusalem >= 1
		spawn_army
			faction jerusalem
			character	random_name, named character, age 20, x 329, y 78, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_jerusalem 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled turks
	and I_NumberOfHeirs turks < 4
	and I_CompareCounter heir_turks < 3
	and I_NumberOfSettlements turks >= 1
		spawn_army
			faction turks
			character	random_name, named character, age 20, x 339, y 133, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_turks 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled egypt
	and I_NumberOfHeirs egypt < 4
	and I_CompareCounter heir_egypt < 3
	and I_NumberOfSettlements egypt >= 1
		spawn_army
			faction egypt
			character	random_name, named character, age 20, x 309, y 60, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_egypt 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled moors
	and I_NumberOfHeirs moors < 4
	and I_CompareCounter heir_moors < 3
	and I_NumberOfSettlements moors >= 1
		spawn_army
			faction moors
			character	random_name, named character, age 20, x 40, y 113, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_moors 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled kwarezm
	and I_NumberOfHeirs kwarezm < 4
	and I_CompareCounter heir_kwarezm < 3
	and I_NumberOfSettlements kwarezm >= 1
		spawn_army
			faction kwarezm
			character	random_name, named character, age 20, x 449, y 93, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_kwarezm 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled cumans
	and I_NumberOfHeirs cumans < 4
	and I_CompareCounter heir_cumans < 3
	and I_NumberOfSettlements cumans >= 1
		spawn_army
			faction cumans
			character	random_name, named character, age 20, x 440, y 250, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Cuman Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_cumans 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled mongols
	and I_EventCounter mongols_invasion > 0
	and I_FactionLeaderAttribute mongols Command < 999
	and I_NumberOfHeirs mongols < 4
	and I_CompareCounter heir_mongols < 3
		spawn_army
			faction mongols
			character	random_name, named character, age 20, x 502, y 160, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Keshikten Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_mongols 1
		inc_counter no_other_heir_spawn 1
	end_if

	if I_IsFactionAIControlled timurids
	and I_EventCounter timurids_invasion > 0
	and I_FactionLeaderAttribute timurids Command < 999
	and I_NumberOfHeirs timurids < 4
	and I_CompareCounter heir_timurids < 3
		spawn_army
			faction timurids
			character	random_name, named character, age 20, x 502, y 161, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Keshikten Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_timurids 1
		inc_counter no_other_heir_spawn 1
	end_if
	
	if I_CompareCounter no_other_heir_spawn = 78;	that is, 3x[27(=Number of factions with family tree)-1]
		terminate_monitor
	end_if
end_monitor

;============= FACTION ECONOMY SCRIPT (GSTHOED) ================
;--- FES religion islam
declare_counter freeze_egypt
declare_counter freeze_turks
declare_counter freeze_timurids
declare_counter freeze_kwarezm
declare_counter freeze_moors
;--- FES religion pagan 
declare_counter freeze_lithuania
declare_counter freeze_cumans
declare_counter freeze_mongols
;--- FES religion orthodox 
declare_counter freeze_byzantium
declare_counter freeze_russia
declare_counter freeze_kievan_rus
;--- FES religion catholic 
declare_counter freeze_venice
declare_counter freeze_sicily
declare_counter freeze_milan
declare_counter freeze_denmark
declare_counter freeze_scotland
declare_counter freeze_france
declare_counter freeze_hre
declare_counter freeze_england
declare_counter freeze_portugal
declare_counter freeze_poland
declare_counter freeze_spain
declare_counter freeze_hungary
declare_counter freeze_aragon
declare_counter freeze_teutonic_order
declare_counter freeze_norway
declare_counter freeze_jerusalem
declare_counter freeze_papal_states

; Rich AI faction
monitor_event PreFactionTurnStart IsFactionAIControlled
	and not FactionType slave
	and Treasury > 85000

	if I_CompareCounter turn_fid = 1
		add_money egypt -10000
	end_if
	if I_CompareCounter turn_fid = 2
		add_money turks -10000
	end_if
	if I_CompareCounter turn_fid = 3
		add_money timurids -10000
	end_if
	if I_CompareCounter turn_fid = 4
		add_money kwarezm -10000
	end_if
	if I_CompareCounter turn_fid = 5
		add_money moors -10000
	end_if
	if I_CompareCounter turn_fid = 6
		add_money lithuania -10000
	end_if
	if I_CompareCounter turn_fid = 7
		add_money cumans -10000
	end_if
	if I_CompareCounter turn_fid = 8
		add_money mongols -10000
	end_if
	if I_CompareCounter turn_fid = 9
		add_money byzantium -10000
	end_if
	if I_CompareCounter turn_fid = 10
		add_money russia -10000
	end_if
	if I_CompareCounter turn_fid = 11
		add_money kievan_rus -10000
	end_if
	if I_CompareCounter turn_fid = 12
		add_money venice -10000
	end_if
	if I_CompareCounter turn_fid = 13
		add_money sicily -10000
	end_if
	if I_CompareCounter turn_fid = 14
		add_money milan -10000
	end_if
	if I_CompareCounter turn_fid = 15
		add_money denmark -10000
	end_if
	if I_CompareCounter turn_fid = 16
		add_money scotland -10000
	end_if
	if I_CompareCounter turn_fid = 17
		add_money france -10000
	end_if
	if I_CompareCounter turn_fid = 18
		add_money hre -10000
	end_if
	if I_CompareCounter turn_fid = 19
		add_money england -10000
	end_if
	if I_CompareCounter turn_fid = 20
		add_money portugal -10000
	end_if
	if I_CompareCounter turn_fid = 21
		add_money poland -10000
	end_if
	if I_CompareCounter turn_fid = 22
		add_money spain -10000
	end_if
	if I_CompareCounter turn_fid = 23
		add_money hungary -10000
	end_if
	if I_CompareCounter turn_fid = 24
		add_money aragon -10000
	end_if
	if I_CompareCounter turn_fid = 25
		add_money teutonic_order -10000
	end_if
	if I_CompareCounter turn_fid = 26
		add_money norway -10000
	end_if
	if I_CompareCounter turn_fid = 27
		add_money jerusalem -10000
	end_if
	if I_CompareCounter turn_fid = 28
		add_money papal_states -10000
	end_if
end_monitor

; Small FactionIncome at their TurnStart - prepare to freeze their recruitment pool if next turn they 'll start with small Treasury
monitor_event FactionTurnStart FactionHasRank
	and IsFactionAIControlled
	and FactionIncome < 1000

	if I_CompareCounter turn_fid = 1
		set_counter freeze_egypt 1
	end_if
	if I_CompareCounter turn_fid = 2
		set_counter freeze_turks 1
	end_if
	if I_CompareCounter turn_fid = 3
		set_counter freeze_timurids 1
	end_if
	if I_CompareCounter turn_fid = 4
		set_counter freeze_kwarezm 1
	end_if
	if I_CompareCounter turn_fid = 5
		set_counter freeze_moors 1
	end_if
	if I_CompareCounter turn_fid = 6
		set_counter freeze_lithuania 1
	end_if
	if I_CompareCounter turn_fid = 7
		set_counter freeze_cumans 1
	end_if
	if I_CompareCounter turn_fid = 8
		set_counter freeze_mongols 1
	end_if
	if I_CompareCounter turn_fid = 9
		set_counter freeze_byzantium 1
	end_if
	if I_CompareCounter turn_fid = 10
		set_counter freeze_russia 1
	end_if
	if I_CompareCounter turn_fid = 11
		set_counter freeze_kievan_rus 1
	end_if
	if I_CompareCounter turn_fid = 12
		set_counter freeze_venice 1
	end_if
	if I_CompareCounter turn_fid = 13
		set_counter freeze_sicily 1
	end_if
	if I_CompareCounter turn_fid = 14
		set_counter freeze_milan 1
	end_if
	if I_CompareCounter turn_fid = 15
		set_counter freeze_denmark 1
	end_if
	if I_CompareCounter turn_fid = 16
		set_counter freeze_scotland 1
	end_if
	if I_CompareCounter turn_fid = 17
		set_counter freeze_france 1
	end_if
	if I_CompareCounter turn_fid = 18
		set_counter freeze_hre 1
	end_if
	if I_CompareCounter turn_fid = 19
		set_counter freeze_england 1
	end_if
	if I_CompareCounter turn_fid = 20
		set_counter freeze_portugal 1
	end_if
	if I_CompareCounter turn_fid = 21
		set_counter freeze_poland 1
	end_if
	if I_CompareCounter turn_fid = 22
		set_counter freeze_spain 1
	end_if
	if I_CompareCounter turn_fid = 23
		set_counter freeze_hungary 1
	end_if
	if I_CompareCounter turn_fid = 24
		set_counter freeze_aragon 1
	end_if
	if I_CompareCounter turn_fid = 25
		set_counter freeze_teutonic_order 1
	end_if
	if I_CompareCounter turn_fid = 26
		set_counter freeze_norway 1
	end_if
	if I_CompareCounter turn_fid = 27
		set_counter freeze_jerusalem 1
	end_if
	if I_CompareCounter turn_fid = 28
		set_counter freeze_papal_states 1
	end_if
end_monitor

;Great AI debt - if they are not slaves, disband their mercenaries
monitor_event PreFactionTurnStart IsFactionAIControlled
	and Treasury < -5000

	if I_CompareCounter turn_fid = 0
		add_money slave 2147483647
		add_money slave 2147483647
		add_money slave -2147483647
		add_money slave 101
	end_if

	if I_CompareCounter turn_fid = 1
		destroy_units egypt, mercenary_unit
		add_money egypt 2147483647
		add_money egypt 2147483647
		add_money egypt -2147483647
		add_money egypt 101
		set_counter freeze_egypt 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 2
		destroy_units turks, mercenary_unit
		add_money turks 2147483647
		add_money turks 2147483647
		add_money turks -2147483647
		add_money turks 101
		set_counter freeze_turks 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 3
		destroy_units timurids, mercenary_unit
		add_money timurids 2147483647
		add_money timurids 2147483647
		add_money timurids -2147483647
		add_money timurids 101
		set_counter freeze_timurids 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 4
		destroy_units kwarezm, mercenary_unit
		add_money kwarezm 2147483647
		add_money kwarezm 2147483647
		add_money kwarezm -2147483647
		add_money kwarezm 101
		set_counter freeze_kwarezm 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 5
		destroy_units moors, mercenary_unit
		add_money moors 2147483647
		add_money moors 2147483647
		add_money moors -2147483647
		add_money moors 101
		set_counter freeze_moors 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 6
		destroy_units lithuania, mercenary_unit
		add_money lithuania 2147483647
		add_money lithuania 2147483647
		add_money lithuania -2147483647
		add_money lithuania 101
		set_counter freeze_lithuania 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 7
		destroy_units cumans, mercenary_unit
		add_money cumans 2147483647
		add_money cumans 2147483647
		add_money cumans -2147483647
		add_money cumans 101
		set_counter freeze_cumans 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 8
		destroy_units mongols, mercenary_unit
		add_money mongols 2147483647
		add_money mongols 2147483647
		add_money mongols -2147483647
		add_money mongols 101
		set_counter freeze_mongols 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 9
		destroy_units byzantium, mercenary_unit
		add_money byzantium 2147483647
		add_money byzantium 2147483647
		add_money byzantium -2147483647
		add_money byzantium 101
		set_counter freeze_byzantium 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 10
		destroy_units russia, mercenary_unit
		add_money russia 2147483647
		add_money russia 2147483647
		add_money russia -2147483647
		add_money russia 101
		set_counter freeze_russia 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 11
		destroy_units kievan_rus, mercenary_unit
		add_money kievan_rus 2147483647
		add_money kievan_rus 2147483647
		add_money kievan_rus -2147483647
		add_money kievan_rus 101
		set_counter freeze_kievan_rus 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 12
		destroy_units venice, mercenary_unit
		add_money venice 2147483647
		add_money venice 2147483647
		add_money venice -2147483647
		add_money venice 101
		set_counter freeze_venice 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 13
		destroy_units sicily, mercenary_unit
		add_money sicily 2147483647
		add_money sicily 2147483647
		add_money sicily -2147483647
		add_money sicily 101
		set_counter freeze_sicily 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 14
		destroy_units milan, mercenary_unit
		add_money milan 2147483647
		add_money milan 2147483647
		add_money milan -2147483647
		add_money milan 101
		set_counter freeze_milan 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 15
		destroy_units denmark, mercenary_unit
		add_money denmark 2147483647
		add_money denmark 2147483647
		add_money denmark -2147483647
		add_money denmark 101
		set_counter freeze_denmark 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 16
		destroy_units scotland, mercenary_unit
		add_money scotland 2147483647
		add_money scotland 2147483647
		add_money scotland -2147483647
		add_money scotland 101
		set_counter freeze_scotland 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 17
		destroy_units france, mercenary_unit
		add_money france 2147483647
		add_money france 2147483647
		add_money france -2147483647
		add_money france 101
		set_counter freeze_france 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 18
		destroy_units hre, mercenary_unit
		add_money hre 2147483647
		add_money hre 2147483647
		add_money hre -2147483647
		add_money hre 101
		set_counter freeze_hre 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 19
		destroy_units england, mercenary_unit
		add_money england 2147483647
		add_money england 2147483647
		add_money england -2147483647
		add_money england 101
		set_counter freeze_england 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 20
		destroy_units portugal, mercenary_unit
		add_money portugal 2147483647
		add_money portugal 2147483647
		add_money portugal -2147483647
		add_money portugal 101
		set_counter freeze_portugal 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 21
		destroy_units poland, mercenary_unit
		add_money poland 2147483647
		add_money poland 2147483647
		add_money poland -2147483647
		add_money poland 101
		set_counter freeze_poland 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 22
		destroy_units spain, mercenary_unit
		add_money spain 2147483647
		add_money spain 2147483647
		add_money spain -2147483647
		add_money spain 101
		set_counter freeze_spain 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 23
		destroy_units hungary, mercenary_unit
		add_money hungary 2147483647
		add_money hungary 2147483647
		add_money hungary -2147483647
		add_money hungary 101
		set_counter freeze_hungary 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 24
		destroy_units aragon, mercenary_unit
		add_money aragon 2147483647
		add_money aragon 2147483647
		add_money aragon -2147483647
		add_money aragon 101
		set_counter freeze_aragon 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 25
		destroy_units teutonic_order, mercenary_unit
		add_money teutonic_order 2147483647
		add_money teutonic_order 2147483647
		add_money teutonic_order -2147483647
		add_money teutonic_order 101
		set_counter freeze_teutonic_order 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 26
		destroy_units norway, mercenary_unit
		add_money norway 2147483647
		add_money norway 2147483647
		add_money norway -2147483647
		add_money norway 101
		set_counter freeze_norway 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 27
		destroy_units jerusalem, mercenary_unit
		add_money jerusalem 2147483647
		add_money jerusalem 2147483647
		add_money jerusalem -2147483647
		add_money jerusalem 101
		set_counter freeze_jerusalem 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 28
		destroy_units papal_states, mercenary_unit
		add_money papal_states 2147483647
		add_money papal_states 2147483647
		add_money papal_states -2147483647
		add_money papal_states 101
		set_counter freeze_papal_states 0
		set_event_counter freeze_recr_pool 1
	end_if
end_monitor

;Small AI debt - don't disband their mercenaries
monitor_event PreFactionTurnStart IsFactionAIControlled
	and Treasury < 0

	if I_CompareCounter turn_fid = 0
		add_money slave 2147483647
		add_money slave 2147483647
		add_money slave -2147483647
		add_money slave 101
	end_if

	if I_CompareCounter turn_fid = 1
		add_money egypt 2147483647
		add_money egypt 2147483647
		add_money egypt -2147483647
		add_money egypt 101
		set_counter freeze_egypt 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 2
		add_money turks 2147483647
		add_money turks 2147483647
		add_money turks -2147483647
		add_money turks 101
		set_counter freeze_turks 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 3
		add_money timurids 2147483647
		add_money timurids 2147483647
		add_money timurids -2147483647
		add_money timurids 101
		set_counter freeze_timurids 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 4
		add_money kwarezm 2147483647
		add_money kwarezm 2147483647
		add_money kwarezm -2147483647
		add_money kwarezm 101
		set_counter freeze_kwarezm 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 5
		add_money moors 2147483647
		add_money moors 2147483647
		add_money moors -2147483647
		add_money moors 101
		set_counter freeze_moors 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 6
		add_money lithuania 2147483647
		add_money lithuania 2147483647
		add_money lithuania -2147483647
		add_money lithuania 101
		set_counter freeze_lithuania 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 7
		add_money cumans 2147483647
		add_money cumans 2147483647
		add_money cumans -2147483647
		add_money cumans 101
		set_counter freeze_cumans 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 8
		add_money mongols 2147483647
		add_money mongols 2147483647
		add_money mongols -2147483647
		add_money mongols 101
		set_counter freeze_mongols 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 9
		add_money byzantium 2147483647
		add_money byzantium 2147483647
		add_money byzantium -2147483647
		add_money byzantium 101
		set_counter freeze_byzantium 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 10
		add_money russia 2147483647
		add_money russia 2147483647
		add_money russia -2147483647
		add_money russia 101
		set_counter freeze_russia 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 11
		add_money kievan_rus 2147483647
		add_money kievan_rus 2147483647
		add_money kievan_rus -2147483647
		add_money kievan_rus 101
		set_counter freeze_kievan_rus 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 12
		add_money venice 2147483647
		add_money venice 2147483647
		add_money venice -2147483647
		add_money venice 101
		set_counter freeze_venice 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 13
		add_money sicily 2147483647
		add_money sicily 2147483647
		add_money sicily -2147483647
		add_money sicily 101
		set_counter freeze_sicily 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 14
		add_money milan 2147483647
		add_money milan 2147483647
		add_money milan -2147483647
		add_money milan 101
		set_counter freeze_milan 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 15
		add_money denmark 2147483647
		add_money denmark 2147483647
		add_money denmark -2147483647
		add_money denmark 101
		set_counter freeze_denmark 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 16
		add_money scotland 2147483647
		add_money scotland 2147483647
		add_money scotland -2147483647
		add_money scotland 101
		set_counter freeze_scotland 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 17
		add_money france 2147483647
		add_money france 2147483647
		add_money france -2147483647
		add_money france 101
		set_counter freeze_france 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 18
		add_money hre 2147483647
		add_money hre 2147483647
		add_money hre -2147483647
		add_money hre 101
		set_counter freeze_hre 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 19
		add_money england 2147483647
		add_money england 2147483647
		add_money england -2147483647
		add_money england 101
		set_counter freeze_england 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 20
		add_money portugal 2147483647
		add_money portugal 2147483647
		add_money portugal -2147483647
		add_money portugal 101
		set_counter freeze_portugal 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 21
		add_money poland 2147483647
		add_money poland 2147483647
		add_money poland -2147483647
		add_money poland 101
		set_counter freeze_poland 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 22
		add_money spain 2147483647
		add_money spain 2147483647
		add_money spain -2147483647
		add_money spain 101
		set_counter freeze_spain 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 23
		add_money hungary 2147483647
		add_money hungary 2147483647
		add_money hungary -2147483647
		add_money hungary 101
		set_counter freeze_hungary 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 24
		add_money aragon 2147483647
		add_money aragon 2147483647
		add_money aragon -2147483647
		add_money aragon 101
		set_counter freeze_aragon 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 25
		add_money teutonic_order 2147483647
		add_money teutonic_order 2147483647
		add_money teutonic_order -2147483647
		add_money teutonic_order 101
		set_counter freeze_teutonic_order 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 26
		add_money norway 2147483647
		add_money norway 2147483647
		add_money norway -2147483647
		add_money norway 101
		set_counter freeze_norway 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 27
		add_money jerusalem 2147483647
		add_money jerusalem 2147483647
		add_money jerusalem -2147483647
		add_money jerusalem 101
		set_counter freeze_jerusalem 0
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter turn_fid = 28
		add_money papal_states 2147483647
		add_money papal_states 2147483647
		add_money papal_states -2147483647
		add_money papal_states 101
		set_counter freeze_papal_states 0
		set_event_counter freeze_recr_pool 1
	end_if
end_monitor

; Poor AI faction
monitor_event PreFactionTurnStart IsFactionAIControlled
	and not FactionType slave
	and Treasury < 10000
	and I_EventCounter freeze_recr_pool = 0

	if I_CompareCounter turn_fid = 1
	and I_CompareCounter freeze_egypt = 1
		if not I_FactionBesieged egypt
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_egypt 0
	end_if
	if I_CompareCounter turn_fid = 2
	and I_CompareCounter freeze_turks = 1
		if not I_FactionBesieged turks
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_turks 0
	end_if
	if I_CompareCounter turn_fid = 3
	and I_CompareCounter freeze_timurids = 1
		if not I_FactionBesieged timurids
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_timurids 0
	end_if
	if I_CompareCounter turn_fid = 4
	and I_CompareCounter freeze_kwarezm = 1
		if not I_FactionBesieged kwarezm
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_kwarezm 0
	end_if
	if I_CompareCounter turn_fid = 5
	and I_CompareCounter freeze_moors = 1
		if not I_FactionBesieged moors
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_moors 0
	end_if
	if I_CompareCounter turn_fid = 6
	and I_CompareCounter freeze_lithuania = 1
		if not I_FactionBesieged lithuania
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_lithuania 0
	end_if
	if I_CompareCounter turn_fid = 7
	and I_CompareCounter freeze_cumans = 1
		if not I_FactionBesieged cumans
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_cumans 0
	end_if
	if I_CompareCounter turn_fid = 8
	and I_CompareCounter freeze_mongols = 1
		if not I_FactionBesieged mongols
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_mongols 0
	end_if
	if I_CompareCounter turn_fid = 9
	and I_CompareCounter freeze_byzantium = 1
		if not I_FactionBesieged byzantium
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_byzantium 0
	end_if
	if I_CompareCounter turn_fid = 10
	and I_CompareCounter freeze_russia = 1
		if not I_FactionBesieged russia
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_russia 0
	end_if
	if I_CompareCounter turn_fid = 11
	and I_CompareCounter freeze_kievan_rus = 1
		if not I_FactionBesieged kievan_rus
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_kievan_rus 0
	end_if
	if I_CompareCounter turn_fid = 12
	and I_CompareCounter freeze_venice = 1
		if not I_FactionBesieged venice
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_venice 0
	end_if
	if I_CompareCounter turn_fid = 13
	and I_CompareCounter freeze_sicily = 1
		if not I_FactionBesieged sicily
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_sicily 0
	end_if
	if I_CompareCounter turn_fid = 14
	and I_CompareCounter freeze_milan = 1
		if not I_FactionBesieged milan
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_milan 0
	end_if
	if I_CompareCounter turn_fid = 15
	and I_CompareCounter freeze_denmark = 1
		if not I_FactionBesieged denmark
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_denmark 0
	end_if
	if I_CompareCounter turn_fid = 16
	and I_CompareCounter freeze_scotland = 1
		if not I_FactionBesieged scotland
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_scotland 0
	end_if
	if I_CompareCounter turn_fid = 17
	and I_CompareCounter freeze_france = 1
		if not I_FactionBesieged france
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_france 0
	end_if
	if I_CompareCounter turn_fid = 18
	and I_CompareCounter freeze_hre = 1
		if not I_FactionBesieged hre
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_hre 0
	end_if
	if I_CompareCounter turn_fid = 19
	and I_CompareCounter freeze_england = 1
		if not I_FactionBesieged england
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_england 0
	end_if
	if I_CompareCounter turn_fid = 20
	and I_CompareCounter freeze_portugal = 1
		if not I_FactionBesieged portugal
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_portugal 0
	end_if
	if I_CompareCounter turn_fid = 21
	and I_CompareCounter freeze_poland = 1
		if not I_FactionBesieged poland
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_poland 0
	end_if
	if I_CompareCounter turn_fid = 22
	and I_CompareCounter freeze_spain = 1
		if not I_FactionBesieged spain
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_spain 0
	end_if
	if I_CompareCounter turn_fid = 23
	and I_CompareCounter freeze_hungary = 1
		if not I_FactionBesieged hungary
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_hungary 0
	end_if
	if I_CompareCounter turn_fid = 24
	and I_CompareCounter freeze_aragon = 1
		if not I_FactionBesieged aragon
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_aragon 0
	end_if
	if I_CompareCounter turn_fid = 25
	and I_CompareCounter freeze_teutonic_order = 1
		if not I_FactionBesieged teutonic_order
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_teutonic_order 0
	end_if
	if I_CompareCounter turn_fid = 26
	and I_CompareCounter freeze_norway = 1
		if not I_FactionBesieged norway
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_norway 0
	end_if
	if I_CompareCounter turn_fid = 27
	and I_CompareCounter freeze_jerusalem = 1
		if not I_FactionBesieged jerusalem
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_jerusalem 0
	end_if
	if I_CompareCounter turn_fid = 28
	and I_CompareCounter freeze_papal_states = 1
		if not I_FactionBesieged papal_states
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_papal_states 0
	end_if
end_monitor

;========================================================
;==================== PLAYER PART =======================
;========================================================

;============== FACTION KILLER WORKAROUND ===============
;This script is linked with EDCT and "Reset counters"

monitor_event CeasedFactionLeader not FactionType papal_states
	and FactionHasRank
	inc_event_counter killed_factions_count 1
end_monitor

monitor_event BecomesFactionLeader not FactionType papal_states
	and FactionHasRank ; to filter (re)emerging factions

	inc_event_counter killed_factions_count -1
end_monitor

;================== BESIEGE UPKEEP ======================
monitor_event CharacterTurnStart CharacterIsLocal
	and Trait ArmyCost > 0

	if I_TurnNumber < 20
	;if I_EventCounter Campaign_Year < 1240
	console_command add_money -150
	end_if

	if I_TurnNumber >= 20
	and I_TurnNumber < 40
	;if I_EventCounter Campaign_Year >= 1240
	;and I_EventCounter Campaign_Year < 1260
	console_command add_money -210
	end_if

	if I_TurnNumber >= 40
	and I_TurnNumber < 80
	;if I_EventCounter Campaign_Year >= 1260
	;and I_EventCounter Campaign_Year < 1300
	console_command add_money -300
	end_if

	if I_TurnNumber >= 80
	;if I_EventCounter Campaign_Year >= 1300
	console_command add_money -400
	end_if

end_monitor

;==================== Setup Events ======================
;-- Mongol invasion
monitor_event FactionTurnStart FactionIsLocal
	historic_event mongols_invasion_warn factions { england , france , hre , denmark , spain , aragon , portugal , milan , venice , sicily , norway , scotland , cumans , byzantium , russia , moors , turks , egypt , poland , hungary , lithuania , kievan_rus , teutonic_order , jerusalem , }
	historic_event mongols_invasion_warn_mongols factions { mongols , }
	historic_event mongols_invasion_warn_kwarezm factions { kwarezm , }
	add_events
		event	counter	mongols_invasion_warn
		date	0
		event	counter	mongols_emerged
		date	0
		event	counter	the_mongols_emerge_video
		date	2
	end_add_events
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType the_mongols_emerge_video
	and EventCounter = 1
	historic_event the_mongols_emerge event/mongols_invade.bik factions { england , france , hre , denmark , spain , aragon , portugal , milan , venice , sicily , norway , scotland , cumans , byzantium , russia , moors , turks , egypt , poland , hungary , lithuania , kievan_rus , teutonic_order , jerusalem , }
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal

	if I_EventCounter DifficultyLevel >= 3
		if I_LocalFaction hre
			console_command give_trait hre4leader Offensive_To_Nobles 1
			console_command diplomatic_stance hre papal_states war
		end_if

		if I_LocalFaction venice
			console_command diplomatic_stance venice byzantium war
		end_if

		if I_LocalFaction byzantium
			console_command diplomatic_stance byzantium venice war
			console_command diplomatic_stance byzantium turks war
		end_if

		if I_LocalFaction moors
			console_command diplomatic_stance moors spain war
			console_command diplomatic_stance moors aragon war
			console_command diplomatic_stance moors portugal war
		end_if

		if I_LocalFaction turks
			console_command diplomatic_stance turks byzantium war
		end_if

		if I_LocalFaction lithuania
			console_command diplomatic_stance teutonic_order lithuania war
		end_if

		if I_LocalFaction teutonic_order
			console_command diplomatic_stance teutonic_order lithuania war
		end_if
	end_if
	
	;Historical Sicily Script
		send_character_off_map sicily4leader
		destroy_units sicily Pikemen
	;	if I_IsFactionAIControlled sicily
	;		give_everything_to_faction sicily hre false
	;	end_if

	terminate_monitor
end_monitor

;Royal Blood Workaround and Faction Killer special cases with child faction leaders/heirs
declare_counter royal_blood_aragon
declare_counter royal_blood_england
declare_counter royal_blood_england2
declare_counter royal_blood_england3
declare_counter royal_blood_sicily
declare_counter royal_blood_sicily2
declare_counter royal_blood_sicily3
;
declare_counter hre_sicily_sync
declare_counter sicily_died
declare_counter aragon_died
declare_counter denmark_died
declare_counter hre_died
declare_counter england_died
declare_counter portugal_died
declare_counter lithuania_died
declare_counter jerusalem_died
declare_counter FK_special
monitor_event PreFactionTurnStart I_CompareCounter campaign_year <= 1233
	set_counter FK_special 0
	if I_CompareCounter campaign_year >= 1222
	and I_CompareCounter royal_blood_aragon = 0
		console_command give_trait "Jaume Ramirez" Royal_Blood_Aragonese 1
		set_counter royal_blood_aragon 1
	end_if
	if I_EventCounter blood_workaround >= 1223
	and I_CompareCounter royal_blood_england = 0
		console_command give_trait "Richard Plantagenet" Royal_Blood_English 1
		set_counter royal_blood_england 1
	end_if
	if I_EventCounter blood_workaround >= 1224
	and I_CompareCounter royal_blood_england2 = 0
		console_command give_trait "Joan Plantagenet" Princess_Royal_Blood_English 1
		set_counter royal_blood_england2 1
	end_if
	if I_CompareCounter campaign_year >= 1225
	and I_CompareCounter royal_blood_sicily = 0
		console_command give_trait "Enrico de_Svevia" Royal_Blood_Sicilian 1
		set_counter royal_blood_sicily 1
	end_if
	if I_CompareCounter campaign_year >= 1228
	and I_CompareCounter royal_blood_england3 = 0
		console_command give_trait "Isabella Plantagenet" Princess_Royal_Blood_English 1
		set_counter royal_blood_england3 1
	end_if
	if I_CompareCounter campaign_year >= 1229
	and I_CompareCounter royal_blood_sicily2 = 0
		console_command give_trait "Enzo de_Svevia" Royal_Blood_Sicilian 1
		console_command give_trait "Enzo de_Svevia" BastardSon 1
		set_counter royal_blood_sicily2 1
	end_if
	if I_EventCounter blood_workaround >= 1230
	and I_CompareCounter royal_blood_sicily3 = 0
		console_command give_trait "Caterina de_Svevia" Princess_Royal_Blood_Sicily 1
		console_command give_trait "Caterina de_Svevia" BastardDaughter 1
		set_counter royal_blood_sicily3 1
	end_if
	if I_CompareCounter turn_fid = 0
	and I_CompareCounter campaign_year = 1233
		terminate_monitor
	end_if
end_monitor
monitor_event CeasedFactionLeader CharFactionType sicily
	if I_CompareCounter campaign_year > 1225
	and I_CompareCounter hre_sicily_sync = 1
		terminate_monitor
	end_if
	if I_CompareCounter campaign_year <= 1225
		set_counter sicily_died 1
	end_if
	;Hre-Sicily Leader death sync
	if I_CompareCounter hre_sicily_sync < 1
		set_counter hre_sicily_sync 1
		console_command kill_character "Frederick von_Hohenstaufen"
	end_if
end_monitor
monitor_event CeasedFactionLeader CharFactionType denmark
	if I_CompareCounter campaign_year > 1223
		terminate_monitor
	end_if
	set_counter denmark_died 1
end_monitor
monitor_event CeasedFactionLeader CharFactionType hre
	if I_CompareCounter campaign_year > 1225
	and I_CompareCounter hre_sicily_sync = 1
		terminate_monitor
	end_if
	if I_CompareCounter campaign_year <= 1225
		set_counter hre_died 1
	end_if
	;Hre-Sicily Leader death sync
	if I_CompareCounter hre_sicily_sync < 1
		set_counter hre_sicily_sync 1
		console_command kill_character "Federico de_Svevia"
	end_if
end_monitor
monitor_event CeasedFactionLeader CharFactionType england
	if I_CompareCounter campaign_year > 1223
		terminate_monitor
	end_if
	set_counter england_died 1
end_monitor
monitor_event CeasedFactionLeader CharFactionType portugal
	if I_CompareCounter campaign_year > 1223
		terminate_monitor
	end_if
	set_counter portugal_died 1
end_monitor
monitor_event CeasedFactionLeader CharFactionType lithuania
	if I_CompareCounter campaign_year > 1233
		terminate_monitor
	end_if
	set_counter lithuania_died 1
end_monitor
monitor_event CeasedFactionLeader CharFactionType jerusalem
	if I_CompareCounter campaign_year > 1230
		terminate_monitor
	end_if
	set_counter jerusalem_died 1
end_monitor
monitor_event CharacterTurnEnd I_CompareCounter FK_special < 1
	if I_CompareCounter campaign_year >= 1233
	and I_CompareCounter turn_fid = 0
		terminate_monitor
	end_if
	set_counter FK_special 1
	if I_CompareCounter lithuania_died = 1
	and I_CompareCounter campaign_year <= 1233
	and I_NumberOfSettlements lithuania >= 1
		set_counter lithuania_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute lithuania Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter jerusalem_died = 1
	and I_CompareCounter campaign_year <= 1230
	and I_NumberOfSettlements jerusalem >= 1
		set_counter jerusalem_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute jerusalem Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter sicily_died = 1
	and I_CompareCounter campaign_year > 1100
	and I_CompareCounter campaign_year <= 1225
	and I_NumberOfSettlements sicily >= 1
		set_counter sicily_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute sicily Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter hre_died = 1
	and I_CompareCounter campaign_year <= 1225
	and I_NumberOfSettlements hre >= 1
		set_counter hre_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute hre Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter denmark_died = 1
	and I_CompareCounter campaign_year <= 1223
	and I_NumberOfSettlements denmark >= 1
		set_counter denmark_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute denmark Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter england_died = 1
	and I_CompareCounter campaign_year <= 1223
	and I_NumberOfSettlements england >= 1
		set_counter england_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute england Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	if I_CompareCounter portugal_died = 1
	and I_CompareCounter campaign_year <= 1223
	and I_NumberOfSettlements portugal >= 1
		set_counter portugal_died 0
		inc_event_counter killed_factions_count -1
		if I_FactionLeaderAttribute portugal Command < 999
			inc_event_counter killed_factions_count 1
		end_if
	end_if
	;Factions Destroyed while Child Leaders
	if I_CompareCounter campaign_year <= 1222
	and I_CompareCounter aragon_died < 1
	and I_NumberOfSettlements aragon < 1
		set_counter aragon_died 1
		inc_event_counter killed_factions_count 1
	end_if
	;if I_CompareCounter campaign_year <= 1229
	;and I_CompareCounter sicily_died < 1
	;and I_NumberOfSettlements sicily < 1
	;	set_counter sicily_died 1
	;	inc_event_counter killed_factions_count 1
	;end_if
end_monitor
;End of Royal Blood Workaround and Faction Killer special cases

;==================== City Reveal =======================
monitor_event FactionTurnStart FactionReligion catholic

	reveal_tile 330,74	;Jerusalem
	reveal_tile 169,146	;Rome 
	reveal_tile 37,152	;Leon - Santiago
	hide_all_revealed_tiles
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionReligion orthodox

	reveal_tile 330,74	;Jerusalem
	reveal_tile 284,142	;Constantinople
	hide_all_revealed_tiles
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionReligion islam

	reveal_tile 330,74	;Jerusalem
	reveal_tile 416,94	;Baghdad
	reveal_tile 359,23	;Medina
	reveal_tile 360,6	;Mecca
	hide_all_revealed_tiles
terminate_monitor
end_monitor

;==================== Major Events ====================== 
;--- Jerusalem Captured
monitor_event GeneralCaptureSettlement SettlementName Jerusalem
    and not CharacterReligion islam
    and not CharacterReligion pagan
    and not CharacterReligion heretic
    and not TargetFactionReligion catholic
    and not TargetFactionReligion orthodox

    historic_event jerusalem_christian event/Christians_Capture_Jerusalem.bik
terminate_monitor
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion islam

	historic_event jerusalem_muslim event/Muslims_Capture_Jerusalem.bik
terminate_monitor
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion pagan
	and not FactionIsLocal

	historic_event jerusalem_pagan
terminate_monitor
end_monitor

;--- World is round 
monitor_event EventCounter EventCounterType world_is_round
	and EventCounter > 0

	historic_event america_discovered event/america_discovered.bik
terminate_monitor
end_monitor

;-- Player built first great temple
monitor_event BuildingCompleted not IsFactionAIControlled
	and SettlementBuildingFinished = huge_cathedral

	historic_event player_first_huge_cathedral event/huge_cathedral_built.bik
terminate_monitor
end_monitor

monitor_event BuildingCompleted not IsFactionAIControlled
	and SettlementBuildingFinished = great_jama

	historic_event player_first_great_jama event/great_mosque_created.bik
terminate_monitor
end_monitor

;-- Can notre_dame be built?
set_event_counter notre_dame 1

;-- Capital Change
monitor_event FactionNewCapital not IsFactionAIControlled

	if I_EventCounter DifficultyLevel = 1
		terminate_monitor
	end_if

	if not I_HotseatEnabled
		historic_event capital_change
	end_if

 if I_HotseatEnabled
	if I_LocalFaction egypt
  historic_event capital_change false factions { egypt, }
	end_if
	if I_LocalFaction turks
  historic_event capital_change false factions { turks, }
	end_if
	if I_LocalFaction timurids
  historic_event capital_change false factions { timurids, }
	end_if
	if I_LocalFaction kwarezm
  historic_event capital_change false factions { kwarezm, }
	end_if
	if I_LocalFaction moors
  historic_event capital_change false factions { moors, }
	end_if
	if I_LocalFaction lithuania
  historic_event capital_change false factions { lithuania, }
	end_if
	if I_LocalFaction cumans
  historic_event capital_change false factions { cumans, }
	end_if
	if I_LocalFaction mongols
  historic_event capital_change false factions { mongols, }
	end_if
	if I_LocalFaction byzantium
  historic_event capital_change false factions { byzantium, }
	end_if
	if I_LocalFaction russia
  historic_event capital_change false factions { russia, }
	end_if
	if I_LocalFaction kievan_rus
  historic_event capital_change false factions { kievan_rus, }
	end_if
	if I_LocalFaction venice
  historic_event capital_change false factions { venice, }
	end_if
	if I_LocalFaction sicily
  historic_event capital_change false factions { sicily, }
	end_if
	if I_LocalFaction milan
  historic_event capital_change false factions { milan, }
	end_if
	if I_LocalFaction denmark
  historic_event capital_change false factions { denmark, }
	end_if
	if I_LocalFaction scotland
  historic_event capital_change false factions { scotland, }
	end_if
	if I_LocalFaction france
  historic_event capital_change false factions { france, }
	end_if
	if I_LocalFaction hre
  historic_event capital_change false factions { hre, }
	end_if
	if I_LocalFaction england
  historic_event capital_change false factions { england, }
	end_if
	if I_LocalFaction portugal
  historic_event capital_change false factions { portugal, }
	end_if
	if I_LocalFaction poland
  historic_event capital_change false factions { poland, }
	end_if
	if I_LocalFaction spain
  historic_event capital_change false factions { spain, }
	end_if
	if I_LocalFaction hungary
  historic_event capital_change false factions { hungary, }
	end_if
	if I_LocalFaction aragon
  historic_event capital_change false factions { aragon, }
	end_if
	if I_LocalFaction teutonic_order
  historic_event capital_change false factions { teutonic_order, }
	end_if
	if I_LocalFaction norway
  historic_event capital_change false factions { norway, }
	end_if
	if I_LocalFaction jerusalem
  historic_event capital_change false factions { jerusalem, }
	end_if
	if I_LocalFaction papal_states
  historic_event capital_change false factions { papal_states, }
	end_if
 end_if

	if I_EventCounter DifficultyLevel = 2
		console_command add_money -2000
	end_if

	if I_EventCounter DifficultyLevel > 2
		console_command add_money -5000
	end_if

end_monitor

;============== Teutonic Order Death Workaround =================

;---- Teutonic Order Faction Destroyed Workaround ----
;OBSOLETE
;monitor_event FactionTurnEnd FactionType slave
;	and I_NumberOfSettlements teutonic_order < 1
;	and I_EventCounter status_teutonic_order = 1;References faction killer workaround
;		console_command kill_faction teutonic_order
;		;terminate_monitor; disabled for re-emerging
;end_monitor

;================= Player Notification ==================
;--- Death of Leaders
monitor_event BecomesFactionLeader FactionType moors
	and Trait FactionFutureRegent = 0

	historic_event moors_king_event factions { turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType moors
	and Trait FactionFutureRegent = 1

	historic_event moors_regent_event factions { turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType portugal
	and Trait FactionFutureRegent = 0

	historic_event portugal_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType portugal
	and Trait FactionFutureRegent = 1

	historic_event portugal_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType spain
	and Trait FactionFutureRegent = 0

	historic_event spain_king_event factions { moors, turks, egypt, kwarezm, aragon, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType spain
	and Trait FactionFutureRegent = 1

	historic_event spain_regent_event factions { moors, turks, egypt, kwarezm, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType turks
	and Trait FactionFutureRegent = 0

	historic_event turks_king_event factions { moors, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType turks
	and Trait FactionFutureRegent = 1

	historic_event turks_regent_event factions { moors, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType egypt
	and Trait FactionFutureRegent = 0

	historic_event egypt_king_event factions { moors, turks, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType egypt
	and Trait FactionFutureRegent = 1

	historic_event egypt_regent_event factions { moors, turks, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType byzantium
	and Trait FactionFutureRegent = 0

	historic_event byzantium_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType byzantium
	and Trait FactionFutureRegent = 1

	historic_event byzantium_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType russia
	and Trait FactionFutureRegent = 0

	historic_event russia_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType russia
	and Trait FactionFutureRegent = 1

	historic_event russia_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType poland
	and Trait FactionFutureRegent = 0

	historic_event poland_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType poland
	and Trait FactionFutureRegent = 1

	historic_event poland_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType lithuania
	and Trait FactionFutureRegent = 0

	historic_event lithuania_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType lithuania
	and Trait FactionFutureRegent = 1

	historic_event lithuania_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType hungary
	and Trait FactionFutureRegent = 0

	historic_event hungary_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType hungary
	and Trait FactionFutureRegent = 1

	historic_event hungary_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType hre
	and Trait FactionFutureRegent = 0

	historic_event hre_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType hre
	and Trait FactionFutureRegent = 1

	historic_event hre_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType france
	and Trait FactionFutureRegent = 0

	historic_event france_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType france
	and Trait FactionFutureRegent = 1

	historic_event france_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType england
	and Trait FactionFutureRegent = 0

	historic_event england_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType england
	and Trait FactionFutureRegent = 1

	historic_event england_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType scotland
	and Trait FactionFutureRegent = 0

	historic_event scotland_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType scotland
	and Trait FactionFutureRegent = 1

	historic_event scotland_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType venice
	and Trait FactionFutureRegent = 0

	historic_event venice_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType venice
	and Trait FactionFutureRegent = 1

	historic_event venice_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType milan
	and Trait FactionFutureRegent = 0

	historic_event milan_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType milan
	and Trait FactionFutureRegent = 1

	historic_event milan_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType sicily
	and Trait FactionFutureRegent = 0

	historic_event sicily_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType sicily
	and Trait FactionFutureRegent = 1

	historic_event sicily_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType jerusalem
	and Trait FactionFutureRegent = 0

	historic_event jerusalem_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType jerusalem
	and Trait FactionFutureRegent = 1

	historic_event jerusalem_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType kievan_rus
	and Trait FactionFutureRegent = 0

	historic_event kievan_rus_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType kievan_rus
	and Trait FactionFutureRegent = 1

	historic_event kievan_rus_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType aragon
	and Trait FactionFutureRegent = 0

	historic_event aragon_king_event factions { moors, turks, egypt, kwarezm, spain, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType aragon
	and Trait FactionFutureRegent = 1

	historic_event aragon_regent_event factions { moors, turks, egypt, kwarezm, spain, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType denmark
	and Trait FactionFutureRegent = 0

	historic_event denmark_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType denmark
	and Trait FactionFutureRegent = 1

	historic_event denmark_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType norway
	and Trait FactionFutureRegent = 0

	historic_event norway_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType norway
	and Trait FactionFutureRegent = 1

	historic_event norway_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType teutonic_order
	and I_CompareCounter teutonic_king  = 1

	historic_event teutonic_order_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType kwarezm
	and Trait FactionFutureRegent = 0

	historic_event kwarezm_king_event factions { moors, turks, egypt, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType kwarezm
	and Trait FactionFutureRegent = 1

	historic_event kwarezm_regent_event factions { moors, turks, egypt, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType cumans
	and Trait FactionFutureRegent = 0

	historic_event cumans_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType cumans
	and Trait FactionFutureRegent = 1

	historic_event cumans_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, mongols, }

end_monitor

declare_counter timurids_king
monitor_event CeasedFactionLeader FactionType timurids

	set_counter timurids_king 1
terminate_monitor
end_monitor
monitor_event BecomesFactionLeader FactionType timurids
	and Trait FactionFutureRegent = 0
	and I_CompareCounter timurids_king = 1

	historic_event timurids_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor
monitor_event BecomesFactionLeader FactionType timurids
	and Trait FactionFutureRegent = 1
	and I_CompareCounter timurids_king = 1

	historic_event timurids_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, mongols, }

end_monitor

monitor_event BecomesFactionLeader FactionType mongols
	and Trait FactionFutureRegent = 0

	historic_event mongols_king_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, }

end_monitor
monitor_event BecomesFactionLeader FactionType mongols
	and Trait FactionFutureRegent = 1

	historic_event mongols_regent_event factions { moors, turks, egypt, kwarezm, spain, aragon, portugal, venice, milan, sicily, byzantium, hre, france, england, scotland, denmark, norway, poland, hungary, jerusalem, teutonic_order, russia, kievan_rus, lithuania, cumans, }

end_monitor

;================= Interactive Events ===================
; --- Interactive Events counter reset
monitor_event FactionTurnEnd not IsFactionAIControlled
	set_event_counter great_fair_accepted 0
	set_event_counter great_fair_declined 0
	set_event_counter great_fair_counter 0
	set_event_counter great_tourney_accepted 0
	set_event_counter great_tourney_declined 0
	set_event_counter troubadours_event_accepted 0
	set_event_counter troubadours_event_declined 0
	set_event_counter great_council_accepted 0
	set_event_counter great_council_declined 0
end_monitor

declare_counter awaiting_answer_ie
monitor_event GameReloaded I_CompareCounter awaiting_answer_ie > 0
	if I_EventCounter great_fair_counter = 2
		set_event_counter great_fair_counter 1
	end_if
	if I_EventCounter great_tourney_counter = 2
		set_event_counter great_tourney_counter 1
	end_if
	if I_EventCounter troubadours_event_counter = 2
		set_event_counter troubadours_event_counter 1
	end_if
	if I_EventCounter great_council_counter = 2
		set_event_counter great_council_counter 1
	end_if
	if I_EventCounter pirates_counter = 2
		set_event_counter pirates_counter 1
	end_if
end_monitor

;--- Great Trade Fair 
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > fairground
	and RandomPercent < 10
	and I_TurnNumber > 10
	;and I_CompareCounter campaign_year > 1230
	
	set_event_counter great_fair_counter 1
	
end_monitor
monitor_event EventCounter EventCounterType great_fair_counter
	and EventCounter = 1
		inc_counter awaiting_answer_ie 1
		set_event_counter great_fair_counter 2
	if not I_HotseatEnabled
		historic_event great_fair true
	end_if
	if I_HotseatEnabled
		if I_CompareCounter turn_fid = 1
			historic_event great_fair true factions { egypt, }
		end_if
		if I_CompareCounter turn_fid = 2
			historic_event great_fair true factions { turks, }
		end_if
		;if I_CompareCounter turn_fid = 3
		;	historic_event great_fair true factions { timurids, }
		;end_if
		if I_CompareCounter turn_fid = 4
			historic_event great_fair true factions { kwarezm, }
		end_if
		if I_CompareCounter turn_fid = 5
			historic_event great_fair true factions { moors, }
		end_if
		if I_CompareCounter turn_fid = 6
			historic_event great_fair true factions { lithuania, }
		end_if
		if I_CompareCounter turn_fid = 7
			historic_event great_fair true factions { cumans, }
		end_if
		if I_CompareCounter turn_fid = 8
			historic_event great_fair true factions { mongols, }
		end_if
		if I_CompareCounter turn_fid = 9
			historic_event great_fair true factions { byzantium, }
		end_if
		if I_CompareCounter turn_fid = 10
			historic_event great_fair true factions { russia, }
		end_if
		if I_CompareCounter turn_fid = 11
			historic_event great_fair true factions { kievan_rus, }
		end_if
		if I_CompareCounter turn_fid = 12
			historic_event great_fair true factions { venice, }
		end_if
		if I_CompareCounter turn_fid = 13
			historic_event great_fair true factions { sicily, }
		end_if
		if I_CompareCounter turn_fid = 14
			historic_event great_fair true factions { milan, }
		end_if
		if I_CompareCounter turn_fid = 15
			historic_event great_fair true factions { denmark, }
		end_if
		if I_CompareCounter turn_fid = 16
			historic_event great_fair true factions { scotland, }
		end_if
		if I_CompareCounter turn_fid = 17
			historic_event great_fair true factions { france, }
		end_if
		if I_CompareCounter turn_fid = 18
			historic_event great_fair true factions { hre, }
		end_if
		if I_CompareCounter turn_fid = 19
			historic_event great_fair true factions { england, }
		end_if
		if I_CompareCounter turn_fid = 20
			historic_event great_fair true factions { portugal, }
		end_if
		if I_CompareCounter turn_fid = 21
			historic_event great_fair true factions { poland, }
		end_if
		if I_CompareCounter turn_fid = 22
			historic_event great_fair true factions { spain, }
		end_if
		if I_CompareCounter turn_fid = 23
			historic_event great_fair true factions { hungary, }
		end_if
		if I_CompareCounter turn_fid = 24
			historic_event great_fair true factions { aragon, }
		end_if
		if I_CompareCounter turn_fid = 25
			historic_event great_fair true factions { teutonic_order, }
		end_if
		if I_CompareCounter turn_fid = 26
			historic_event great_fair true factions { norway, }
		end_if
		if I_CompareCounter turn_fid = 27
			historic_event great_fair true factions { jerusalem, }
		end_if
		;if I_CompareCounter turn_fid = 28
		;	historic_event great_fair true factions { papal_states, }
		;end_if
	end_if
end_monitor

monitor_event EventCounter EventCounterType great_fair_accepted
	and EventCounter = 1
	console_command add_money -2500
	set_event_counter great_fair_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

monitor_event EventCounter EventCounterType great_fair_declined
	and EventCounter = 1
	set_event_counter great_fair_counter 0
	inc_counter awaiting_answer_ie -1
	log always *** GREAT FAIR DECLINED TEST PRINT ***
end_monitor

;--- Great Tourney 
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > jousting_lists
	and RandomPercent < 10
	and I_TurnNumber > 10
	;and I_CompareCounter campaign_year > 1230
	
	set_event_counter great_tourney_counter 1
	
end_monitor
monitor_event EventCounter EventCounterType great_tourney_counter
	and EventCounter = 1
		inc_counter awaiting_answer_ie 1
		set_event_counter great_tourney_counter 2
	if not I_HotseatEnabled
		historic_event great_tourney true
	end_if
	if I_HotseatEnabled
		if I_CompareCounter turn_fid = 1
			historic_event great_tourney true factions { egypt, }
		end_if
		if I_CompareCounter turn_fid = 2
			historic_event great_tourney true factions { turks, }
		end_if
		;if I_CompareCounter turn_fid = 3
		;	historic_event great_tourney true factions { timurids, }
		;end_if
		if I_CompareCounter turn_fid = 4
			historic_event great_tourney true factions { kwarezm, }
		end_if
		if I_CompareCounter turn_fid = 5
			historic_event great_tourney true factions { moors, }
		end_if
		if I_CompareCounter turn_fid = 6
			historic_event great_tourney true factions { lithuania, }
		end_if
		if I_CompareCounter turn_fid = 7
			historic_event great_tourney true factions { cumans, }
		end_if
		if I_CompareCounter turn_fid = 8
			historic_event great_tourney true factions { mongols, }
		end_if
		if I_CompareCounter turn_fid = 9
			historic_event great_tourney true factions { byzantium, }
		end_if
		if I_CompareCounter turn_fid = 10
			historic_event great_tourney true factions { russia, }
		end_if
		if I_CompareCounter turn_fid = 11
			historic_event great_tourney true factions { kievan_rus, }
		end_if
		if I_CompareCounter turn_fid = 12
			historic_event great_tourney true factions { venice, }
		end_if
		if I_CompareCounter turn_fid = 13
			historic_event great_tourney true factions { sicily, }
		end_if
		if I_CompareCounter turn_fid = 14
			historic_event great_tourney true factions { milan, }
		end_if
		if I_CompareCounter turn_fid = 15
			historic_event great_tourney true factions { denmark, }
		end_if
		if I_CompareCounter turn_fid = 16
			historic_event great_tourney true factions { scotland, }
		end_if
		if I_CompareCounter turn_fid = 17
			historic_event great_tourney true factions { france, }
		end_if
		if I_CompareCounter turn_fid = 18
			historic_event great_tourney true factions { hre, }
		end_if
		if I_CompareCounter turn_fid = 19
			historic_event great_tourney true factions { england, }
		end_if
		if I_CompareCounter turn_fid = 20
			historic_event great_tourney true factions { portugal, }
		end_if
		if I_CompareCounter turn_fid = 21
			historic_event great_tourney true factions { poland, }
		end_if
		if I_CompareCounter turn_fid = 22
			historic_event great_tourney true factions { spain, }
		end_if
		if I_CompareCounter turn_fid = 23
			historic_event great_tourney true factions { hungary, }
		end_if
		if I_CompareCounter turn_fid = 24
			historic_event great_tourney true factions { aragon, }
		end_if
		if I_CompareCounter turn_fid = 25
			historic_event great_tourney true factions { teutonic_order, }
		end_if
		if I_CompareCounter turn_fid = 26
			historic_event great_tourney true factions { norway, }
		end_if
		if I_CompareCounter turn_fid = 27
			historic_event great_tourney true factions { jerusalem, }
		end_if
		;if I_CompareCounter turn_fid = 28
		;	historic_event great_tourney true factions { papal_states, }
		;end_if
	end_if
end_monitor

monitor_event EventCounter EventCounterType great_tourney_accepted
	and EventCounter = 1
	console_command add_money -3000
	set_event_counter great_tourney_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

monitor_event EventCounter EventCounterType great_tourney_declined
	and EventCounter = 1
	set_event_counter great_tourney_counter 0
	inc_counter awaiting_answer_ie -1
	log always *** GREAT TOURNEY DECLINED TEST PRINT ***
end_monitor

;--- Troubadours
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > town_hall
	and RandomPercent < 5
	and I_TurnNumber > 10
	;and I_CompareCounter campaign_year > 1230
	
	set_event_counter troubadours_event_counter 1
	
end_monitor
monitor_event EventCounter EventCounterType troubadours_event_counter
	and EventCounter = 1
		inc_counter awaiting_answer_ie 1
		set_event_counter troubadours_event_counter 2
	if not I_HotseatEnabled
		historic_event troubadours_event true
	end_if
	if I_HotseatEnabled
		if I_CompareCounter turn_fid = 1
			historic_event troubadours_event true factions { egypt, }
		end_if
		if I_CompareCounter turn_fid = 2
			historic_event troubadours_event true factions { turks, }
		end_if
		;if I_CompareCounter turn_fid = 3
		;	historic_event troubadours_event true factions { timurids, }
		;end_if
		if I_CompareCounter turn_fid = 4
			historic_event troubadours_event true factions { kwarezm, }
		end_if
		if I_CompareCounter turn_fid = 5
			historic_event troubadours_event true factions { moors, }
		end_if
		if I_CompareCounter turn_fid = 6
			historic_event troubadours_event true factions { lithuania, }
		end_if
		if I_CompareCounter turn_fid = 7
			historic_event troubadours_event true factions { cumans, }
		end_if
		if I_CompareCounter turn_fid = 8
			historic_event troubadours_event true factions { mongols, }
		end_if
		if I_CompareCounter turn_fid = 9
			historic_event troubadours_event true factions { byzantium, }
		end_if
		if I_CompareCounter turn_fid = 10
			historic_event troubadours_event true factions { russia, }
		end_if
		if I_CompareCounter turn_fid = 11
			historic_event troubadours_event true factions { kievan_rus, }
		end_if
		if I_CompareCounter turn_fid = 12
			historic_event troubadours_event true factions { venice, }
		end_if
		if I_CompareCounter turn_fid = 13
			historic_event troubadours_event true factions { sicily, }
		end_if
		if I_CompareCounter turn_fid = 14
			historic_event troubadours_event true factions { milan, }
		end_if
		if I_CompareCounter turn_fid = 15
			historic_event troubadours_event true factions { denmark, }
		end_if
		if I_CompareCounter turn_fid = 16
			historic_event troubadours_event true factions { scotland, }
		end_if
		if I_CompareCounter turn_fid = 17
			historic_event troubadours_event true factions { france, }
		end_if
		if I_CompareCounter turn_fid = 18
			historic_event troubadours_event true factions { hre, }
		end_if
		if I_CompareCounter turn_fid = 19
			historic_event troubadours_event true factions { england, }
		end_if
		if I_CompareCounter turn_fid = 20
			historic_event troubadours_event true factions { portugal, }
		end_if
		if I_CompareCounter turn_fid = 21
			historic_event troubadours_event true factions { poland, }
		end_if
		if I_CompareCounter turn_fid = 22
			historic_event troubadours_event true factions { spain, }
		end_if
		if I_CompareCounter turn_fid = 23
			historic_event troubadours_event true factions { hungary, }
		end_if
		if I_CompareCounter turn_fid = 24
			historic_event troubadours_event true factions { aragon, }
		end_if
		if I_CompareCounter turn_fid = 25
			historic_event troubadours_event true factions { teutonic_order, }
		end_if
		if I_CompareCounter turn_fid = 26
			historic_event troubadours_event true factions { norway, }
		end_if
		if I_CompareCounter turn_fid = 27
			historic_event troubadours_event true factions { jerusalem, }
		end_if
		;if I_CompareCounter turn_fid = 28
		;	historic_event troubadours_event true factions { papal_states, }
		;end_if
	end_if
end_monitor

monitor_event EventCounter EventCounterType troubadours_event_accepted
	and EventCounter = 1
	console_command add_money -1000
	set_event_counter troubadours_event_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

monitor_event EventCounter EventCounterType troubadours_event_declined
	and EventCounter = 1
	set_event_counter troubadours_event_counter 0
	inc_counter awaiting_answer_ie -1
	log always *** TROUBADOURS DECLINED TEST PRINT ***
end_monitor

;--- Great Councils
declare_counter catholic_factions_counter
declare_counter had_council
set_counter had_council 0

monitor_event EventCounter EventCounterType lateran_council4
	and EventCounter > 0
	if not I_HotseatEnabled
		set_counter catholic_factions_counter 1
	end_if
	if I_HotseatEnabled
		if not I_IsFactionAIControlled venice
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled sicily
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled milan
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled denmark
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled scotland
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled france
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled hre
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled england
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled portugal
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled poland
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled spain
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled hungary
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled aragon
			inc_counter catholic_factions_counter 1
		end_if
		;if not I_IsFactionAIControlled teutonic_order
		;	inc_counter catholic_factions_counter 1
		;end_if
		if not I_IsFactionAIControlled norway
			inc_counter catholic_factions_counter 1
		end_if
		if not I_IsFactionAIControlled jerusalem
			inc_counter catholic_factions_counter 1
		end_if
		;if not I_IsFactionAIControlled papal_states
		;	inc_counter catholic_factions_counter 1
		;end_if
	end_if
	set_counter had_council 1
	terminate_monitor
end_monitor

monitor_event FactionTurnStart not IsFactionAIControlled
	and not FactionReligion islam
	and not FactionReligion pagan
	and I_CompareCounter had_council = 1
	
	set_event_counter great_council_counter 1
	
	inc_counter catholic_factions_counter -1
	if I_CompareCounter catholic_factions_counter < 1
		set_counter had_council 0
		terminate_monitor
	end_if
end_monitor
monitor_event EventCounter EventCounterType great_council_counter
	and EventCounter = 1
		inc_counter awaiting_answer_ie 1
		set_event_counter great_council_counter 2
	if not I_HotseatEnabled
		historic_event great_council true
	end_if
	if I_HotseatEnabled
		if I_CompareCounter turn_fid = 12
			historic_event great_council true factions { venice, }
		end_if
		if I_CompareCounter turn_fid = 13
			historic_event great_council true factions { sicily, }
		end_if
		if I_CompareCounter turn_fid = 14
			historic_event great_council true factions { milan, }
		end_if
		if I_CompareCounter turn_fid = 15
			historic_event great_council true factions { denmark, }
		end_if
		if I_CompareCounter turn_fid = 16
			historic_event great_council true factions { scotland, }
		end_if
		if I_CompareCounter turn_fid = 17
			historic_event great_council true factions { france, }
		end_if
		if I_CompareCounter turn_fid = 18
			historic_event great_council true factions { hre, }
		end_if
		if I_CompareCounter turn_fid = 19
			historic_event great_council true factions { england, }
		end_if
		if I_CompareCounter turn_fid = 20
			historic_event great_council true factions { portugal, }
		end_if
		if I_CompareCounter turn_fid = 21
			historic_event great_council true factions { poland, }
		end_if
		if I_CompareCounter turn_fid = 22
			historic_event great_council true factions { spain, }
		end_if
		if I_CompareCounter turn_fid = 23
			historic_event great_council true factions { hungary, }
		end_if
		if I_CompareCounter turn_fid = 24
			historic_event great_council true factions { aragon, }
		end_if
		if I_CompareCounter turn_fid = 25
			historic_event great_council true factions { teutonic_order, }
		end_if
		if I_CompareCounter turn_fid = 26
			historic_event great_council true factions { norway, }
		end_if
		if I_CompareCounter turn_fid = 27
			historic_event great_council true factions { jerusalem, }
		end_if
		;if I_CompareCounter turn_fid = 28
		;	historic_event great_council true factions { papal_states, }
		;end_if
	end_if
end_monitor

monitor_event EventCounter EventCounterType great_council_accepted
	and EventCounter = 1
	console_command add_money -1500
	set_event_counter great_council_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

monitor_event EventCounter EventCounterType great_council_declined
	and EventCounter = 1
	set_event_counter great_council_counter 0
	inc_counter awaiting_answer_ie -1
	log always *** GREAT COUNCIL DECLINED TEST PRINT ***
end_monitor

;--- Pirates
monitor_event FactionTurnStart not IsFactionAIControlled
	and Treasury > 75000
	and RandomPercent < 10
	and FactionBuildingExists >= port
	and I_TurnNumber > 10
	;and I_CompareCounter campaign_year > 1230
	
	set_event_counter pirates_counter 1
	
end_monitor
monitor_event EventCounter EventCounterType pirates_counter
	and EventCounter = 1
		inc_counter awaiting_answer_ie 1
		set_event_counter pirates_counter 2
	if not I_HotseatEnabled
		historic_event pirates true
	end_if
	if I_HotseatEnabled
		if I_CompareCounter turn_fid = 1
			historic_event pirates true factions { egypt, }
		end_if
		if I_CompareCounter turn_fid = 2
			historic_event pirates true factions { turks, }
		end_if
		;if I_CompareCounter turn_fid = 3
		;	historic_event pirates true factions { timurids, }
		;end_if
		if I_CompareCounter turn_fid = 4
			historic_event pirates true factions { kwarezm, }
		end_if
		if I_CompareCounter turn_fid = 5
			historic_event pirates true factions { moors, }
		end_if
		if I_CompareCounter turn_fid = 6
			historic_event pirates true factions { lithuania, }
		end_if
		if I_CompareCounter turn_fid = 7
			historic_event pirates true factions { cumans, }
		end_if
		if I_CompareCounter turn_fid = 8
			historic_event pirates true factions { mongols, }
		end_if
		if I_CompareCounter turn_fid = 9
			historic_event pirates true factions { byzantium, }
		end_if
		if I_CompareCounter turn_fid = 10
			historic_event pirates true factions { russia, }
		end_if
		if I_CompareCounter turn_fid = 11
			historic_event pirates true factions { kievan_rus, }
		end_if
		if I_CompareCounter turn_fid = 12
			historic_event pirates true factions { venice, }
		end_if
		if I_CompareCounter turn_fid = 13
			historic_event pirates true factions { sicily, }
		end_if
		if I_CompareCounter turn_fid = 14
			historic_event pirates true factions { milan, }
		end_if
		if I_CompareCounter turn_fid = 15
			historic_event pirates true factions { denmark, }
		end_if
		if I_CompareCounter turn_fid = 16
			historic_event pirates true factions { scotland, }
		end_if
		if I_CompareCounter turn_fid = 17
			historic_event pirates true factions { france, }
		end_if
		if I_CompareCounter turn_fid = 18
			historic_event pirates true factions { hre, }
		end_if
		if I_CompareCounter turn_fid = 19
			historic_event pirates true factions { england, }
		end_if
		if I_CompareCounter turn_fid = 20
			historic_event pirates true factions { portugal, }
		end_if
		if I_CompareCounter turn_fid = 21
			historic_event pirates true factions { poland, }
		end_if
		if I_CompareCounter turn_fid = 22
			historic_event pirates true factions { spain, }
		end_if
		if I_CompareCounter turn_fid = 23
			historic_event pirates true factions { hungary, }
		end_if
		if I_CompareCounter turn_fid = 24
			historic_event pirates true factions { aragon, }
		end_if
		if I_CompareCounter turn_fid = 25
			historic_event pirates true factions { teutonic_order, }
		end_if
		if I_CompareCounter turn_fid = 26
			historic_event pirates true factions { norway, }
		end_if
		if I_CompareCounter turn_fid = 27
			historic_event pirates true factions { jerusalem, }
		end_if
		;if I_CompareCounter turn_fid = 28
		;	historic_event pirates true factions { papal_states, }
		;end_if
	end_if
end_monitor

monitor_event EventCounter EventCounterType pirates_accepted
	and EventCounter = 1
	console_command add_money -5000
	set_event_counter pirates_accepted 0
	set_event_counter pirates_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

monitor_event EventCounter EventCounterType pirates_declined
	and EventCounter = 1
	if RandomPercent < 51
		console_command add_money -12000
	end_if
	set_event_counter pirates_declined 0
	set_event_counter pirates_counter 0
	inc_counter awaiting_answer_ie -1
end_monitor

;========================================================
;======= EMERGENT FACTIONS/NATIONAL UPRISINGS ===========
;========================================================

;============== William Wallace Uprising ================
add_events
	event	counter	WilliamWallaceSet
	date	60
end_add_events

declare_counter wallace_spawned
set_counter wallace_spawned 0

monitor_event FactionTurnStart FactionType scotland
	;and I_TurnNumber = 60
	and I_EventCounter WilliamWallaceSet = 1
	and I_NumberOfSettlements scotland < 4

	set_counter wallace_spawned 1
	
terminate_monitor
end_monitor
	
monitor_event FactionTurnStart FactionType scotland
	and I_NumberOfSettlements scotland < 2

	set_counter wallace_spawned 1

terminate_monitor
end_monitor

monitor_event GeneralCaptureSettlement FactionType england
	and TargetFactionType scotland

	set_counter wallace_spawned 1

terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType scotland
	and I_CompareCounter wallace_spawned = 1

	spawn_army 
		faction scotland
		;OLD;character	William Wallace, named character, age 20, x 55, y 253, direction SE, battle_model Wallace_General, portrait wallace, label scotland4wallace
		character	Uilliam Wallace, named character, age 20, x 56, y 252, direction SE, battle_model Wallace_General, portrait wallace, label scotland4wallace
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , ScotlandHero 1 , LoyaltyStarter 1, BattleChivalry 2 , Loyal 2 , Just 2 , Rabblerouser 3 , Hardened 1 , Upright 2 , Austere 2 
		unit		Highland Nobles	exp 4 armour 0 weapon_lvl 1
		unit		Highland Nobles	exp 2 armour 0 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highland Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 3 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 3 armour 1 weapon_lvl 0
		unit		Highland Nobles	exp 3 armour 0 weapon_lvl 1
		unit		Highland Nobles	exp 3 armour 0 weapon_lvl 1
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Highland Rabble	exp 3 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 3 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 4 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 4 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
	end	   

	spawn_army 
		faction scotland
		character	random_name, named character, age 26, x 54, y 254
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , LoyaltyStarter 1, BattleChivalry 2 , Loyal 2 , Just 2 , Rabblerouser 3 , Hardened 1 
		unit		Highland Nobles	exp 4 armour 0 weapon_lvl 1
		unit		Highland Nobles	exp 2 armour 0 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highland Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 3 armour 1 weapon_lvl 0
		unit		Highland Pikemen	exp 3 armour 1 weapon_lvl 0
		unit		Highland Nobles	exp 3 armour 0 weapon_lvl 1
		unit		Highland Nobles	exp 3 armour 0 weapon_lvl 1
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Noble Highland Archers	exp 1 armour 1 weapon_lvl 0
		unit		Highland Rabble	exp 3 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 3 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 4 armour 0 weapon_lvl 0
		unit		Highland Rabble	exp 4 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
	end

	historic_event scotland_wallace event/william_wallace.bik
	set_counter wallace_spawned 2
terminate_monitor
end_monitor

monitor_event CharacterTurnStart CharFactionType scotland
	and Trait ScotlandHero = 1
	and not I_SettlementOwner Edinburgh = scotland
	and I_IsFactionAIControlled scotland
	
	if I_AtSea scotland4wallace ; to avoid the case he lost a battle and retreated at a ship near Edinburg
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Edinburgh;if settlement under siege already, avoid ctd.
	and I_CompareCounter attack_edinburgh = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile scotland, named_character, 5, 59, 248 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Edinburgh
	and I_CompareCounter attack_edinburgh = 3
		siege_settlement scotland4wallace, Edinburgh, attack
		set_counter wallace_spawned 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Edinburgh
		siege_settlement scotland4wallace, Edinburgh, maintain
		set_counter wallace_spawned 3
	end_if
	
end_monitor

;============= END William Wallace Uprising ==============
;=============== Golden Horde Emergent ==================
	monitor_event EventCounter EventCounterType mongols_invasion_warn
		and EventCounter = 1

		add_events
		event	counter	mongols_invasion
		date	4
		event	counter	mongols_invasion
		date	13
		event	counter	mongols_invasion
		date	29
		event	counter	mongols_invasion
		date	50
		event	counter	mongols_invasion
		date	100
		end_add_events
		terminate_monitor
	end_monitor

;--human part
monitor_event PreFactionTurnStart FactionType mongols
	and FactionIsLocal
	and I_EventCounter mongols_invasion = 1

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 498, y 140, label mongols4flash1
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 1 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 1 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 31, x 497, y 140
	point_at_character mongols4flash1
	character_flash_start mongols4flash1
	move_strat_camera 498, 140
			terminate_monitor
	end_monitor

monitor_conditions I_CharacterSelected mongols4flash1
	ui_flash_stop
	character_flash_stop mongols4flash1
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and FactionIsLocal
	and I_EventCounter mongols_invasion = 3

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 498, y 140, label mongols4flash2
		traits MilitaryInclination 1 , Military_Edu 1 , NaturalMilitarySkill 2 , GoodCommander 2 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 1 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 1 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 2 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 1 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		end

	spawn_character mongols random_name, priest, age 22, x 497, y 140
	point_at_character mongols4flash2
	character_flash_start mongols4flash2
	move_strat_camera 498, 140
terminate_monitor
end_monitor

monitor_conditions I_CharacterSelected mongols4flash2
	ui_flash_stop
	character_flash_stop mongols4flash2
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and FactionIsLocal
	and I_EventCounter mongols_invasion = 3

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 498, y 140, label mongols4flash3
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 3 , GoodCommander 5 , Loyal 2 , ContentGeneral 3, BattleDread 3 , StrategyDread 2
		unit	Keshikten Bodyguard		exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 22, x 497, y 140
	point_at_character mongols4flash3
	character_flash_start mongols4flash3
	move_strat_camera 498, 140
terminate_monitor
end_monitor

monitor_conditions I_CharacterSelected mongols4flash3
	ui_flash_stop
	character_flash_stop mongols4flash3
terminate_monitor
end_monitor

;--ai part
monitor_event PreFactionTurnStart FactionType mongols ;make sure the horde will acquire their first settlement early era
	and not FactionIsLocal
	and I_EventCounter mongols_invasion = 1
	and not I_SettlementOwner Urgench = mongols

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 500, y 153, label mongols4supportgen1, family
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 3 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 499, y 154, label mongols4supportgen2, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	random_name, named character, age 24, x 499, y 153, label mongols4supportgen3
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Anger 2 , BattleDread 2 , StrategyDread 2 , PublicFaith 4, TouchedByTheGods 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut	exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 501, y 153, label mongols4supportgen4
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	if not I_SettlementUnderSiege Urgench
		if I_CharacterTypeNearTile mongols, named_character, 0, 501, 153
			siege_settlement mongols4supportgen4, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 499, 154
			siege_settlement mongols4supportgen2, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 499, 153
			siege_settlement mongols4supportgen3, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 500, 153
			siege_settlement mongols4supportgen1, Urgench, attack
		end_if
	end_if

	terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and not FactionIsLocal
	and I_CharacterTypeNearTile mongols, named_character, 10, 440, 194

	historic_event mongols_blue_horde_caucasus

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 430, y 195
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and not FactionIsLocal
	and I_CharacterTypeNearTile mongols, named_character, 10, 326, 202

	historic_event mongols_blue_horde_kiev

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 316, y 202
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and not FactionIsLocal
	and I_CharacterTypeNearTile mongols, named_character, 10, 280, 184

	historic_event mongols_blue_horde_hungary

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 290, y 190
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and not FactionIsLocal
	and I_CharacterTypeNearTile mongols, named_character, 5, 396, 89

	historic_event mongols_horde_baghdad

terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and I_EventCounter mongols_invasion = 1

	spawn_army
		faction mongols
		character	Chagatai, named character, age 26, x 505, y 145, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		end
	add_money mongols 5000

		spawn_army 
		faction mongols
		character	Subutai, named character, age 25, x 507, y 140, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		end
	add_money mongols 5000

		spawn_army 
		faction mongols
		character	Berkei, named character, age 24, x 500, y 150,
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 2 , BattleDread 2 , StrategyDread 2 , PublicFaith 4, TouchedByTheGods 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 504, y 144
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		end
	add_money mongols 5000

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, priest, age 32, x 470, y 120
	spawn_character mongols random_name, priest, age 33, x 490, y 150
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, spy, age 20, x 490, y 135
	spawn_character mongols random_name, spy, age 29, x 489, y 110 
	spawn_character mongols random_name, assassin, age 31, x 504, y 132 
	spawn_character mongols random_name, assassin, age 33, x 491, y 144 
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and I_IsFactionAIControlled mongols
	and I_EventCounter mongols_invasion = 2

	spawn_army
		faction mongols
		character	Batu, named character, age 26, x 505, y 145, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 3 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	Tsagadai, named character, age 25, x 500, y 191
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
	end
	add_money mongols 5000

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 508, y 92
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 3 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, spy, age 20, x 490, y 135
	spawn_character mongols random_name, spy, age 29, x 489, y 110 
	spawn_character mongols random_name, assassin, age 31, x 504, y 132 
	spawn_character mongols random_name, assassin, age 33, x 491, y 144 
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
	add_money mongols 20000
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and I_IsFactionAIControlled mongols
	and I_EventCounter mongols_invasion = 3

	spawn_army
		faction mongols
		character	Menglai, named character, age 25, x 490, y 137
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 3 , BattleDread 2 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end

	spawn_army
		faction mongols
		character	Jagadai, named character, age 25, x 502, y 144
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, spy, age 33, x 490, y 150
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, assassin, age 20, x 490, y 135
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
	add_money mongols 20000
	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType mongols
	and I_IsFactionAIControlled mongols
	and I_EventCounter mongols_invasion = 4

		spawn_army 
		faction mongols
		character	Hulegu, named character, age 25, x 498, y 120
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 3 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		end

		spawn_army 
		faction mongols
		character	Kitbuqa, named character, age 24, x 507, y 92
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 3 , BattleDread 2 , StrategyDread 2 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		end

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, spy, age 20, x 490, y 135
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
	add_money mongols 30000
	terminate_monitor
end_monitor
	
monitor_event PreFactionTurnStart FactionType mongols
	and not FactionIsLocal

	if I_EventCounter mongols_invasion = 4
		terminate_monitor
	end_if

	if I_SettlementOwner Urgench = mongols
		create_unit Urgench, Khabutu Archers, num 1, exp 3, arm 0, wep 0
		create_unit Urgench, Hoschuchi Lancers, num 1, exp 4, arm 0, wep 0
		create_unit Urgench, ME Trebuchet, num 2, exp 5, arm 0, wep 0
		add_money mongols 3000
	end_if

	if I_SettlementOwner Khiva = mongols
		create_unit Khiva, Disamounted Turhagut, num 1, exp 2, arm 0, wep 0
		create_unit Khiva, Hoshiga Horse Archers, num 1, exp 2, arm 0, wep 0
		add_money mongols 2000
	end_if

	if I_SettlementOwner Konjikala = mongols
		create_unit Konjikala, Khabutu Archers, num 1, exp 3, arm 0, wep 0
		create_unit Konjikala, Hoshiga Horse Archers, num 2, exp 4, arm 0, wep 0
		create_unit Konjikala, ME Catapult, num 1, exp 4, arm 0, wep 0
		add_money mongols 2000
	end_if

	if I_SettlementOwner Embi = mongols
		create_unit Embi, Khabutu Archers, num 1, exp 2, arm 0, wep 0
		create_unit Embi, Disamounted Turhagut, num 1, exp 2, arm 0, wep 0
		create_unit Embi, Hoshiga Horse Archers, num 2, exp 4, arm 0, wep 0
		add_money mongols 2000
	end_if

	if I_EventCounter DifficultyLevel >= 2
		if I_SettlementOwner Jaiksk = mongols
			create_unit Jaiksk, Disamounted Turhagut, num 1, exp 1, arm 0, wep 0
			create_unit Jaiksk, Hoshiga Horse Archers, num 2, exp 3, arm 0, wep 0
			add_money mongols 1000
		end_if
	end_if

	if I_EventCounter DifficultyLevel >= 2
		if I_SettlementOwner Astrakhan = mongols
			create_unit Astrakhan, Disamounted Turhagut, num 2, exp 4, arm 0, wep 0
			create_unit Astrakhan, Hoshiga Horse Archers, num 2, exp 3, arm 0, wep 0
			create_unit Astrakhan, ME Catapult, num 1, exp 5, arm 0, wep 0
			add_money mongols 2000
		end_if
	end_if


	if I_SettlementOwner Gorgan = mongols
		create_unit Gorgan, Khabutu Archers, num 1, exp 3, arm 0, wep 0
		create_unit Gorgan, Disamounted Turhagut, num 1, exp 4, arm 0, wep 0
		create_unit Gorgan, Turhagut Lancers, num 1, exp 4, arm 0, wep 0
		add_money mongols 2000
	end_if

	if I_EventCounter DifficultyLevel >= 2
		if I_SettlementOwner Mashhad = mongols
			create_unit Mashhad, Khabutu Archers, num 1, exp 2, arm 0, wep 0
			create_unit Mashhad, Hoshiga Horse Archers, num 2, exp 4, arm 0, wep 0
			add_money mongols 2000
		end_if
	end_if

	if I_EventCounter DifficultyLevel >= 3
		if I_SettlementOwner Damghan = mongols
			create_unit Damghan, Turhagut Lancers, num 1, exp 2, arm 0, wep 0
			create_unit Damghan, ME Trebuchet, num 1, exp 5, arm 0, wep 0
			add_money mongols 3000
		end_if
	end_if

	if I_EventCounter DifficultyLevel >= 4
		if I_SettlementOwner Yazd = mongols
			create_unit Yazd, Disamounted Turhagut, num 2, exp 1, arm 0, wep 0
			add_money mongols 1000
		end_if
	end_if

end_monitor

;mongols weaken and no longer are a superpower
monitor_event PreFactionTurnStart FactionType mongols
	and not FactionIsLocal
	and I_EventCounter mongols_invasion = 5

	set_event_counter is_the_ai 0

	end_monitor

declare_counter attack_khiva
set_counter attack_khiva 0

;monitor_event FactionTurnStart FactionType mongols
monitor_event CharacterTurnStart CharFactionType mongols
	and Trait InvasionCharacterCounter = 2; Bayan
	and not I_SettlementOwner Khiva = mongols
	and I_IsFactionAIControlled mongols
	and I_CharacterExists mongols4jebe
	;and I_CharacterExists mongols4bayan
	
	if I_SettlementUnderSiege Khiva;if settlement under siege already, avoid ctd.
	and I_CompareCounter attack_khiva = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile mongols, named_character, 5, 505, 147 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Khiva
	and I_CompareCounter attack_khiva = 1
		siege_settlement mongols4jebe, Khiva, attack
		siege_settlement mongols4bayan, Khiva, maintain
		set_counter attack_khiva 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Khiva
		if I_CompareCounter attack_khiva = 0
			siege_settlement mongols4jebe, Khiva, maintain
			siege_settlement mongols4bayan, Khiva, maintain
			set_counter attack_khiva 1
		end_if
	end_if
end_monitor

declare_counter attack_konjikala
set_counter attack_konjikala 0

;monitor_event FactionTurnStart FactionType mongols
monitor_event CharacterTurnStart CharFactionType mongols
	and Trait InvasionCharacterCounter = 3; Chindu
	and I_CharacterExists mongols4chindu

	if I_CompareCounter attack_konjikala = 2
		terminate_monitor
	end_if
	set_event_counter is_mongol_character 1
end_monitor
monitor_event CharacterTurnStart CharFactionType mongols
	and Trait InvasionCharacterCounter = 4; Nayuk
	and I_CharacterExists mongols4nayuk

	if I_CompareCounter attack_konjikala = 2
		terminate_monitor
	end_if
	set_event_counter is_mongol_character 2
end_monitor
monitor_event EventCounter EventCounterType is_mongol_character
	and EventCounter = 2
	and not I_SettlementOwner Konjikala = mongols
	and I_IsFactionAIControlled mongols
	
	if I_SettlementUnderSiege Konjikala;if settlement under siege already, avoid ctd.
	and I_CompareCounter attack_konjikala = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile mongols, named_character, 5, 490, 126 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Konjikala
	and I_CompareCounter attack_konjikala = 1
		siege_settlement mongols4chindu, Konjikala, attack
		siege_settlement mongols4nayuk, Konjikala, maintain
		set_counter attack_konjikala 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Konjikala
		if I_CompareCounter attack_konjikala = 0
			siege_settlement mongols4chindu, Konjikala, maintain
			siege_settlement mongols4nayuk, Konjikala, maintain
			set_counter attack_konjikala 1
			set_event_counter is_mongol_character 0
		end_if
	end_if
end_monitor

;=============== END Golden Horde Emergent ===============
;================== TIMURIDS INVASION ===================
monitor_event EventCounter EventCounterType timurids_invasion_warn
	and EventCounter = 1

	add_events
		event	emergent_faction	timurids
		date	1
		event	counter	timurids_invasion
		date	1
		event	counter	timurids_invasion
		date	4
		event	counter	timurids_invasion
		date	15
	end_add_events
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType timurids_invasion
	and EventCounter = 1
	and I_IsFactionAIControlled timurids

	historic_event the_timurids_emerge event/timurids_invade.bik

	spawn_army ;Urgench
		faction timurids
		character	Timur, named character, age 30, x 500, y 153, label timurids4timur, family
		traits Factionleader 1 , MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 3 , StrategyDread 2 , PublicFaith 4 , Loyal 1 , ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 15000

	spawn_army ;Urgench
		faction timurids
		character	Husayn, named character, age 24, x 501, y 154, label timurids4husayn, family
		traits Factionheir 1 , MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Anger 3 , BattleDread 2 , StrategyDread 3 , PublicFaith 4, Loyal 1, ContentGeneral 2 
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army ;Khiva
		faction timurids
		character	Umar_Shaykh, named character, age 23, x 504, y 147, label timurids4umar, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , Anger 3 , BattleDread 3 , StrategyDread 2 , PublicFaith 4, Loyal 1, ContentGeneral 3 , InvasionCharacterCounter 1 
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 15000

	spawn_army ;Khiva
		faction timurids
		character	Miran, named character, age 22, x 505, y 146, label timurids4miran, family
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , Bloodthirsty 2 , GoodCommander 1 , BattleDread 2 , StrategyDread 3 , PublicFaith 4, Loyal 1, ContentGeneral 3 , InvasionCharacterCounter 2 
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army ;Konjikala
		faction timurids
		character	Batutai, named character, age 30, x 490, y 125, label timurids4batutai, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 4 , StrategyDread 2 , PublicFaith 1 , Loyal 3 , ContentGeneral 3 , ReligionStarter 1 , InvasionCharacterCounter 3 
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 5000

	spawn_army ;Konjikala
		faction timurids
		character	Ghazatai, named character, age 24, x 491, y 126, label timurids4ghazatai, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1 , InvasionCharacterCounter 4 
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army ;support
		faction timurids
		character	random_name, named character, age 21, x 500, y 147
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , Anger 3 , BattleDread 3 , StrategyDread 2 , PublicFaith 4, Loyal 1, ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 15000

	spawn_army ;support
		faction timurids
		character	random_name, named character, age 25, x 500, y 146
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , Bloodthirsty 2 , GoodCommander 1 , BattleDread 2 , StrategyDread 3 , PublicFaith 4, Loyal 1, ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army ;support
		faction timurids
		character	random_name, named character, age 30, x 500, y 125
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 4 , StrategyDread 2 , PublicFaith 1 , Loyal 3 , ContentGeneral 3 , ReligionStarter 1
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 5000

	spawn_army ;support
		faction timurids
		character	random_name, named character, age 24, x 500, y 126
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end

	add_money timurids 5000

	spawn_character timurids random_name, priest, age 23, x 480, y 140 
	spawn_character timurids random_name, priest, age 24, x 500, y 98 
	spawn_character timurids random_name, priest, age 27, x 470, y 120
	spawn_character timurids random_name, spy, age 22, x 500, y 135 
	spawn_character timurids random_name, spy, age 21, x 493, y 178 
	spawn_character timurids random_name, spy, age 29, x 489, y 110 
	spawn_character timurids random_name, assassin, age 31, x 504, y 132 
	spawn_character timurids random_name, assassin, age 33, x 485, y 189 
	spawn_character timurids random_name, assassin, age 31, x 504, y 132 
	spawn_character timurids random_name, assassin, age 33, x 485, y 189 
	spawn_character timurids random_name, assassin, age 31, x 504, y 132 
	spawn_character timurids random_name, assassin, age 33, x 485, y 189 
	spawn_character timurids random_name, assassin, age 31, x 504, y 132 
	spawn_character timurids random_name, assassin, age 33, x 485, y 189 

	console_command diplomatic_stance timurids kwarezm war
	console_command diplomatic_stance timurids mongols war
	add_money timurids 20000
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType timurids_invasion
	and I_IsFactionAIControlled timurids
	and EventCounter = 2
	and not I_SettlementOwner Urgench = timurids

	spawn_army
		faction timurids
		character	random_name, named character, age 26, x 500, y 153, label timurids4supportgen1, family
		traits MilitaryInclination 1 , Military_Edu 4 , NaturalMilitarySkill 4 , GoodCommander 5 , Bloodthirsty 3 , BattleDread 5 , StrategyDread 5 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1 , Drink 4 , Genocide 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 25, x 499, y 154, label timurids4supportgen2, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 24, x 499, y 153, label timurids4supportgen3
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 3 , GoodCommander 5 , Bloodthirsty 3 , BattleDread 5 , StrategyDread 5 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1 , Drink 2
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 25, x 501, y 153, label timurids4supportgen4
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Nukeri Horse Archers		exp 6 armour 1 weapon_lvl 0
		unit		Naffatun		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
		unit		AS Rocket Launcher		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	if not I_SettlementUnderSiege Urgench
		if I_CharacterTypeNearTile timurids, named_character, 0, 501, 153
			siege_settlement timurids4supportgen4, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile timurids, named_character, 0, 499, 154
			siege_settlement timurids4supportgen2, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile timurids, named_character, 0, 499, 153
			siege_settlement timurids4supportgen3, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile timurids, named_character, 0, 500, 153
			siege_settlement timurids4supportgen1, Urgench, attack
		end_if
	end_if

	terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType timurids_invasion
	and I_IsFactionAIControlled timurids
	and EventCounter = 2

	spawn_army
		faction timurids
		character	random_name, named character, age 26, x 505, y 145, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 25, x 507, y 140, family
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 24, x 500, y 150,
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 2 , BattleDread 2 , StrategyDread 2 , PublicFaith 4, TouchedByTheGods 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_army
		faction timurids
		character	random_name, named character, age 25, x 504, y 144
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit		Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Turhagut Lancers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Khorchi Horse Archers	exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		Disamounted Turhagut			exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		ME Halberd Militia	exp 6 armour 1 weapon_lvl 0
		unit		Merguen Archers	exp 6 armour 1 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		Elephants		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
		unit		ME Grand Bombard		exp 6 armour 0 weapon_lvl 0
	end
	add_money timurids 5000

	spawn_character timurids random_name, priest, age 22, x 480, y 140
	spawn_character timurids random_name, priest, age 27, x 500, y 98
	spawn_character timurids random_name, priest, age 32, x 470, y 120
	spawn_character timurids random_name, priest, age 33, x 490, y 150
	spawn_character timurids random_name, spy, age 20, x 500, y 135
	spawn_character timurids random_name, spy, age 20, x 490, y 135
	spawn_character timurids random_name, spy, age 29, x 489, y 110 
	spawn_character timurids random_name, assassin, age 31, x 504, y 132 
	spawn_character timurids random_name, assassin, age 33, x 491, y 144 
	spawn_character timurids random_name, assassin, age 21, x 495, y 135
terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType timurids
	and not FactionIsLocal

	if I_EventCounter timurids_invasion = 3
		spawn_character timurids random_name, priest, age 22, x 480, y 140
		spawn_character timurids random_name, priest, age 27, x 500, y 98
		spawn_character timurids random_name, priest, age 32, x 470, y 120
		spawn_character timurids random_name, priest, age 33, x 490, y 150
		spawn_character timurids random_name, spy, age 20, x 500, y 135
		spawn_character timurids random_name, spy, age 20, x 490, y 135
		spawn_character timurids random_name, spy, age 29, x 489, y 110 
		spawn_character timurids random_name, assassin, age 31, x 504, y 132 
		spawn_character timurids random_name, assassin, age 33, x 491, y 144 
		spawn_character timurids random_name, assassin, age 21, x 495, y 135
		terminate_monitor
	end_if

	if I_SettlementOwner Urgench = timurids
		create_unit Urgench, Elephants, num 3, exp 3, arm 0, wep 0
		create_unit Urgench, Disamounted Turhagut, num 1, exp 4, arm 0, wep 0
		create_unit Urgench, Turhagut Lancers, num 2, exp 4, arm 0, wep 0
		create_unit Urgench, ME Grand Bombard, num 2, exp 5, arm 0, wep 0
		add_money timurids 3000
	end_if

	if I_SettlementOwner Khiva = timurids
		create_unit Khiva, Merguen Archers, num 8, exp 5, arm 0, wep 0
		add_money timurids 3000
	end_if

	if I_SettlementOwner Konjikala = timurids
		create_unit Konjikala, Khorchi Horse Archers, num 4, exp 3, arm 0, wep 0
		create_unit Konjikala, Turhagut Lancers, num 4, exp 4, arm 0, wep 0
		add_money timurids 5000
	end_if

	if I_SettlementOwner Embi = timurids
		create_unit Embi, Disamounted Turhagut, num 5, exp 4, arm 0, wep 0
		add_money timurids 5000
	end_if

	if I_SettlementOwner Gorgan = timurids
		create_unit Gorgan, Disamounted Turhagut, num 4, exp 4, arm 0, wep 0
		create_unit Gorgan, Merguen Archers, num 4, exp 5, arm 0, wep 0
		add_money timurids 5000
	end_if

	if I_SettlementOwner Mashhad = timurids
		create_unit Mashhad, Turhagut Lancers, num 1, exp 2, arm 0, wep 0
		create_unit Mashhad, ME Grand Bombard, num 2, exp 4, arm 0, wep 0
		add_money timurids 5000
	end_if

	if I_SettlementOwner Damghan = timurids
		create_unit Damghan, Turhagut Lancers, num 5, exp 2, arm 0, wep 0
		add_money timurids 5000
	end_if

end_monitor

declare_counter attack_urgench_timurids
set_counter attack_urgench_timurids 0

;monitor_event FactionTurnStart FactionType timurids
monitor_event CharacterTurnStart CharFactionType timurids
	and Trait Factionleader = 1
	and not I_SettlementOwner Urgench = timurids
	and I_IsFactionAIControlled timurids
	;and I_CharacterExists timurids4timur
	and I_CharacterExists timurids4husayn
	
	if I_SettlementUnderSiege Urgench;if settlement under siege already, avoid ctd.
	and  I_CompareCounter attack_urgench_timurids = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile timurids, named_character, 5, 500, 154 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Urgench
	and I_CompareCounter attack_urgench_timurids = 1
		siege_settlement timurids4timur, Urgench, attack
		siege_settlement timurids4husayn, Urgench, maintain
		set_counter attack_urgench_timurids 2
		if I_CharacterExists timurids4husayn
			move timurids4husayn, 453, 207;for jaiksk
		end_if
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Urgench
		if I_CompareCounter attack_urgench_timurids = 0
			siege_settlement timurids4timur, Urgench, maintain
			siege_settlement timurids4husayn, Urgench, maintain
			set_counter attack_urgench_timurids 1
		end_if
	end_if

end_monitor

declare_counter attack_khiva_timurids
set_counter attack_khiva_timurids 0

;monitor_event FactionTurnStart FactionType timurids
monitor_event CharacterTurnStart CharFactionType timurids
	and Trait InvasionCharacterCounter = 1; Umar
	and I_CharacterExists timurids4umar

	if I_CompareCounter attack_khiva_timurids = 2
		terminate_monitor
	end_if
	set_event_counter is_timurid_character 1
end_monitor
monitor_event CharacterTurnStart CharFactionType timurids
	and Trait InvasionCharacterCounter = 2; Miran
	and I_CharacterExists timurids4miran

	if I_CompareCounter attack_khiva_timurids = 2
		terminate_monitor
	end_if
	set_event_counter is_timurid_character 2
end_monitor
monitor_event EventCounter EventCounterType is_timurid_character
	and EventCounter = 2
	and not I_SettlementOwner Khiva = timurids
	and I_IsFactionAIControlled timurids
	
	if I_SettlementUnderSiege Khiva;if settlement under siege already, avoid ctd.
	and  I_CompareCounter attack_khiva_timurids = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile timurids, named_character, 5, 505, 147 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Khiva
	and I_CompareCounter attack_khiva_timurids = 1
		siege_settlement timurids4umar, Khiva, attack
		siege_settlement timurids4miran, Khiva, maintain
		set_counter attack_khiva_timurids 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Khiva
		if I_CompareCounter attack_khiva_timurids = 0
			siege_settlement timurids4umar, Khiva, maintain
			siege_settlement timurids4miran, Khiva, maintain
			set_counter attack_khiva_timurids 1
			set_event_counter is_timurid_character 0
		end_if
	end_if

end_monitor

declare_counter attack_konjikala_timurids
set_counter attack_konjikala_timurids 0

;monitor_event FactionTurnStart FactionType timurids
monitor_event CharacterTurnStart CharFactionType timurids
	and Trait InvasionCharacterCounter = 3; Batutai
	and I_CharacterExists timurids4batutai

	if I_CompareCounter attack_konjikala_timurids = 2
		terminate_monitor
	end_if
	set_event_counter is_timurid_character2 1
end_monitor
monitor_event CharacterTurnStart CharFactionType timurids
	and Trait InvasionCharacterCounter = 4; Ghazatai
	and I_CharacterExists timurids4ghazatai

	if I_CompareCounter attack_konjikala_timurids = 2
		terminate_monitor
	end_if
	set_event_counter is_timurid_character2 2
end_monitor
monitor_event EventCounter EventCounterType is_timurid_character2
	and EventCounter = 2
	and not I_SettlementOwner Konjikala = timurids
	and I_IsFactionAIControlled timurids
	
	if I_SettlementUnderSiege Konjikala;if settlement under siege already, avoid ctd.
	and  I_CompareCounter attack_konjikala_timurids = 0
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile timurids, named_character, 5, 490, 126 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Konjikala
	and I_CompareCounter attack_konjikala_timurids = 1
		siege_settlement timurids4batutai, Konjikala, attack
		siege_settlement timurids4ghazatai, Konjikala, maintain
		set_counter attack_konjikala_timurids 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Konjikala
		if I_CompareCounter attack_konjikala_timurids = 0
			siege_settlement timurids4batutai, Konjikala, maintain
			siege_settlement timurids4ghazatai, Konjikala, maintain
			set_counter attack_konjikala_timurids 1
			set_event_counter is_timurid_character2 0
		end_if
	end_if

end_monitor

;========================================================
;===================== G5 BAI STUFF =====================
;========================================================

;### Germanicu5 ReallyBadAI Battle System Scrips v5.x
;### This file contains manually programmed AI behaviour eliminating previously unfixable, hardcoded bugs and greatly influences battle performance
;### Support available at http://www.twcenter.net/forums/forumdisplay.php?f=1745 , http://www.twcenter.net/forums/showthread.php?t=257970 and http://www.twcenter.net/forums/showthread.php?t=253132
;### Non-private use of code only by permission,
;### coded by Germanicu5

;;;;;;;Print Info
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
monitor_event GameReloaded
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
end_monitor

;;;;;;;
declare_counter g5_battle_difficulty_high
;;;;;;;
declare_counter fire_labels
declare_counter panel_check
declare_counter player_unit_count
declare_counter enemy_unit_count
declare_counter open_battle
declare_counter labels_only
declare_counter stakes_lock
;;;;;;;
declare_counter pu1_missile
declare_counter pu2_missile
declare_counter pu3_missile
declare_counter pu4_missile
declare_counter pu5_missile
declare_counter pu6_missile
declare_counter pu7_missile
declare_counter pu8_missile
declare_counter pu9_missile
declare_counter pu10_missile
declare_counter pu11_missile
declare_counter pu12_missile
declare_counter pu13_missile
declare_counter pu14_missile
declare_counter pu15_missile
declare_counter pu16_missile
declare_counter pu17_missile
declare_counter pu18_missile
declare_counter pu19_missile
declare_counter pu20_missile
;;;;;;;Checks
declare_counter check_timer
declare_counter elephant_fix_check
declare_counter elephant_fix_check_sally
declare_counter script_delay
declare_counter reinf_check
declare_counter sally_defense_check
declare_counter sally_check
;;;;;;;Stakes
declare_counter label_ready
declare_counter stakes_on
;;;;;;;Reinforcements
declare_counter army4_ready
declare_counter reinf_late

declare_counter distance_trigger1
declare_counter distance_trigger2
declare_counter distance_trigger3
declare_counter distance_trigger4
declare_counter distance_trigger5

declare_counter kill_labelling_reinf_allied
declare_counter army3_reinf_allied
declare_counter army4_reinf_allied
declare_counter army5_reinf_allied
declare_counter army6_reinf_allied
declare_counter army7_reinf_allied
declare_counter army8_reinf_allied
declare_counter army9_reinf_allied
declare_counter army10_reinf_allied
declare_counter army11_reinf_allied
declare_counter army12_reinf_allied
declare_counter army13_reinf_allied
declare_counter army14_reinf_allied
declare_counter army15_reinf_allied
declare_counter army16_reinf_allied
declare_counter launch_alliance_0
declare_counter launch_alliance_1

declare_counter apply_strategy
declare_counter relaunch_movement

declare_counter att_alliance_ready
declare_counter def_alliance_ready
declare_counter def_alliance_ready_siege

declare_counter army3_moving
declare_counter army3_run
declare_counter army3_reinf_late
declare_counter army4_moving
declare_counter army4_run
declare_counter army4_reinf_late
declare_counter army5_moving
declare_counter army5_run
declare_counter army5_reinf_late
declare_counter army6_moving
declare_counter army6_run
declare_counter army6_reinf_late
declare_counter army7_moving
declare_counter army7_run
declare_counter army7_reinf_late
declare_counter army8_moving
declare_counter army8_run
declare_counter army8_reinf_late
declare_counter army9_moving
declare_counter army9_run
declare_counter army9_reinf_late
declare_counter army10_moving
declare_counter army10_run
declare_counter army10_reinf_late
declare_counter army11_moving
declare_counter army11_run
declare_counter army11_reinf_late
declare_counter army12_moving
declare_counter army12_run
declare_counter army12_reinf_late
declare_counter army13_moving
declare_counter army13_run
declare_counter army13_reinf_late
declare_counter army14_moving
declare_counter army14_run
declare_counter army14_reinf_late
declare_counter army15_moving
declare_counter army15_run
declare_counter army15_reinf_late
declare_counter army16_moving
declare_counter army16_run
declare_counter army16_reinf_late

declare_counter army4_ready_siege ; acts as launching counter
declare_counter army4_moving_siege
declare_counter army4_run_siege
declare_counter reinf_check_interval

;;;;;;;HA Fix
declare_counter ha_fix
;;;;;;;Elephant Fix
declare_counter elephant_fix
declare_counter elephant_gate
declare_counter elephant_gate_s
declare_counter elephant_gate_tier2
declare_counter elephant_gate_tier3
declare_counter elephant_gate_tier2s
declare_counter elephant_gate_tier3s
declare_counter rally_walls
declare_counter rally_walls_s
declare_counter second_ring
declare_counter third_ring
declare_counter second_ring_s
declare_counter third_ring_s
declare_counter del_objective
declare_counter del_objective_s
;;;;;;;Sally-out
declare_counter sally-out_fix
declare_counter sally_defense
declare_counter reform_back
declare_counter reform_multi
declare_counter unit_under_fire
declare_counter kill_sally
declare_counter sally_reinf
declare_counter reset_position
declare_counter defend_location
declare_counter reset_army2
declare_counter assign_labels
;;;;;;;Siege
declare_counter siege_fix
declare_counter army_sieging
declare_counter army_south
declare_counter army_north
declare_counter army_east
declare_counter army_west
declare_counter emergency_stop
declare_counter omfg_cannon_tower
declare_counter army2_sally
declare_counter wall_advance_s
;;;;;;;Protect General
declare_counter protect_general
declare_counter general_wait
declare_counter protect_siege
declare_counter g_stop
;;;;;;;Sally-out, AI defending
declare_counter army4_ready_sally
declare_counter army4_location
declare_counter path_n
declare_counter path_ne
declare_counter path_e
declare_counter path_se
declare_counter path_s
declare_counter path_sw
declare_counter path_w
declare_counter path_nw
declare_counter obstacle_check
declare_counter label_army4
declare_counter army4_moving_s
declare_counter army4_idle_s
declare_counter line_passed
declare_counter army2_idle_s
declare_counter army4_idle_r
declare_counter wall_line_passed
declare_counter reset_position_s
declare_counter repeat_test1
declare_counter repeat_test2
declare_counter repeat_test3
declare_counter repeat_test4
declare_counter repeat_test5
declare_counter repeat_test6
;;;;;;;Open Battles
declare_counter ob_defense_launch
declare_counter ob_defend
declare_counter ob_siege_attack
declare_counter ob_under_fire
declare_counter ob_repeat_test
declare_counter ob_engaged
declare_counter player_units_closing
declare_counter player_enveloping
declare_counter player_engaged_reinf
;;;;;;;AI Stuck Fix
declare_counter ai_stuck_launch
declare_counter a2u1_stuck
declare_counter a2u2_stuck
declare_counter a2u3_stuck
declare_counter a2u4_stuck
declare_counter a2u5_stuck
declare_counter a2u6_stuck
declare_counter a2u7_stuck
declare_counter a2u8_stuck
declare_counter a2u9_stuck
declare_counter a2u10_stuck
declare_counter a2u11_stuck
declare_counter a2u12_stuck
declare_counter a2u13_stuck
declare_counter a2u14_stuck
declare_counter a2u15_stuck
declare_counter a2u16_stuck
declare_counter a2u17_stuck
declare_counter a2u18_stuck
declare_counter a2u19_stuck
declare_counter a2u20_stuck
declare_counter a2u1_status
declare_counter a2u2_status
declare_counter a2u3_status
declare_counter a2u4_status
declare_counter a2u5_status
declare_counter a2u6_status
declare_counter a2u7_status
declare_counter a2u8_status
declare_counter a2u9_status
declare_counter a2u10_status
declare_counter a2u11_status
declare_counter a2u12_status
declare_counter a2u13_status
declare_counter a2u14_status
declare_counter a2u15_status
declare_counter a2u16_status
declare_counter a2u17_status
declare_counter a2u18_status
declare_counter a2u19_status
declare_counter a2u20_status
declare_counter a2u1_distance
declare_counter a2u2_distance
declare_counter a2u3_distance
declare_counter a2u4_distance
declare_counter a2u5_distance
declare_counter a2u6_distance
declare_counter a2u7_distance
declare_counter a2u8_distance
declare_counter a2u9_distance
declare_counter a2u10_distance
declare_counter a2u11_distance
declare_counter a2u12_distance
declare_counter a2u13_distance
declare_counter a2u14_distance
declare_counter a2u15_distance
declare_counter a2u16_distance
declare_counter a2u17_distance
declare_counter a2u18_distance
declare_counter a2u19_distance
declare_counter a2u20_distance
;;;;;;;
set_event_counter no_advice 1

monitor_event PreFactionTurnStart FactionIsLocal
    and BattleDifficulty > medium

    set_counter g5_battle_difficulty_high 1
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event GeneralAssaultsResidence TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsResidence ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event ButtonPressed ButtonPressed prebattle_fight_button
    and I_CompareCounter panel_check = 1

;    suspend_unscripted_advice true
    set_counter fire_labels 10
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
    prepare_for_battle
end_monitor

monitor_conditions I_InBattle
    and I_CompareCounter fire_labels = 10

    set_counter fire_labels 0
    battle_wait 0.1

    if ! I_BattleIsSiegeBattle
    set_counter fire_labels 1
    end_if

    if I_BattleIsSiegeBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter fire_labels 1
    end_if

if I_BattlePlayerArmyIsAttacker

    ;;;Army 1
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    ;;;Army 2
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_BattlePlayerArmyIsAttacker

    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if
if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 1
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ;;;Army 2
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a1u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a1u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a1u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a1u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a1u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a1u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a1u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a1u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a1u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a1u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a1u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a1u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a1u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a1u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a1u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a1u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a1u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a1u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a1u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a1u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if ! I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a2u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a2u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a2u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a2u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a2u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a2u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a2u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a2u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a2u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a2u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a2u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a2u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a2u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a2u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a2u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a2u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a2u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a2u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a2u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a2u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
;    battle_wait 0.1
;    ai_active_set off
    battle_wait 0.1
    ai_active_set on
    set_counter labels_only 1

    if I_BattleIsSiegeBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter ai_stuck_launch 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattlePlayerArmyNumberOfAttribute stakes > 0
    set_counter stakes_lock 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    set_counter protect_siege 1
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    set_counter open_battle 1
    end_if

if I_CompareCounter fire_labels = 1
    if I_BattleIsSiegeBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    label_location -470, -470, sw
    label_location 470, -470, se
    label_location -470, 470, nw
    label_location 470, 470, ne
    label_location -400, -400, sw_wall
    label_location 400, -400, se_wall
    label_location -400, 400, nw_wall
    label_location 400, 400, ne_wall
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side < -200
    set_counter army_west 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side < -200
    set_counter army_west 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally-out_fix 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter siege_fix 1
    end_if

    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_BattleIsSiegeBattle
    set_counter elephant_fix 1
    end_if

end_if
end_monitor

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1

    set_counter script_delay 1
    battle_wait 15
    if I_CompareCounter script_delay = 1

    if I_CompareCounter fire_labels = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_CompareCounter fire_labels = 1
    if I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and ! I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1
    ai_gta_plan_set 1 DEFEND_FEATURE
    battle_wait 1
    ai_active_set on
    set_counter ob_defense_launch 1
    end_if
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    and I_BattleEnemyArmyNumberOfUnits > 2
    set_counter g_stop 1
    end_if

    if I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter fire_labels = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally_defense 1
    set_counter assign_labels 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_CompareCounter open_battle = 1
    set_counter ha_fix 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter ha_fix 1
    end_if
    set_counter script_delay 0
    end_if
end_monitor

monitor_event BattleReinforcementsArrive ! ArmyIsLocal
    and I_CompareCounter panel_check = 1
    and I_CompareCounter fire_labels = 1

    set_counter reinf_check 1
    battle_wait 15
if I_CompareCounter reinf_check = 1
    set_counter reinf_check 2
    battle_wait 15
if I_CompareCounter reinf_check = 2
    set_counter reinf_check 3
    battle_wait 15
if I_CompareCounter reinf_check = 3
 if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 3
    label_unit 0 1 0 a3u1
    define_unit_group army3a a3u1
    if ! I_PercentageUnitGroupKilled army3a = 100
    undefine_unit_group army3a
    ;;;Army 3
    label_unit 0 1 0 a3u1
    label_unit 0 1 1 a3u2
    label_unit 0 1 2 a3u3
    label_unit 0 1 3 a3u4
    label_unit 0 1 4 a3u5
    label_unit 0 1 5 a3u6
    label_unit 0 1 6 a3u7
    label_unit 0 1 7 a3u8
    label_unit 0 1 8 a3u9
    label_unit 0 1 9 a3u10
    label_unit 0 1 10 a3u11
    label_unit 0 1 11 a3u12
    label_unit 0 1 12 a3u13
    label_unit 0 1 13 a3u14
    label_unit 0 1 14 a3u15
    label_unit 0 1 15 a3u16
    label_unit 0 1 16 a3u17
    label_unit 0 1 17 a3u18
    label_unit 0 1 18 a3u19
    label_unit 0 1 19 a3u20

    define_unit_group army3 a3u1 a3u2 a3u3 a3u4 a3u5 a3u6 a3u7 a3u8 a3u9 a3u10 a3u11 a3u12 a3u13 a3u14 a3u15 a3u16 a3u17 a3u18 a3u19 a3u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker

    ;;;Army 4
    label_unit 1 1 0 a4u1
    define_unit_group army4a a4u1
    if ! I_PercentageUnitGroupKilled army4a = 100
    undefine_unit_group army4a
    ;;;Army 4
    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

    define_unit_group army4 a4u1 a4u2 a4u3 a4u4 a4u5 a4u6 a4u7 a4u8 a4u9 a4u10 a4u11 a4u12 a4u13 a4u14 a4u15 a4u16 a4u17 a4u18 a4u19 a4u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army3 = 100
    set_counter army3_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army4 = 100
    set_counter army4_reinf_allied 1
    end_if

    if I_PercentageUnitGroupKilled army3 = 100
    and I_PercentageUnitGroupKilled army4 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

if ! I_BattleIsSallyOutBattle

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 5
    label_unit 0 2 0 a5u1
    define_unit_group army5a a5u1
    if ! I_PercentageUnitGroupKilled army5a = 100
    undefine_unit_group army5a
    ;;;Army 5
    label_unit 0 2 0 a5u1
    label_unit 0 2 1 a5u2
    label_unit 0 2 2 a5u3
    label_unit 0 2 3 a5u4
    label_unit 0 2 4 a5u5
    label_unit 0 2 5 a5u6
    label_unit 0 2 6 a5u7
    label_unit 0 2 7 a5u8
    label_unit 0 2 8 a5u9
    label_unit 0 2 9 a5u10
    label_unit 0 2 10 a5u11
    label_unit 0 2 11 a5u12
    label_unit 0 2 12 a5u13
    label_unit 0 2 13 a5u14
    label_unit 0 2 14 a5u15
    label_unit 0 2 15 a5u16
    label_unit 0 2 16 a5u17
    label_unit 0 2 17 a5u18
    label_unit 0 2 18 a5u19
    label_unit 0 2 19 a5u20

    define_unit_group army5 a5u1 a5u2 a5u3 a5u4 a5u5 a5u6 a5u7 a5u8 a5u9 a5u10 a5u11 a5u12 a5u13 a5u14 a5u15 a5u16 a5u17 a5u18 a5u19 a5u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
    ;;;Army 6
    label_unit 1 2 0 a6u1
    define_unit_group army6a a6u1
    if ! I_PercentageUnitGroupKilled army6a = 100
    undefine_unit_group army6a 	
    ;;;Army 6
    label_unit 1 2 0 a6u1
    label_unit 1 2 1 a6u2
    label_unit 1 2 2 a6u3
    label_unit 1 2 3 a6u4
    label_unit 1 2 4 a6u5
    label_unit 1 2 5 a6u6
    label_unit 1 2 6 a6u7
    label_unit 1 2 7 a6u8
    label_unit 1 2 8 a6u9
    label_unit 1 2 9 a6u10
    label_unit 1 2 10 a6u11
    label_unit 1 2 11 a6u12
    label_unit 1 2 12 a6u13
    label_unit 1 2 13 a6u14
    label_unit 1 2 14 a6u15
    label_unit 1 2 15 a6u16
    label_unit 1 2 16 a6u17
    label_unit 1 2 17 a6u18
    label_unit 1 2 18 a6u19
    label_unit 1 2 19 a6u20

    define_unit_group army6 a6u1 a6u2 a6u3 a6u4 a6u5 a6u6 a6u7 a6u8 a6u9 a6u10 a6u11 a6u12 a6u13 a6u14 a6u15 a6u16 a6u17 a6u18 a6u19 a6u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army5 = 100
    set_counter army5_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army6 = 100
    set_counter army6_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army5 = 100
    and I_PercentageUnitGroupKilled army6 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 7
    label_unit 0 3 0 a7u1
    define_unit_group army7a a7u1
    if ! I_PercentageUnitGroupKilled army7a = 100
    undefine_unit_group army7a 	
    ;;;Army 7
    label_unit 0 3 0 a7u1
    label_unit 0 3 1 a7u2
    label_unit 0 3 2 a7u3
    label_unit 0 3 3 a7u4
    label_unit 0 3 4 a7u5
    label_unit 0 3 5 a7u6
    label_unit 0 3 6 a7u7
    label_unit 0 3 7 a7u8
    label_unit 0 3 8 a7u9
    label_unit 0 3 9 a7u10
    label_unit 0 3 10 a7u11
    label_unit 0 3 11 a7u12
    label_unit 0 3 12 a7u13
    label_unit 0 3 13 a7u14
    label_unit 0 3 14 a7u15
    label_unit 0 3 15 a7u16
    label_unit 0 3 16 a7u17
    label_unit 0 3 17 a7u18
    label_unit 0 3 18 a7u19
    label_unit 0 3 19 a7u20

    define_unit_group army7 a7u1 a7u2 a7u3 a7u4 a7u5 a7u6 a7u7 a7u8 a7u9 a7u10 a7u11 a7u12 a7u13 a7u14 a7u15 a7u16 a7u17 a7u18 a7u19 a7u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    define_unit_group army8a a8u1
    if ! I_PercentageUnitGroupKilled army8a = 100
    undefine_unit_group army8a 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    label_unit 1 3 1 a8u2
    label_unit 1 3 2 a8u3
    label_unit 1 3 3 a8u4
    label_unit 1 3 4 a8u5
    label_unit 1 3 5 a8u6
    label_unit 1 3 6 a8u7
    label_unit 1 3 7 a8u8
    label_unit 1 3 8 a8u9
    label_unit 1 3 9 a8u10
    label_unit 1 3 10 a8u11
    label_unit 1 3 11 a8u12
    label_unit 1 3 12 a8u13
    label_unit 1 3 13 a8u14
    label_unit 1 3 14 a8u15
    label_unit 1 3 15 a8u16
    label_unit 1 3 16 a8u17
    label_unit 1 3 17 a8u18
    label_unit 1 3 18 a8u19
    label_unit 1 3 19 a8u20

    define_unit_group army8 a8u1 a8u2 a8u3 a8u4 a8u5 a8u6 a8u7 a8u8 a8u9 a8u10 a8u11 a8u12 a8u13 a8u14 a8u15 a8u16 a8u17 a8u18 a8u19 a8u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army7 = 100
    set_counter army7_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army8 = 100
    set_counter army8_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army7 = 100
    and I_PercentageUnitGroupKilled army8 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 9
    label_unit 0 4 0 a9u1
    define_unit_group army9a a9u1
    if ! I_PercentageUnitGroupKilled army9a = 100
    undefine_unit_group army9a 	
    ;;;Army 9
    label_unit 0 4 0 a9u1
    label_unit 0 4 1 a9u2
    label_unit 0 4 2 a9u3
    label_unit 0 4 3 a9u4
    label_unit 0 4 4 a9u5
    label_unit 0 4 5 a9u6
    label_unit 0 4 6 a9u7
    label_unit 0 4 7 a9u8
    label_unit 0 4 8 a9u9
    label_unit 0 4 9 a9u10
    label_unit 0 4 10 a9u11
    label_unit 0 4 11 a9u12
    label_unit 0 4 12 a9u13
    label_unit 0 4 13 a9u14
    label_unit 0 4 14 a9u15
    label_unit 0 4 15 a9u16
    label_unit 0 4 16 a9u17
    label_unit 0 4 17 a9u18
    label_unit 0 4 18 a9u19
    label_unit 0 4 19 a9u20

    define_unit_group army9 a9u1 a9u2 a9u3 a9u4 a9u5 a9u6 a9u7 a9u8 a9u9 a9u10 a9u11 a9u12 a9u13 a9u14 a9u15 a9u16 a9u17 a9u18 a9u19 a9u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    define_unit_group army10a a10u1
    if ! I_PercentageUnitGroupKilled army10a = 100
    undefine_unit_group army10a 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    label_unit 1 4 1 a10u2
    label_unit 1 4 2 a10u3
    label_unit 1 4 3 a10u4
    label_unit 1 4 4 a10u5
    label_unit 1 4 5 a10u6
    label_unit 1 4 6 a10u7
    label_unit 1 4 7 a10u8
    label_unit 1 4 8 a10u9
    label_unit 1 4 9 a10u10
    label_unit 1 4 10 a10u11
    label_unit 1 4 11 a10u12
    label_unit 1 4 12 a10u13
    label_unit 1 4 13 a10u14
    label_unit 1 4 14 a10u15
    label_unit 1 4 15 a10u16
    label_unit 1 4 16 a10u17
    label_unit 1 4 17 a10u18
    label_unit 1 4 18 a10u19
    label_unit 1 4 19 a10u20

    define_unit_group army10 a10u1 a10u2 a10u3 a10u4 a10u5 a10u6 a10u7 a10u8 a10u9 a10u10 a10u11 a10u12 a10u13 a10u14 a10u15 a10u16 a10u17 a10u18 a10u19 a10u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army9 = 100
    set_counter army9_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army10 = 100
    set_counter army10_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army9 = 100
    and I_PercentageUnitGroupKilled army10 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 11
    label_unit 0 5 0 a11u1
    define_unit_group army11a a11u1
    if ! I_PercentageUnitGroupKilled army11a = 100
    undefine_unit_group army11a 	
    ;;;Army 11
    label_unit 0 5 0 a11u1
    label_unit 0 5 1 a11u2
    label_unit 0 5 2 a11u3
    label_unit 0 5 3 a11u4
    label_unit 0 5 4 a11u5
    label_unit 0 5 5 a11u6
    label_unit 0 5 6 a11u7
    label_unit 0 5 7 a11u8
    label_unit 0 5 8 a11u9
    label_unit 0 5 9 a11u10
    label_unit 0 5 10 a11u11
    label_unit 0 5 11 a11u12
    label_unit 0 5 12 a11u13
    label_unit 0 5 13 a11u14
    label_unit 0 5 14 a11u15
    label_unit 0 5 15 a11u16
    label_unit 0 5 16 a11u17
    label_unit 0 5 17 a11u18
    label_unit 0 5 18 a11u19
    label_unit 0 5 19 a11u20

    define_unit_group army11 a11u1 a11u2 a11u3 a11u4 a11u5 a11u6 a11u7 a11u8 a11u9 a11u10 a11u11 a11u12 a11u13 a11u14 a11u15 a11u16 a11u17 a11u18 a11u19 a11u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    define_unit_group army12a a12u1
    if ! I_PercentageUnitGroupKilled army12a = 100
    undefine_unit_group army12a 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    label_unit 1 5 1 a12u2
    label_unit 1 5 2 a12u3
    label_unit 1 5 3 a12u4
    label_unit 1 5 4 a12u5
    label_unit 1 5 5 a12u6
    label_unit 1 5 6 a12u7
    label_unit 1 5 7 a12u8
    label_unit 1 5 8 a12u9
    label_unit 1 5 9 a12u10
    label_unit 1 5 10 a12u11
    label_unit 1 5 11 a12u12
    label_unit 1 5 12 a12u13
    label_unit 1 5 13 a12u14
    label_unit 1 5 14 a12u15
    label_unit 1 5 15 a12u16
    label_unit 1 5 16 a12u17
    label_unit 1 5 17 a12u18
    label_unit 1 5 18 a12u19
    label_unit 1 5 19 a12u20

    define_unit_group army12 a12u1 a12u2 a12u3 a12u4 a12u5 a12u6 a12u7 a12u8 a12u9 a12u10 a12u11 a12u12 a12u13 a12u14 a12u15 a12u16 a12u17 a12u18 a12u19 a12u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army11 = 100
    set_counter army11_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army12 = 100
    set_counter army12_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army11 = 100
    and I_PercentageUnitGroupKilled army12 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 13
    label_unit 0 6 0 a13u1
    define_unit_group army13a a13u1
    if ! I_PercentageUnitGroupKilled army13a = 100
    undefine_unit_group army13a 	
    ;;;Army 13
    label_unit 0 6 0 a13u1
    label_unit 0 6 1 a13u2
    label_unit 0 6 2 a13u3
    label_unit 0 6 3 a13u4
    label_unit 0 6 4 a13u5
    label_unit 0 6 5 a13u6
    label_unit 0 6 6 a13u7
    label_unit 0 6 7 a13u8
    label_unit 0 6 8 a13u9
    label_unit 0 6 9 a13u10
    label_unit 0 6 10 a13u11
    label_unit 0 6 11 a13u12
    label_unit 0 6 12 a13u13
    label_unit 0 6 13 a13u14
    label_unit 0 6 14 a13u15
    label_unit 0 6 15 a13u16
    label_unit 0 6 16 a13u17
    label_unit 0 6 17 a13u18
    label_unit 0 6 18 a13u19
    label_unit 0 6 19 a13u20

    define_unit_group army13 a13u1 a13u2 a13u3 a13u4 a13u5 a13u6 a13u7 a13u8 a13u9 a13u10 a13u11 a13u12 a13u13 a13u14 a13u15 a13u16 a13u17 a13u18 a13u19 a13u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    define_unit_group army14a a14u1
    if ! I_PercentageUnitGroupKilled army14a = 100
    undefine_unit_group army14a 	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    label_unit 1 6 1 a14u2
    label_unit 1 6 2 a14u3
    label_unit 1 6 3 a14u4
    label_unit 1 6 4 a14u5
    label_unit 1 6 5 a14u6
    label_unit 1 6 6 a14u7
    label_unit 1 6 7 a14u8
    label_unit 1 6 8 a14u9
    label_unit 1 6 9 a14u10
    label_unit 1 6 10 a14u11
    label_unit 1 6 11 a14u12
    label_unit 1 6 12 a14u13
    label_unit 1 6 13 a14u14
    label_unit 1 6 14 a14u15
    label_unit 1 6 15 a14u16
    label_unit 1 6 16 a14u17
    label_unit 1 6 17 a14u18
    label_unit 1 6 18 a14u19
    label_unit 1 6 19 a14u20

    define_unit_group army14 a14u1 a14u2 a14u3 a14u4 a14u5 a14u6 a14u7 a14u8 a14u9 a14u10 a14u11 a14u12 a14u13 a14u14 a14u15 a14u16 a14u17 a14u18 a14u19 a14u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army13 = 100
    set_counter army13_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army14 = 100
    set_counter army14_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army13 = 100
    and I_PercentageUnitGroupKilled army14 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 15
    label_unit 0 7 0 a15u1
    define_unit_group army15a a15u1
    if ! I_PercentageUnitGroupKilled army15a = 100
    undefine_unit_group army15a 	
    ;;;Army 15
    label_unit 0 7 0 a15u1
    label_unit 0 7 1 a15u2
    label_unit 0 7 2 a15u3
    label_unit 0 7 3 a15u4
    label_unit 0 7 4 a15u5
    label_unit 0 7 5 a15u6
    label_unit 0 7 6 a15u7
    label_unit 0 7 7 a15u8
    label_unit 0 7 8 a15u9
    label_unit 0 7 9 a15u10
    label_unit 0 7 10 a15u11
    label_unit 0 7 11 a15u12
    label_unit 0 7 12 a15u13
    label_unit 0 7 13 a15u14
    label_unit 0 7 14 a15u15
    label_unit 0 7 15 a15u16
    label_unit 0 7 16 a15u17
    label_unit 0 7 17 a15u18
    label_unit 0 7 18 a15u19
    label_unit 0 7 19 a15u20

    define_unit_group army15 a15u1 a15u2 a15u3 a15u4 a15u5 a15u6 a15u7 a15u8 a15u9 a15u10 a15u11 a15u12 a15u13 a15u14 a15u15 a15u16 a15u17 a15u18 a15u19 a15u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    define_unit_group army16a a16u1
    if ! I_PercentageUnitGroupKilled army16a = 100
    undefine_unit_group army16a 	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    label_unit 1 7 1 a16u2
    label_unit 1 7 2 a16u3
    label_unit 1 7 3 a16u4
    label_unit 1 7 4 a16u5
    label_unit 1 7 5 a16u6
    label_unit 1 7 6 a16u7
    label_unit 1 7 7 a16u8
    label_unit 1 7 8 a16u9
    label_unit 1 7 9 a16u10
    label_unit 1 7 10 a16u11
    label_unit 1 7 11 a16u12
    label_unit 1 7 12 a16u13
    label_unit 1 7 13 a16u14
    label_unit 1 7 14 a16u15
    label_unit 1 7 15 a16u16
    label_unit 1 7 16 a16u17
    label_unit 1 7 17 a16u18
    label_unit 1 7 18 a16u19
    label_unit 1 7 19 a16u20

    define_unit_group army16 a16u1 a16u2 a16u3 a16u4 a16u5 a16u6 a16u7 a16u8 a16u9 a16u10 a16u11 a16u12 a16u13 a16u14 a16u15 a16u16 a16u17 a16u18 a16u19 a16u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army15 = 100
    set_counter army15_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army16 = 100
    set_counter army16_reinf_allied 1
    end_if
end_if

end_if
battle_wait 0.5
ai_active_set on

;;;;;;;Reinforcements

    ;;;;;;; Attacking
    if ! I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and ! I_BattleIsSiegeBattle
    and I_CompareCounter army3_reinf_allied = 1

    set_counter apply_strategy 1
;    battle_wait 1
;    set_counter att_alliance_ready 1
    end_if

    ;;;;;;; Defending
    if I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and I_CompareCounter army4_reinf_allied = 1

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    set_counter army4_ready 1
    set_counter def_alliance_ready 1
    end_if
    if ! I_BattleIsSiegeBattle
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 1
    set_counter sally_reinf 1
    end_if

    ;;;;;;; Siege
    if I_BattleIsSiegeBattle
    set_counter def_alliance_ready_siege 1
    end_if
    end_if
end_if
end_if
end_if
end_monitor

;Apply Strategy

monitor_conditions I_BattleStarted
    and I_CompareCounter apply_strategy = 1

if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 0 ATTACK_ALL
    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_0 1
end_if

if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 1 ATTACK_ALL
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_1 1
end_if

if I_CompareCounter launch_alliance_0 = 1
    and I_CompareCounter army3_reinf_allied = 1

    ;;;Army 1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u20
    ;;;Army 3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u20
if I_CompareCounter army5_reinf_allied = 1
    ;;;Army 5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u20
if I_CompareCounter army7_reinf_allied = 1
    ;;;Army 7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u20
if I_CompareCounter army9_reinf_allied = 1
     ;;;Army 9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u20
if I_CompareCounter army11_reinf_allied = 1
    ;;;Army 11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u20
if I_CompareCounter army13_reinf_allied = 1
    ;;;Army 13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u20
if I_CompareCounter army15_reinf_allied = 1
    ;;;Army 15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if

if I_CompareCounter launch_alliance_1 = 1
    and I_CompareCounter army4_reinf_allied = 1

    ;;;Army 2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u20
    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20
if I_CompareCounter army6_reinf_allied = 1
    ;;;Army 6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u20
if I_CompareCounter army8_reinf_allied = 1
    ;;;Army 8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u20
if I_CompareCounter army10_reinf_allied = 1
     ;;;Army 10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u20
if I_CompareCounter army12_reinf_allied = 1
    ;;;Army 12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u20
if I_CompareCounter army14_reinf_allied = 1
    ;;;Army 14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u20
if I_CompareCounter army16_reinf_allied = 1
    ;;;Army 16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if
battle_wait 0.5
ai_active_set on
set_counter apply_strategy 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter relaunch_movement = 1

    ai_active_set on
    battle_wait 0.5
    set_counter army3_moving 0
    set_counter army4_moving 0
    set_counter army5_moving 0
    set_counter army6_moving 0
    set_counter army7_moving 0
    set_counter army8_moving 0
    set_counter army9_moving 0
    set_counter army10_moving 0
    set_counter army11_moving 0
    set_counter army12_moving 0
    set_counter army13_moving 0
    set_counter army14_moving 0
    set_counter army15_moving 0
    set_counter army16_moving 0

    battle_wait 5
    set_counter relaunch_movement 0
end_monitor

;;;;;;; Attacking

monitor_conditions I_BattleStarted
    and I_CompareCounter att_alliance_ready = 1
    and ! I_BattlePlayerArmyIsAttacker
 ;    inc_counter reinf_check_interval 1
 if I_CompareCounter army3_reinf_allied = 1

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army3_moving 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and I_UnitDistanceFromUnit a1u1 a3u1 > 150
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_late 1
    battle_wait 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 0
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 1000

    set_counter army3_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 750

    set_counter army3_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 500

    set_counter army3_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 300

    set_counter army3_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 200

    set_counter army3_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    battle_wait 0.5
    set_counter army3_moving 1
    set_counter army3_reinf_late 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a3u1 > 60

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitGroupKilled army3 > 50

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army3 a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitUnderFire a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_run = 1

;    unit_group_order_halt army3
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army3 a1u1 run
    battle_wait 0.5
    set_counter army3_run 0
    end_if

end_if

if I_CompareCounter army5_reinf_allied = 1

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army5_moving 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and I_UnitDistanceFromUnit a1u1 a5u1 > 150
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_late 1
    battle_wait 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 0
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 1000

    set_counter army5_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 750

    set_counter army5_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 500

    set_counter army5_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 300

    set_counter army5_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 200

    set_counter army5_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    battle_wait 0.5
    set_counter army5_moving 1
    set_counter army5_reinf_late 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a5u1 > 60

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitGroupKilled army5 > 50

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army5 a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitUnderFire a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_run = 1

;    unit_group_order_halt army5
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army5 a1u1 run
    battle_wait 0.5
    set_counter army5_run 0
    end_if

end_if

if I_CompareCounter army7_reinf_allied = 1

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army7_moving 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and I_UnitDistanceFromUnit a1u1 a7u1 > 150
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_late 1
    battle_wait 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 0
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 1000

    set_counter army7_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 750

    set_counter army7_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 500

    set_counter army7_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 300

    set_counter army7_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 200

    set_counter army7_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    battle_wait 0.5
    set_counter army7_moving 1
    set_counter army7_reinf_late 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a7u1 > 60

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitGroupKilled army7 > 50

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army7 a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitUnderFire a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_run = 1

;    unit_group_order_halt army7
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army7 a1u1 run
    battle_wait 0.5
    set_counter army7_run 0
    end_if

end_if

if I_CompareCounter army9_reinf_allied = 1

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army9_moving 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and I_UnitDistanceFromUnit a1u1 a9u1 > 150
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_late 1
    battle_wait 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 0
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 1000

    set_counter army9_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 750

    set_counter army9_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 500

    set_counter army9_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 300

    set_counter army9_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 200

    set_counter army9_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    battle_wait 0.5
    set_counter army9_moving 1
    set_counter army9_reinf_late 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a9u1 > 60

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitGroupKilled army9 > 50

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army9 a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitUnderFire a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_run = 1

;    unit_group_order_halt army9
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army9 a1u1 run
    battle_wait 0.5
    set_counter army9_run 0
    end_if

end_if

if I_CompareCounter army11_reinf_allied = 1

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army11_moving 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and I_UnitDistanceFromUnit a1u1 a11u1 > 150
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_late 1
    battle_wait 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 0
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 1000

    set_counter army11_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 750

    set_counter army11_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 500

    set_counter army11_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 300

    set_counter army11_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 200

    set_counter army11_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    battle_wait 0.5
    set_counter army11_moving 1
    set_counter army11_reinf_late 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a11u1 > 60

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitGroupKilled army11 > 50

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army11 a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitUnderFire a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_run = 1

;    unit_group_order_halt army11
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army11 a1u1 run
    battle_wait 0.5
    set_counter army11_run 0
    end_if

end_if

if I_CompareCounter army13_reinf_allied = 1

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army13_moving 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and I_UnitDistanceFromUnit a1u1 a13u1 > 150
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_late 1
    battle_wait 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 0
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 1000

    set_counter army13_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 750

    set_counter army13_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 500

    set_counter army13_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 300

    set_counter army13_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 200

    set_counter army13_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    battle_wait 0.5
    set_counter army13_moving 1
    set_counter army13_reinf_late 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a13u1 > 60

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitGroupKilled army13 > 50

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army13 a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitUnderFire a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_run = 1

;    unit_group_order_halt army13
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army13 a1u1 run
    battle_wait 0.5
    set_counter army13_run 0
    end_if

end_if

if I_CompareCounter army15_reinf_allied = 1

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army15_moving 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and I_UnitDistanceFromUnit a1u1 a15u1 > 150
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_late 1
    battle_wait 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 0
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 1000

    set_counter army15_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 750

    set_counter army15_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 500

    set_counter army15_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 300

    set_counter army15_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 200

    set_counter army15_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    battle_wait 0.5
    set_counter army15_moving 1
    set_counter army15_reinf_late 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a15u1 > 60

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitGroupKilled army15 > 50

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army15 a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitUnderFire a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_run = 1

;    unit_group_order_halt army15
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army15 a1u1 run
    battle_wait 0.5
    set_counter army15_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_BattlePlayerArmyIsAttacker

;    inc_counter reinf_check_interval 1

if I_CompareCounter army4_reinf_allied = 1

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army4_moving 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_late 1
    battle_wait 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 1000

    set_counter army4_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 750

    set_counter army4_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 500

    set_counter army4_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300

    set_counter army4_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    battle_wait 0.5
    set_counter army4_moving 1
    set_counter army4_reinf_late 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a4u1 > 60

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army4 a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_run = 1

;    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army4 a2u1 run
    battle_wait 0.5
    set_counter army4_run 0
    end_if

end_if

if I_CompareCounter army6_reinf_allied = 1

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army6_moving 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and I_UnitDistanceFromUnit a2u1 a6u1 > 150
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_late 1
    battle_wait 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 0
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 1000

    set_counter army6_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 750

    set_counter army6_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 500

    set_counter army6_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 300

    set_counter army6_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200

    set_counter army6_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    battle_wait 0.5
    set_counter army6_moving 1
    set_counter army6_reinf_late 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a6u1 > 60

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitGroupKilled army6 > 50

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army6 a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitUnderFire a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_run = 1

;    unit_group_order_halt army6
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army6 a2u1 run
    battle_wait 0.5
    set_counter army6_run 0
    end_if

end_if

if I_CompareCounter army8_reinf_allied = 1

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army8_moving 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and I_UnitDistanceFromUnit a2u1 a8u1 > 150
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_late 1
    battle_wait 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 0
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 1000

    set_counter army8_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 750

    set_counter army8_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 500

    set_counter army8_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 300

    set_counter army8_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200

    set_counter army8_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    battle_wait 0.5
    set_counter army8_moving 1
    set_counter army8_reinf_late 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a8u1 > 60

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitGroupKilled army8 > 50

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army8 a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitUnderFire a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_run = 1

;    unit_group_order_halt army8
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army8 a2u1 run
    battle_wait 0.5
    set_counter army8_run 0
    end_if

end_if

if I_CompareCounter army10_reinf_allied = 1

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army10_moving 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and I_UnitDistanceFromUnit a2u1 a10u1 > 150
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_late 1
    battle_wait 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 0
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 1000

    set_counter army10_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 750

    set_counter army10_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 500

    set_counter army10_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 300

    set_counter army10_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200

    set_counter army10_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    battle_wait 0.5
    set_counter army10_moving 1
    set_counter army10_reinf_late 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a10u1 > 60

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitGroupKilled army10 > 50

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army10 a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitUnderFire a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_run = 1

;    unit_group_order_halt army10
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army10 a2u1 run
    battle_wait 0.5
    set_counter army10_run 0
    end_if

end_if

if I_CompareCounter army12_reinf_allied = 1

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army12_moving 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and I_UnitDistanceFromUnit a2u1 a12u1 > 150
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_late 1
    battle_wait 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 0
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 1000

    set_counter army12_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 750

    set_counter army12_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 500

    set_counter army12_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 300

    set_counter army12_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200

    set_counter army12_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    battle_wait 0.5
    set_counter army12_moving 1
    set_counter army12_reinf_late 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a12u1 > 60

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitGroupKilled army12 > 50

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army12 a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitUnderFire a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_run = 1

;    unit_group_order_halt army12
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army12 a2u1 run
    battle_wait 0.5
    set_counter army12_run 0
    end_if

end_if

if I_CompareCounter army14_reinf_allied = 1

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army14_moving 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and I_UnitDistanceFromUnit a2u1 a14u1 > 150
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_late 1
    battle_wait 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 0
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 1000

    set_counter army14_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 750

    set_counter army14_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 500

    set_counter army14_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 300

    set_counter army14_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200

    set_counter army14_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    battle_wait 0.5
    set_counter army14_moving 1
    set_counter army14_reinf_late 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a14u1 > 60

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitGroupKilled army14 > 50

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army14 a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitUnderFire a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_run = 1

;    unit_group_order_halt army14
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army14 a2u1 run
    battle_wait 0.5
    set_counter army14_run 0
    end_if

end_if

if I_CompareCounter army16_reinf_allied = 1

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army16_moving 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and I_UnitDistanceFromUnit a2u1 a16u1 > 150
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_late 1
    battle_wait 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 0
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 1000

    set_counter army16_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 750

    set_counter army16_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 500

    set_counter army16_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 300

    set_counter army16_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200

    set_counter army16_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    battle_wait 0.5
    set_counter army16_moving 1
    set_counter army16_reinf_late 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a16u1 > 60

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitGroupKilled army16 > 50

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army16 a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitUnderFire a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_run = 1

;    unit_group_order_halt army16
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army16 a2u1 run
    battle_wait 0.5
    set_counter army16_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending Siege

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready_siege = 1
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter army4_ready_siege = 1

;    inc_counter reinf_check_interval 1

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and I_UnitEnemyUnitInRadius a4u1 160

    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    set_counter army4_moving_siege 0
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_run_siege 1
    battle_wait 2
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run_siege 1
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromPosition a4u1 1 1 < 150

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_run_siege = 1

    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_move_formed army4 1 1 run
    set_counter army4_run_siege 0
    end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;;;;;;Sally-out, AI defending

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 1

    if I_UnitDistanceFromPosition a4u1 0 850 < 200
    set_counter army4_location 1 ;north
    end_if
    if I_UnitDistanceFromPosition a4u1 0 -850 < 200
    set_counter army4_location 2 ;south
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 0 < 200
    set_counter army4_location 3 ;west
    end_if
    if I_UnitDistanceFromPosition a4u1 850 0 < 200
    set_counter army4_location 4 ;east
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 5 ;nw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 850 < 200
    set_counter army4_location 6 ;ne
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 7 ;sw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 -850 < 200
    set_counter army4_location 8 ;se
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    set_counter	path_s 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    set_counter	path_sw 4
    set_counter	path_s 5
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    set_counter	path_n 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    set_counter	path_nw 4
    set_counter	path_n 5
    end_if
    end_if

    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    set_counter	path_e 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    set_counter	path_ne 4
    set_counter	path_e 5
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    set_counter	path_w 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    set_counter	path_sw 4
    set_counter	path_w 5
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if

    if I_CompareCounter army4_location = 5 ;nw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if

    if I_CompareCounter army4_location = 6 ;ne
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7 ;sw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if

    if I_CompareCounter army4_location = 8 ;se
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_north = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_south = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_west = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_east = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_ready_sally = 1
    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_change_group_formation army4 ai_infantry_protecting
;	battle_wait 45
    battle_wait 20
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    battle_wait 25
    end_if
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 2
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter label_army4 = 1

    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

;    unit_group_order_halt army4
    set_counter label_army4 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter army4_moving_s = 1
    and I_UnitEnemyUnitInRadius a4u1 130
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on

    set_counter army4_moving_s 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_n = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    set_counter path_n 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_ne = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    set_counter path_n 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 30
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_s = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 -700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    set_counter path_s 0
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_sw = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    set_counter path_s 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_w = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_sw = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_e = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_ne = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_nw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    set_counter path_nw 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_w = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_ne = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    set_counter path_ne 0
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_e = 0
    and I_CompareCounter path_n = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_sw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    set_counter path_sw 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_se = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    set_counter path_se 0
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_s = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 3

    set_counter army4_ready_sally 0
    unit_group_order_halt army4
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_IsUnitRouting a4u1

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_PercentageUnitKilled a4u1 > 80

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2

    if I_IsUnitGroupIdle army4
    inc_counter army4_idle_r 1
    end_if

    if ! I_IsUnitGroupIdle army4
    set_counter army4_idle_r 0
    end_if

    if I_CompareCounter army4_idle_r > 12
    set_counter army4_ready_sally 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_n = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_n 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_s = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_s 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_w = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_w 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_e = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_e 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_nw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_nw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_ne = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_ne 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_sw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_sw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_se = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_se 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;################## Germanicu5 Integrated Stakes script ###########################

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
    and ! I_ConflictType SuccessfulAmbush
    and ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.0
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.5
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 4
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 1.7
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 2.2
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter stakes_on = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    and I_UnitEnemyUnitInRadius a2u1 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    and I_UnitEnemyUnitInRadius a2u2 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    and I_UnitEnemyUnitInRadius a2u3 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    and I_UnitEnemyUnitInRadius a2u4 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    and I_UnitEnemyUnitInRadius a2u5 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    and I_UnitEnemyUnitInRadius a2u6 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    and I_UnitEnemyUnitInRadius a2u7 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    and I_UnitEnemyUnitInRadius a2u8 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    and I_UnitEnemyUnitInRadius a2u9 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    and I_UnitEnemyUnitInRadius a2u10 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    and I_UnitEnemyUnitInRadius a2u11 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    and I_UnitEnemyUnitInRadius a2u12 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    and I_UnitEnemyUnitInRadius a2u13 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    and I_UnitEnemyUnitInRadius a2u14 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    and I_UnitEnemyUnitInRadius a2u15 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    and I_UnitEnemyUnitInRadius a2u16 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    and I_UnitEnemyUnitInRadius a2u17 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    and I_UnitEnemyUnitInRadius a2u18 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    and I_UnitEnemyUnitInRadius a2u19 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    and I_UnitEnemyUnitInRadius a2u20 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

if I_CompareCounter stakes_on = 2
;    ai_active_set off
    unit_group_order_halt army2

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    unit_deploy_stakes a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    unit_deploy_stakes a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    unit_deploy_stakes a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    unit_deploy_stakes a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    unit_deploy_stakes a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    unit_deploy_stakes a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    unit_deploy_stakes a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    unit_deploy_stakes a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    unit_deploy_stakes a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    unit_deploy_stakes a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    unit_deploy_stakes a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    unit_deploy_stakes a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    unit_deploy_stakes a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    unit_deploy_stakes a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    unit_deploy_stakes a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    unit_deploy_stakes a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    unit_deploy_stakes a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    unit_deploy_stakes a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    unit_deploy_stakes a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter stakes_on 0
end_if
    battle_wait 1.5
end_monitor

monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    and I_BattlePlayerArmyIsAttacker
    and I_BattleIsSiegeBattle
    and I_CompareCounter panel_check = 1
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    unit_deploy_stakes a2u1

    if I_CompareCounter enemy_unit_count > 1
    unit_deploy_stakes a2u2

    if I_CompareCounter enemy_unit_count > 2
    unit_deploy_stakes a2u3

    if I_CompareCounter enemy_unit_count > 3
    unit_deploy_stakes a2u4

    if I_CompareCounter enemy_unit_count > 4
    unit_deploy_stakes a2u5

    if I_CompareCounter enemy_unit_count > 5
    unit_deploy_stakes a2u6

    if I_CompareCounter enemy_unit_count > 6
    unit_deploy_stakes a2u7

    if I_CompareCounter enemy_unit_count > 7
    unit_deploy_stakes a2u8

    if I_CompareCounter enemy_unit_count > 8
    unit_deploy_stakes a2u9

    if I_CompareCounter enemy_unit_count > 9
    unit_deploy_stakes a2u10

    if I_CompareCounter enemy_unit_count > 10
    unit_deploy_stakes a2u11

    if I_CompareCounter enemy_unit_count > 11
    unit_deploy_stakes a2u12

    if I_CompareCounter enemy_unit_count > 12
    unit_deploy_stakes a2u13

    if I_CompareCounter enemy_unit_count > 13
    unit_deploy_stakes a2u14

    if I_CompareCounter enemy_unit_count > 14
    unit_deploy_stakes a2u15

    if I_CompareCounter enemy_unit_count > 15
    unit_deploy_stakes a2u16

    if I_CompareCounter enemy_unit_count > 16
    unit_deploy_stakes a2u17

    if I_CompareCounter enemy_unit_count > 17
    unit_deploy_stakes a2u18

    if I_CompareCounter enemy_unit_count > 18
    unit_deploy_stakes a2u19

    if I_CompareCounter enemy_unit_count = 20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter label_ready 0
end_monitor

;;;;;;;;HA fix;;;;;;;;;;;;

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ha_fix = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
;    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
;    and I_UnitEnemyUnitInRadius a2u1 250
;    ai_gta_plan_set 1 ATTACK_ALL
;    set_counter ha_fix 0
;    set_counter ob_defense_launch 0
;    set_counter ob_defend 4
;end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60

    ai_gta_plan_set 0 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ha_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAssaultingCrossing
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry >= 60

    ai_gta_add_objective 0 ASSAULT_CROSSING 999

;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 0 0 a1u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 0 0 a1u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 0 0 a1u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 0 0 a1u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 0 0 a1u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 0 0 a1u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 0 0 a1u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 0 0 a1u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 0 0 a1u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 0 0 a1u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 0 0 a1u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 0 0 a1u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 0 0 a1u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 0 0 a1u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 0 0 a1u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 0 0 a1u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 0 0 a1u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 0 0 a1u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 0 0 a1u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    battle_wait 0.5
    ai_active_set on

    set_counter ha_fix 0
end_monitor

;;;;;;;;Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off
    unit_group_order_halt army1

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    unit_group_order_halt army1
    battle_wait 0.5
    unit_group_order_change_group_formation army1 ai_wall_assault
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective = 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective 2
    battle_wait 15
    if I_CompareCounter del_objective = 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2 = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSiegeBattle
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 1
    set_counter elephant_gate_tier2 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3 = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring 1
    set_counter elephant_gate_tier3 0
end_monitor

;;;;;;;;Sally-Out Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective_s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective_s 2
    battle_wait 15
    if I_CompareCounter del_objective_s = 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter second_ring_s 1
    set_counter elephant_gate_tier2s 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring_s 1
    set_counter elephant_gate_tier3s 0
end_monitor

;;;;;;;Elephants Gate and Walls
monitor_event BattleBattleGatesDestroyedByEngine TrueCondition ;wtf
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 2
    set_counter rally_walls 0
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 2
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate_s 2
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring_s 2
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

;;;;;;;Sally Out Assault
monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.0

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 3
    and I_BattlePlayerAllianceOddsAgainst > 2.5

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.7

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.2

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.8

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

;;;;;;;Sally Out Defense

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 1 0 a2u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 1 0 a2u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 1 0 a2u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 1 0 a2u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 1 0 a2u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 1 0 a2u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 1 0 a2u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 1 0 a2u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 1 0 a2u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 1 0 a2u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 1 0 a2u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 1 0 a2u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 1 0 a2u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 1 0 a2u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 1 0 a2u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 1 0 a2u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 1 0 a2u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 1 0 a2u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 1 0 a2u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    set_counter sally_defense 2
    set_counter defend_location 1
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter repeat_test1 = 1
set_counter repeat_test1 2
end_if
if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 0

set_counter unit_under_fire 0
set_counter repeat_test1 1
;battle_wait 10
end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_BattleIsSallyOutBattle
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi < 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 660
    and I_UnitGroupDistanceFromPosition army2 1 1 < 630
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test2 = 1
    set_counter repeat_test2 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test2 = 0

    set_counter repeat_test2 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test2 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reform_multi 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if
set_counter reform_back 0
if I_CompareCounter repeat_test2 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 620
    and I_UnitGroupDistanceFromPosition army2 1 1 < 600
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test3 = 1
    set_counter repeat_test3 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test3 = 0

    set_counter repeat_test3 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test3 = 2

    if ! I_UnitEnemyUnitInRadius a2u1 150
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, -100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, -100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if
    set_counter reform_multi 1

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_UnitEnemyUnitInRadius a2u1 150
    set_counter sally_defense 3
    battle_wait 7
    end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test3 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 3
;	and I_UnitDistanceFromPosition a2u1 1 1 < 580
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test4 = 1
    set_counter repeat_test4 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test4 = 0

    set_counter repeat_test4 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test4 = 2

    if I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -700, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 700, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 700, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -700, 0, 100
    end_if
    set_counter reform_multi 2
    end_if
    if ! I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if
    set_counter reform_multi 1
    end_if
    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test4 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6
    if I_CompareCounter army_south = 1
    and I_UnitDistanceFromLine a2u1 sw se < 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_north = 1
    and I_UnitDistanceFromLine a2u1 nw ne > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_west = 1
    and I_UnitDistanceFromLine a2u1 sw nw > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_east = 1
    and I_UnitDistanceFromLine a2u1 se ne < 0
    set_counter line_passed 1
    end_if

if I_CompareCounter line_passed = 1

    set_counter line_passed 0

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test5 = 1
    set_counter repeat_test5 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test5 = 0

    set_counter repeat_test5 1
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test5 = 2

if ! I_UnitEnemyUnitInRadius a2u1 20

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if
if I_UnitEnemyUnitInRadius a2u1 20
set_counter sally_defense 3
battle_wait 20
end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test5 = 1
battle_wait 10
end_if
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0  ;check
    and I_CompareCounter reform_multi > 2
    and ! I_IsUnitGroupEngaged army2
    and I_UnitEnemyUnitInRadius a2u1 160
;	and I_UnitDistanceFromPosition a2u1 1 1 < 560
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
;	and I_BattleSettlementFortificationLevel > 2

    if I_CompareCounter enemy_unit_count > 0
    and I_IsUnitUnderFire a2u1
    and ! I_IsUnitEngaged a2u1
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging
    and ! I_UnitStatus a2u1 moving
    inc_counter reset_position 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_IsUnitUnderFire a2u2
    and ! I_IsUnitEngaged a2u2
    and ! I_UnitStatus a2u2 pursuing
    and ! I_UnitStatus a2u2 charging
    and ! I_UnitStatus a2u2 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_IsUnitUnderFire a2u3
    and ! I_IsUnitEngaged a2u3
    and ! I_UnitStatus a2u3 pursuing
    and ! I_UnitStatus a2u3 charging
    and ! I_UnitStatus a2u3 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_IsUnitUnderFire a2u4
    and ! I_IsUnitEngaged a2u4
    and ! I_UnitStatus a2u4 pursuing
    and ! I_UnitStatus a2u4 charging
    and ! I_UnitStatus a2u4 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_IsUnitUnderFire a2u5
    and ! I_IsUnitEngaged a2u5
    and ! I_UnitStatus a2u5 pursuing
    and ! I_UnitStatus a2u5 charging
    and ! I_UnitStatus a2u5 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_IsUnitUnderFire a2u6
    and ! I_IsUnitEngaged a2u6
    and ! I_UnitStatus a2u6 pursuing
    and ! I_UnitStatus a2u6 charging
    and ! I_UnitStatus a2u6 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_IsUnitUnderFire a2u7
    and ! I_IsUnitEngaged a2u7
    and ! I_UnitStatus a2u7 pursuing
    and ! I_UnitStatus a2u7 charging
    and ! I_UnitStatus a2u7 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_IsUnitUnderFire a2u8
    and ! I_IsUnitEngaged a2u8
    and ! I_UnitStatus a2u8 pursuing
    and ! I_UnitStatus a2u8 charging
    and ! I_UnitStatus a2u8 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_IsUnitUnderFire a2u9
    and ! I_IsUnitEngaged a2u9
    and ! I_UnitStatus a2u9 pursuing
    and ! I_UnitStatus a2u9 charging
    and ! I_UnitStatus a2u9 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_IsUnitUnderFire a2u10
    and ! I_IsUnitEngaged a2u10
    and ! I_UnitStatus a2u10 pursuing
    and ! I_UnitStatus a2u10 charging
    and ! I_UnitStatus a2u10 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_IsUnitUnderFire a2u11
    and ! I_IsUnitEngaged a2u11
    and ! I_UnitStatus a2u11 pursuing
    and ! I_UnitStatus a2u11 charging
    and ! I_UnitStatus a2u11 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_IsUnitUnderFire a2u12
    and ! I_IsUnitEngaged a2u12
    and ! I_UnitStatus a2u12 pursuing
    and ! I_UnitStatus a2u12 charging
    and ! I_UnitStatus a2u12 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_IsUnitUnderFire a2u13
    and ! I_IsUnitEngaged a2u13
    and ! I_UnitStatus a2u13 pursuing
    and ! I_UnitStatus a2u13 charging
    and ! I_UnitStatus a2u13 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_IsUnitUnderFire a2u14
    and ! I_IsUnitEngaged a2u14
    and ! I_UnitStatus a2u14 pursuing
    and ! I_UnitStatus a2u14 charging
    and ! I_UnitStatus a2u14 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_IsUnitUnderFire a2u15
    and ! I_IsUnitEngaged a2u15
    and ! I_UnitStatus a2u15 pursuing
    and ! I_UnitStatus a2u15 charging
    and ! I_UnitStatus a2u15 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_IsUnitUnderFire a2u16
    and ! I_IsUnitEngaged a2u16
    and ! I_UnitStatus a2u16 pursuing
    and ! I_UnitStatus a2u16 charging
    and ! I_UnitStatus a2u16 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_IsUnitUnderFire a2u17
    and ! I_IsUnitEngaged a2u17
    and ! I_UnitStatus a2u17 pursuing
    and ! I_UnitStatus a2u17 charging
    and ! I_UnitStatus a2u17 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_IsUnitUnderFire a2u18
    and ! I_IsUnitEngaged a2u18
    and ! I_UnitStatus a2u18 pursuing
    and ! I_UnitStatus a2u18 charging
    and ! I_UnitStatus a2u18 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_IsUnitUnderFire a2u19
    and ! I_IsUnitEngaged a2u19
    and ! I_UnitStatus a2u19 pursuing
    and ! I_UnitStatus a2u19 charging
    and ! I_UnitStatus a2u19 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_IsUnitUnderFire a2u20
    and ! I_IsUnitEngaged a2u20
    and ! I_UnitStatus a2u20 pursuing
    and ! I_UnitStatus a2u20 charging
    and ! I_UnitStatus a2u20 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitUnderFire a4u1
    and ! I_IsUnitEngaged a4u1
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitStatus a4u1 moving
    inc_counter reset_position 2
    end_if

if I_CompareCounter reset_position > 3

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 1
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
end_if

if I_CompareCounter sally_defense != 2
set_counter sally_defense 3
battle_wait 15
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_defense > 0
    and I_UnitEnemyUnitInRadius a2u1 200

    if ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupMoving army2
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging

    inc_counter army2_idle_s 1
    end_if

    if I_CompareCounter army2_idle_s > 5
    set_counter army2_idle_s 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
    end_if

    if I_IsUnitGroupEngaged army2
    set_counter army2_idle_s 0
    end_if
    if I_IsUnitGroupMoving army2
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 pursuing
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 charging
    set_counter army2_idle_s 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 2
    and I_BattleSettlementFortificationLevel > 2
;	and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitEnemyUnitInRadius a2u1 80

    set_counter sally_defense 6
    set_counter wall_line_passed 0
    set_counter reset_position_s 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitEngaged a2u1
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reset_position_s 2
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitEngaged a2u2
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitEngaged a2u3
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitEngaged a2u4
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitEngaged a2u5
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitEngaged a2u6
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitEngaged a2u7
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitEngaged a2u8
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitEngaged a2u9
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitEngaged a2u10
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitEngaged a2u11
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitEngaged a2u12
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitEngaged a2u13
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitEngaged a2u14
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitEngaged a2u15
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitEngaged a2u16
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitEngaged a2u17
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitEngaged a2u18
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitEngaged a2u19
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitEngaged a2u20
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reset_position_s 1
    end_if
    end_if

if I_CompareCounter reset_position_s = 0
    if I_CompareCounter army_south = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
end_if

    if I_CompareCounter repeat_test6 = 1
    set_counter repeat_test6 2
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 0

    set_counter repeat_test6 1
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position_s 0
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_CompareCounter sally_defense != 2
    set_counter sally_defense 3
    end_if
    if I_CompareCounter wall_line_passed > 0
    battle_wait 15
    end_if
    if I_CompareCounter reset_position_s > 0
    battle_wait 15
    end_if
    if I_CompareCounter repeat_test6 = 1
    battle_wait 20
    end_if
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0
    and I_CompareCounter kill_sally = 0
    and I_IsUnitRouting a2u1
    and ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupDestroyed army2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if

    set_counter sally_defense 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 1
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter reset_army2 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter assign_labels 2
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 2
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter assign_labels 1
end_monitor

;;;Sally Reinforcements

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_reinf = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsUnitEngaged a4u1

    if I_CompareCounter sally_defense < 3
    set_counter defend_location 1
    set_counter sally_reinf 2
    end_if

    if I_CompareCounter sally_defense > 2

    set_counter defend_location 2
    set_counter sally_reinf 2
    end_if

end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense < 3
    and I_CompareCounter sally_defense != 1
    and I_CompareCounter defend_location = 1
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitEnemyUnitInRadius a4u1 20

     ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

    battle_wait 0.5
    ai_active_set on

    set_counter defend_location 0
;	set_counter army4_idle_s 0
battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense > 2
    and I_CompareCounter defend_location = 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0

    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter defend_location 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
;	and I_CompareCounter sally_defense > 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_CompareCounter defend_location = 0
;    and I_UnitEnemyUnitInRadius a4u1 200

    if ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupMoving army4
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging

    inc_counter army4_idle_s 1
    end_if
    if I_CompareCounter army4_idle_s > 5
    set_counter defend_location 1
    set_counter sally_defense 2
    end_if

    if I_IsUnitGroupEngaged army4
    set_counter army4_idle_s 0
    end_if
    if I_IsUnitGroupMoving army4
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 pursuing
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 charging
    set_counter army4_idle_s 0
    end_if
    battle_wait 10
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitGroupDestroyed army4
    and I_BattleIsSallyOutBattle

    set_counter sally_reinf 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_UnitDestroyed a4u1
    and I_BattleIsSallyOutBattle

    set_counter label_army4 1
;    battle_wait 0.5
;    unit_group_enable_automation army4 false
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_reinf 0
end_monitor

;################## Germanicu5 Integrated Protect General script ###########################

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_CompareCounter enemy_unit_count > 4

    battle_wait 10

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    and I_CompareCounter protect_siege = 1
    set_counter protect_general 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1
    set_counter protect_general 1
    end_if
end_monitor

monitor_event BattleBattleGatesDestroyedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter kill_sally = 1
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a1u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a1u1
    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 3
    release_unit a1u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a2u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a2u1

    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 3
    release_unit a2u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    set_counter general_wait 0
    release_unit a1u1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    set_counter general_wait 0
    release_unit a2u1
end_monitor

;################## Germanicu5 Integrated Siege script ###########################

monitor_conditions I_BattleStarted
    and ! I_BattleIsFortBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_BattleSettlementFortificationLevel > 0
    and I_CompareCounter siege_fix = 1

    set_counter siege_fix 0

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    set_counter army_sieging 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
end_monitor

;;;;;;;Sally Out

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter reset_army2 = 1

    set_counter reset_army2 0
    set_counter enemy_unit_count 0

    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;;;;;;;Huge City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 35

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 10
    battle_wait 30

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 10
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 14
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 14
    set_counter sally_check 15
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 15
    set_counter sally_check 16
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 16
    set_counter sally_check 17
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 17
    set_counter sally_check 18
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 18
    set_counter sally_check 19
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 19
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 80

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 60
    set_counter sally_check 20
    battle_wait 30
if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 20
    set_counter sally_check 21
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 21
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 24
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 24
    set_counter sally_check 25
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 25
    set_counter sally_check 26
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 26
    set_counter sally_check 27
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 27
    set_counter sally_check 28
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 28
    set_counter sally_check 29
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 29
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_if
end_monitor

;;;;;;;Large City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 45

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 30
    battle_wait 37

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 30
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 34
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 34
    set_counter sally_check 35
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 35
    set_counter sally_check 36
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 36
    set_counter sally_check 37
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 37
    set_counter sally_check 38
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 38
    set_counter sally_check 39
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 39
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 90

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 70
    set_counter sally_check 40
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 40
    set_counter sally_check 41
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 41
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 44
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 44
    set_counter sally_check 45
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 45
    set_counter sally_check 46
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 46
    set_counter sally_check 47
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 47
    set_counter sally_check 48
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 48
    set_counter sally_check 49
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 49
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Castle, Citadel and Fortress

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 100

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 75
    set_counter sally_check 50
    battle_wait 15
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 50
    set_counter sally_check 51
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 51
    set_counter sally_check 52
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 52
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 54
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 54
    set_counter sally_check 55
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 55
    set_counter sally_check 56
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 56
    set_counter sally_check 57
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 57
    set_counter sally_check 58
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 58
    set_counter sally_check 59
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 59
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 170

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 125
    set_counter sally_check 60
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 60
    set_counter sally_check 61
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 61
    set_counter sally_check 62
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 62
    set_counter sally_check 63
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 63
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 64
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 64
    set_counter sally_check 65
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 65
    set_counter sally_check 66
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 66
    set_counter sally_check 67
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 67
    set_counter sally_check 68
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 68
    set_counter sally_check 69
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 69
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Wall Advance

monitor_conditions I_BattleStarted
    and I_CompareCounter wall_advance_s = 1
    and I_CompareCounter kill_sally = 1
    and I_BattleIsSallyOutBattle

    battle_wait 2
    if I_BattleSettlementFortificationLevel < 3
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 95
    end_if

    if I_BattleSettlementFortificationLevel > 2
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 200
    end_if

    set_counter emergency_stop 1
    if I_BattleSettlementFortificationLevel < 3
;	battle_wait 72
    set_counter sally_check 113
    battle_wait 36
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 36
    end_if
    end_if
    if I_BattleSettlementFortificationLevel > 2
;	battle_wait 145
    set_counter sally_check 110
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 110
    set_counter sally_check 111
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 111
    set_counter sally_check 112
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 112
    set_counter sally_check 113
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 30
    end_if
    end_if

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 114
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1

    set_counter emergency_stop 0
    unit_group_order_halt army2
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    set_counter wall_advance_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter omfg_cannon_tower > 0

    set_counter omfg_cannon_tower 2
if I_CompareCounter player_unit_count > 0
    if I_UnitStatus a1u1 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u1 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u2 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u2 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u3 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u3 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u4 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u4 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u5 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u5 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u6 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u6 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u7 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u7 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u8 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u8 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u9 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u9 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u10 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u10 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u11 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u11 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u12 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u12 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u13 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u13 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u14 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u14 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u15 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u15 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u16 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u16 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u17 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u17 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u18 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u18 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u19 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u19 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 19
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u20 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u20 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_CompareCounter omfg_cannon_tower = 2

    if I_CompareCounter enemy_unit_count > 0
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u1
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u2
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u3
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u4
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u5
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u6
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u7
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u8
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u9
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u10
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u11
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u12
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u13
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u14
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u15
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u16
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u17
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u18
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u19
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u20
    set_counter omfg_cannon_tower 3
    end_if
end_if

    if I_CompareCounter omfg_cannon_tower = 3
    set_counter omfg_cannon_tower 0
    set_counter emergency_stop 0
;    ai_active_set off
;    battle_wait 0.5
    ai_active_set on
    end_if
    battle_wait 7
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter emergency_stop = 1
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1

    if I_BattleIsSiegeBattle
    unit_group_order_halt army1
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
    if I_BattleIsSallyOutBattle
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
end_monitor

;################## Open Battles #################

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 0
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 2

    if I_UnitDistanceFromUnit a1u1 a2u1 < 220
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitDistanceFromUnit a1u1 a2u1 < 270
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattlePlayerAllianceOddsInFavour > 1.7
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    set_counter ob_repeat_test 1
    end_if
;    if I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
;    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleEnemyUnitClass != missile
    and BattleEnemyUnitClass != skirmish
    and BattleDirectionOfAttack != front
    and BattleRangeOfAttack < 200

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and BattleDirectionOfAttack != rear
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleRangeOfAttack < 200
    and BattlePlayerUnitCategory infantry

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a2u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitEnemyUnitInRadius a2u1 250
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4

    set_counter player_units_closing 0

    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromUnit a1u1 a2u1 < 180
    and ! I_UnitStatus a1u1 missiles_firing
    and ! I_UnitStatus a1u1 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromUnit a1u2 a2u1 < 180
    and ! I_UnitStatus a1u2 missiles_firing
    and ! I_UnitStatus a1u2 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromUnit a1u3 a2u1 < 180
    and ! I_UnitStatus a1u3 missiles_firing
    and ! I_UnitStatus a1u3 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromUnit a1u4 a2u1 < 180
    and ! I_UnitStatus a1u4 missiles_firing
    and ! I_UnitStatus a1u4 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromUnit a1u5 a2u1 < 180
    and ! I_UnitStatus a1u5 missiles_firing
    and ! I_UnitStatus a1u5 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromUnit a1u6 a2u1 < 180
    and ! I_UnitStatus a1u6 missiles_firing
    and ! I_UnitStatus a1u6 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromUnit a1u7 a2u1 < 180
    and ! I_UnitStatus a1u7 missiles_firing
    and ! I_UnitStatus a1u7 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromUnit a1u8 a2u1 < 180
    and ! I_UnitStatus a1u8 missiles_firing
    and ! I_UnitStatus a1u8 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromUnit a1u9 a2u1 < 180
    and ! I_UnitStatus a1u9 missiles_firing
    and ! I_UnitStatus a1u9 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromUnit a1u10 a2u1 < 180
    and ! I_UnitStatus a1u10 missiles_firing
    and ! I_UnitStatus a1u10 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromUnit a1u11 a2u1 < 180
    and ! I_UnitStatus a1u11 missiles_firing
    and ! I_UnitStatus a1u11 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromUnit a1u12 a2u1 < 180
    and ! I_UnitStatus a1u12 missiles_firing
    and ! I_UnitStatus a1u12 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromUnit a1u13 a2u1 < 180
    and ! I_UnitStatus a1u13 missiles_firing
    and ! I_UnitStatus a1u13 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromUnit a1u14 a2u1 < 180
    and ! I_UnitStatus a1u14 missiles_firing
    and ! I_UnitStatus a1u14 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromUnit a1u15 a2u1 < 180
    and ! I_UnitStatus a1u15 missiles_firing
    and ! I_UnitStatus a1u15 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromUnit a1u16 a2u1 < 180
    and ! I_UnitStatus a1u16 missiles_firing
    and ! I_UnitStatus a1u16 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromUnit a1u17 a2u1 < 180
    and ! I_UnitStatus a1u17 missiles_firing
    and ! I_UnitStatus a1u17 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromUnit a1u18 a2u1 < 180
    and ! I_UnitStatus a1u18 missiles_firing
    and ! I_UnitStatus a1u18 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromUnit a1u19 a2u1 < 180
    and ! I_UnitStatus a1u19 missiles_firing
    and ! I_UnitStatus a1u19 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromUnit a1u20 a2u1 < 180
    and ! I_UnitStatus a1u20 missiles_firing
    and ! I_UnitStatus a1u20 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_units_closing > 1
    inc_counter player_enveloping 1
    end_if
    if I_CompareCounter player_units_closing < 1
    set_counter player_enveloping 0
    end_if
    if I_CompareCounter player_enveloping > 5
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    battle_wait 10
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and BattleIsMeleeAttack
    and BattleEnemyUnitClass heavy
    and BattleEnemyUnitCategory cavalry
    and ! BattlePlayerUnitClass heavy
    and ! BattlePlayerUnitClass heavy
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    inc_counter ob_engaged -1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    if I_PercentageOfArmyKilled 0 0 < 5
    and I_PercentageOfArmyKilled 1 0 > 10
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 10
    and I_PercentageOfArmyKilled 1 0 > 20
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 15
    and I_PercentageOfArmyKilled 1 0 > 25
    set_counter ob_repeat_test 4
    end_if
    battle_wait 30
end_monitor

;monitor_event BattlePlayerUnitAttacksEnemyUnit TrueCondition
;    and I_CompareCounter panel_check = 1
;    and I_CompareCounter ob_defense_launch = 1
;    and ! I_CompareCounter ob_defend > 1
;    and BattlePlayerUnitCategory siege
;    and BattlePlayerUnitClass missile
;    and BattleRangeOfAttack < 400
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    set_counter ob_siege_attack 1
;end_monitor

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ob_defense_launch = 1
;    and I_CompareCounter ob_siege_attack = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    if I_PercentageOfArmyKilled 0 0 < 3
;    and I_PercentageOfArmyKilled 1 0 > 5
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    if I_PercentageOfArmyKilled 0 0 < 5
;    and I_PercentageOfArmyKilled 1 0 > 10
;    if I_CompareCounter ob_repeat_test < 2
;    set_counter ob_repeat_test 2
;    end_if
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    battle_wait 30
;end_monitor

;;;;;; Reinf triggers

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter player_engaged_reinf = 4
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
    end_if

    if I_IsUnitGroupEngaged army1
    inc_counter player_engaged_reinf 1
    end_if

    if I_CompareCounter player_engaged_reinf > 0
    and ! I_IsUnitGroupEngaged army1
    set_counter player_engaged_reinf 0
    end_if

    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_PercentageUnitGroupKilled army4 > 10
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a4u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

;;;;;; Main monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 3

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter ob_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u1 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u2 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u3 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u4 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u5 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u6 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u7 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u8 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u9 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u10 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u11 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u12 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u13 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u14 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u15 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u16 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u17 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u18 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u19 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u20 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter ob_under_fire < 1
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if

    if I_CompareCounter ob_repeat_test < 3
    set_counter ob_repeat_test 1
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if
    end_if

    end_if

    if I_CompareCounter ob_under_fire > 0
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if
    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test < 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    set_counter ob_repeat_test 2
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    end_if
    if I_CompareCounter ob_repeat_test = 4
    if I_CompareCounter ob_under_fire < 1
    and I_CompareCounter ob_engaged < 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 3
        set_counter ob_repeat_test 2
    end_if
    if I_CompareCounter ob_under_fire > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if
    if I_CompareCounter ob_engaged > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if

    end_if

        if I_CompareCounter ob_defend = 3
        set_counter ob_defend 2
        end_if
        battle_wait 15
end_monitor

;;;;;;;General Stop

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and I_BattleEnemyArmyNumberOfUnits > 2
    and I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a2u1 120

    set_counter g_stop 2
    label_unit 1 0 0 a2u1
    battle_wait 0.1
    unit_order_halt a2u1
    if I_BattleEnemyArmyNumberOfUnits > 5
    battle_wait 30
    end_if
    if I_BattleEnemyArmyNumberOfUnits < 6
    battle_wait 15
    end_if
    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 2
    and I_BattleAiAttacking
    release_unit a2u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a1u1 120

    set_counter g_stop 3
    label_unit 0 0 0 a1u1
    battle_wait 0.1
    unit_order_halt a1u1
    battle_wait 30
    if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 3
    and I_BattleAiAttacking
    release_unit a1u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    release_unit a2u1
    set_counter g_stop 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 3
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    release_unit a1u1
    set_counter g_stop 0
end_monitor

;;;;;;;AI Stuck Fix

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter ai_stuck_launch = 1
    and BattleIsMeleeAttack
    and I_BattleIsSiegeBattle
    set_counter ai_stuck_launch 2
end_monitor

monitor_conditions I_CompareCounter ai_stuck_launch = 2
    and I_BattleIsSiegeBattle

if I_CompareCounter enemy_unit_count > 0
and ! I_UnitDestroyed a2u1

    if I_UnitStatus a2u1 moving
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 1
    end_if
    if I_CompareCounter a2u1_status != 1
    set_counter a2u1_status 0
    end_if
    end_if

    if I_UnitStatus a2u1 routing
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 2
    end_if
    if I_CompareCounter a2u1_status != 2
    set_counter a2u1_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u1 moving
    and ! I_UnitStatus a2u1 routing
    set_counter a2u1_status 0
    end_if

    if I_CompareCounter a2u1_status > 0

    if I_UnitDistanceFromPosition a2u1 0,0 >= 150
    and I_UnitDistanceFromPosition a2u1 0,0 < 175
    if I_CompareCounter a2u1_distance != 1
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 1
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 175
    and I_UnitDistanceFromPosition a2u1 0,0 < 200
    if I_CompareCounter a2u1_distance != 2
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 2
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 200
    and I_UnitDistanceFromPosition a2u1 0,0 < 225
    if I_CompareCounter a2u1_distance != 3
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 3
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 225
    and I_UnitDistanceFromPosition a2u1 0,0 < 250
    if I_CompareCounter a2u1_distance != 4
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 4
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 250
    and I_UnitDistanceFromPosition a2u1 0,0 < 275
    if I_CompareCounter a2u1_distance != 5
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 5
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 275
    and I_UnitDistanceFromPosition a2u1 0,0 < 300
    if I_CompareCounter a2u1_distance != 6
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 6
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 300
    and I_UnitDistanceFromPosition a2u1 0,0 < 325
    if I_CompareCounter a2u1_distance != 7
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 7
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 325
    and I_UnitDistanceFromPosition a2u1 0,0 < 350
    if I_CompareCounter a2u1_distance != 8
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 8
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 350
    and I_UnitDistanceFromPosition a2u1 0,0 < 375
    if I_CompareCounter a2u1_distance != 9
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 9
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 375
    and I_UnitDistanceFromPosition a2u1 0,0 < 400
    if I_CompareCounter a2u1_distance != 10
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 10
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 400
    and I_UnitDistanceFromPosition a2u1 0,0 < 425
    if I_CompareCounter a2u1_distance != 11
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 11
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 425
    and I_UnitDistanceFromPosition a2u1 0,0 < 450
    if I_CompareCounter a2u1_distance != 12
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 12
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 450
    and I_UnitDistanceFromPosition a2u1 0,0 < 500
    if I_CompareCounter a2u1_distance != 13
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 13
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 500
    and I_UnitDistanceFromPosition a2u1 0,0 < 550
    if I_CompareCounter a2u1_distance != 14
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 14
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 550
    and I_UnitDistanceFromPosition a2u1 0,0 < 600
    if I_CompareCounter a2u1_distance != 15
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 15
    inc_counter a2u1_stuck 1
    end_if

    if I_CompareCounter a2u1_stuck = 4
    unit_order_halt a2u1
    unit_set_morale a2u1 wavering
    battle_wait 0.1
    unit_unset_morale a2u1
    release_unit a2u1
    set_counter a2u1_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 1
and ! I_UnitDestroyed a2u2

    if I_UnitStatus a2u2 moving
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 1
    end_if
    if I_CompareCounter a2u2_status != 1
    set_counter a2u2_status 0
    end_if
    end_if

    if I_UnitStatus a2u2 routing
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 2
    end_if
    if I_CompareCounter a2u2_status != 2
    set_counter a2u2_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u2 moving
    and ! I_UnitStatus a2u2 routing
    set_counter a2u2_status 0
    end_if

    if I_CompareCounter a2u2_status > 0

    if I_UnitDistanceFromPosition a2u2 0,0 >= 150
    and I_UnitDistanceFromPosition a2u2 0,0 < 175
    if I_CompareCounter a2u2_distance != 1
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 1
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 175
    and I_UnitDistanceFromPosition a2u2 0,0 < 200
    if I_CompareCounter a2u2_distance != 2
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 2
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 200
    and I_UnitDistanceFromPosition a2u2 0,0 < 225
    if I_CompareCounter a2u2_distance != 3
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 3
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 225
    and I_UnitDistanceFromPosition a2u2 0,0 < 250
    if I_CompareCounter a2u2_distance != 4
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 4
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 250
    and I_UnitDistanceFromPosition a2u2 0,0 < 275
    if I_CompareCounter a2u2_distance != 5
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 5
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 275
    and I_UnitDistanceFromPosition a2u2 0,0 < 300
    if I_CompareCounter a2u2_distance != 6
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 6
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 300
    and I_UnitDistanceFromPosition a2u2 0,0 < 325
    if I_CompareCounter a2u2_distance != 7
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 7
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 325
    and I_UnitDistanceFromPosition a2u2 0,0 < 350
    if I_CompareCounter a2u2_distance != 8
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 8
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 350
    and I_UnitDistanceFromPosition a2u2 0,0 < 375
    if I_CompareCounter a2u2_distance != 9
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 9
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 375
    and I_UnitDistanceFromPosition a2u2 0,0 < 400
    if I_CompareCounter a2u2_distance != 10
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 10
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 400
    and I_UnitDistanceFromPosition a2u2 0,0 < 425
    if I_CompareCounter a2u2_distance != 11
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 11
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 425
    and I_UnitDistanceFromPosition a2u2 0,0 < 450
    if I_CompareCounter a2u2_distance != 12
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 12
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 450
    and I_UnitDistanceFromPosition a2u2 0,0 < 500
    if I_CompareCounter a2u2_distance != 13
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 13
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 500
    and I_UnitDistanceFromPosition a2u2 0,0 < 550
    if I_CompareCounter a2u2_distance != 14
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 14
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 550
    and I_UnitDistanceFromPosition a2u2 0,0 < 600
    if I_CompareCounter a2u2_distance != 15
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 15
    inc_counter a2u2_stuck 1
    end_if

    if I_CompareCounter a2u2_stuck = 4
    unit_order_halt a2u2
    unit_set_morale a2u2 wavering
    battle_wait 0.1
    unit_unset_morale a2u2
    release_unit a2u2
    set_counter a2u2_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 2
and ! I_UnitDestroyed a2u3

    if I_UnitStatus a2u3 moving
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 1
    end_if
    if I_CompareCounter a2u3_status != 1
    set_counter a2u3_status 0
    end_if
    end_if

    if I_UnitStatus a2u3 routing
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 2
    end_if
    if I_CompareCounter a2u3_status != 2
    set_counter a2u3_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u3 moving
    and ! I_UnitStatus a2u3 routing
    set_counter a2u3_status 0
    end_if

    if I_CompareCounter a2u3_status > 0

    if I_UnitDistanceFromPosition a2u3 0,0 >= 150
    and I_UnitDistanceFromPosition a2u3 0,0 < 175
    if I_CompareCounter a2u3_distance != 1
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 1
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 175
    and I_UnitDistanceFromPosition a2u3 0,0 < 200
    if I_CompareCounter a2u3_distance != 2
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 2
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 200
    and I_UnitDistanceFromPosition a2u3 0,0 < 225
    if I_CompareCounter a2u3_distance != 3
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 3
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 225
    and I_UnitDistanceFromPosition a2u3 0,0 < 250
    if I_CompareCounter a2u3_distance != 4
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 4
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 250
    and I_UnitDistanceFromPosition a2u3 0,0 < 275
    if I_CompareCounter a2u3_distance != 5
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 5
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 275
    and I_UnitDistanceFromPosition a2u3 0,0 < 300
    if I_CompareCounter a2u3_distance != 6
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 6
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 300
    and I_UnitDistanceFromPosition a2u3 0,0 < 325
    if I_CompareCounter a2u3_distance != 7
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 7
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 325
    and I_UnitDistanceFromPosition a2u3 0,0 < 350
    if I_CompareCounter a2u3_distance != 8
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 8
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 350
    and I_UnitDistanceFromPosition a2u3 0,0 < 375
    if I_CompareCounter a2u3_distance != 9
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 9
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 375
    and I_UnitDistanceFromPosition a2u3 0,0 < 400
    if I_CompareCounter a2u3_distance != 10
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 10
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 400
    and I_UnitDistanceFromPosition a2u3 0,0 < 425
    if I_CompareCounter a2u3_distance != 11
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 11
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 425
    and I_UnitDistanceFromPosition a2u3 0,0 < 450
    if I_CompareCounter a2u3_distance != 12
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 12
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 450
    and I_UnitDistanceFromPosition a2u3 0,0 < 500
    if I_CompareCounter a2u3_distance != 13
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 13
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 500
    and I_UnitDistanceFromPosition a2u3 0,0 < 550
    if I_CompareCounter a2u3_distance != 14
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 14
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 550
    and I_UnitDistanceFromPosition a2u3 0,0 < 600
    if I_CompareCounter a2u3_distance != 15
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 15
    inc_counter a2u3_stuck 1
    end_if

    if I_CompareCounter a2u3_stuck = 4
    unit_order_halt a2u3
    unit_set_morale a2u3 wavering
    battle_wait 0.1
    unit_unset_morale a2u3
    release_unit a2u3
    set_counter a2u3_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 3
and ! I_UnitDestroyed a2u4

    if I_UnitStatus a2u4 moving
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 1
    end_if
    if I_CompareCounter a2u4_status != 1
    set_counter a2u4_status 0
    end_if
    end_if

    if I_UnitStatus a2u4 routing
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 2
    end_if
    if I_CompareCounter a2u4_status != 2
    set_counter a2u4_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u4 moving
    and ! I_UnitStatus a2u4 routing
    set_counter a2u4_status 0
    end_if

    if I_CompareCounter a2u4_status > 0

    if I_UnitDistanceFromPosition a2u4 0,0 >= 150
    and I_UnitDistanceFromPosition a2u4 0,0 < 175
    if I_CompareCounter a2u4_distance != 1
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 1
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 175
    and I_UnitDistanceFromPosition a2u4 0,0 < 200
    if I_CompareCounter a2u4_distance != 2
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 2
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 200
    and I_UnitDistanceFromPosition a2u4 0,0 < 225
    if I_CompareCounter a2u4_distance != 3
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 3
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 225
    and I_UnitDistanceFromPosition a2u4 0,0 < 250
    if I_CompareCounter a2u4_distance != 4
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 4
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 250
    and I_UnitDistanceFromPosition a2u4 0,0 < 275
    if I_CompareCounter a2u4_distance != 5
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 5
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 275
    and I_UnitDistanceFromPosition a2u4 0,0 < 300
    if I_CompareCounter a2u4_distance != 6
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 6
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 300
    and I_UnitDistanceFromPosition a2u4 0,0 < 325
    if I_CompareCounter a2u4_distance != 7
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 7
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 325
    and I_UnitDistanceFromPosition a2u4 0,0 < 350
    if I_CompareCounter a2u4_distance != 8
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 8
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 350
    and I_UnitDistanceFromPosition a2u4 0,0 < 375
    if I_CompareCounter a2u4_distance != 9
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 9
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 375
    and I_UnitDistanceFromPosition a2u4 0,0 < 400
    if I_CompareCounter a2u4_distance != 10
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 10
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 400
    and I_UnitDistanceFromPosition a2u4 0,0 < 425
    if I_CompareCounter a2u4_distance != 11
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 11
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 425
    and I_UnitDistanceFromPosition a2u4 0,0 < 450
    if I_CompareCounter a2u4_distance != 12
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 12
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 450
    and I_UnitDistanceFromPosition a2u4 0,0 < 500
    if I_CompareCounter a2u4_distance != 13
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 13
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 500
    and I_UnitDistanceFromPosition a2u4 0,0 < 550
    if I_CompareCounter a2u4_distance != 14
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 14
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 550
    and I_UnitDistanceFromPosition a2u4 0,0 < 600
    if I_CompareCounter a2u4_distance != 15
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 15
    inc_counter a2u4_stuck 1
    end_if

    if I_CompareCounter a2u4_stuck = 4
    unit_order_halt a2u4
    unit_set_morale a2u4 wavering
    battle_wait 0.1
    unit_unset_morale a2u4
    release_unit a2u4
    set_counter a2u4_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 4
and ! I_UnitDestroyed a2u5

    if I_UnitStatus a2u5 moving
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 1
    end_if
    if I_CompareCounter a2u5_status != 1
    set_counter a2u5_status 0
    end_if
    end_if

    if I_UnitStatus a2u5 routing
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 2
    end_if
    if I_CompareCounter a2u5_status != 2
    set_counter a2u5_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u5 moving
    and ! I_UnitStatus a2u5 routing
    set_counter a2u5_status 0
    end_if

    if I_CompareCounter a2u5_status > 0

    if I_UnitDistanceFromPosition a2u5 0,0 >= 150
    and I_UnitDistanceFromPosition a2u5 0,0 < 175
    if I_CompareCounter a2u5_distance != 1
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 1
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 175
    and I_UnitDistanceFromPosition a2u5 0,0 < 200
    if I_CompareCounter a2u5_distance != 2
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 2
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 200
    and I_UnitDistanceFromPosition a2u5 0,0 < 225
    if I_CompareCounter a2u5_distance != 3
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 3
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 225
    and I_UnitDistanceFromPosition a2u5 0,0 < 250
    if I_CompareCounter a2u5_distance != 4
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 4
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 250
    and I_UnitDistanceFromPosition a2u5 0,0 < 275
    if I_CompareCounter a2u5_distance != 5
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 5
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 275
    and I_UnitDistanceFromPosition a2u5 0,0 < 300
    if I_CompareCounter a2u5_distance != 6
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 6
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 300
    and I_UnitDistanceFromPosition a2u5 0,0 < 325
    if I_CompareCounter a2u5_distance != 7
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 7
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 325
    and I_UnitDistanceFromPosition a2u5 0,0 < 350
    if I_CompareCounter a2u5_distance != 8
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 8
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 350
    and I_UnitDistanceFromPosition a2u5 0,0 < 375
    if I_CompareCounter a2u5_distance != 9
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 9
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 375
    and I_UnitDistanceFromPosition a2u5 0,0 < 400
    if I_CompareCounter a2u5_distance != 10
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 10
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 400
    and I_UnitDistanceFromPosition a2u5 0,0 < 425
    if I_CompareCounter a2u5_distance != 11
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 11
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 425
    and I_UnitDistanceFromPosition a2u5 0,0 < 450
    if I_CompareCounter a2u5_distance != 12
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 12
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 450
    and I_UnitDistanceFromPosition a2u5 0,0 < 500
    if I_CompareCounter a2u5_distance != 13
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 13
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 500
    and I_UnitDistanceFromPosition a2u5 0,0 < 550
    if I_CompareCounter a2u5_distance != 14
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 14
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 550
    and I_UnitDistanceFromPosition a2u5 0,0 < 600
    if I_CompareCounter a2u5_distance != 15
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 15
    inc_counter a2u5_stuck 1
    end_if

    if I_CompareCounter a2u5_stuck = 4
    unit_order_halt a2u5
    unit_set_morale a2u5 wavering
    battle_wait 0.1
    unit_unset_morale a2u5
    release_unit a2u5
    set_counter a2u5_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 5
and ! I_UnitDestroyed a2u6

    if I_UnitStatus a2u6 moving
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 1
    end_if
    if I_CompareCounter a2u6_status != 1
    set_counter a2u6_status 0
    end_if
    end_if

    if I_UnitStatus a2u6 routing
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 2
    end_if
    if I_CompareCounter a2u6_status != 2
    set_counter a2u6_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u6 moving
    and ! I_UnitStatus a2u6 routing
    set_counter a2u6_status 0
    end_if

    if I_CompareCounter a2u6_status > 0

    if I_UnitDistanceFromPosition a2u6 0,0 >= 150
    and I_UnitDistanceFromPosition a2u6 0,0 < 175
    if I_CompareCounter a2u6_distance != 1
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 1
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 175
    and I_UnitDistanceFromPosition a2u6 0,0 < 200
    if I_CompareCounter a2u6_distance != 2
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 2
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 200
    and I_UnitDistanceFromPosition a2u6 0,0 < 225
    if I_CompareCounter a2u6_distance != 3
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 3
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 225
    and I_UnitDistanceFromPosition a2u6 0,0 < 250
    if I_CompareCounter a2u6_distance != 4
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 4
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 250
    and I_UnitDistanceFromPosition a2u6 0,0 < 275
    if I_CompareCounter a2u6_distance != 5
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 5
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 275
    and I_UnitDistanceFromPosition a2u6 0,0 < 300
    if I_CompareCounter a2u6_distance != 6
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 6
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 300
    and I_UnitDistanceFromPosition a2u6 0,0 < 325
    if I_CompareCounter a2u6_distance != 7
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 7
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 325
    and I_UnitDistanceFromPosition a2u6 0,0 < 350
    if I_CompareCounter a2u6_distance != 8
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 8
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 350
    and I_UnitDistanceFromPosition a2u6 0,0 < 375
    if I_CompareCounter a2u6_distance != 9
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 9
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 375
    and I_UnitDistanceFromPosition a2u6 0,0 < 400
    if I_CompareCounter a2u6_distance != 10
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 10
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 400
    and I_UnitDistanceFromPosition a2u6 0,0 < 425
    if I_CompareCounter a2u6_distance != 11
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 11
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 425
    and I_UnitDistanceFromPosition a2u6 0,0 < 450
    if I_CompareCounter a2u6_distance != 12
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 12
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 450
    and I_UnitDistanceFromPosition a2u6 0,0 < 500
    if I_CompareCounter a2u6_distance != 13
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 13
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 500
    and I_UnitDistanceFromPosition a2u6 0,0 < 550
    if I_CompareCounter a2u6_distance != 14
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 14
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 550
    and I_UnitDistanceFromPosition a2u6 0,0 < 600
    if I_CompareCounter a2u6_distance != 15
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 15
    inc_counter a2u6_stuck 1
    end_if

    if I_CompareCounter a2u6_stuck = 4
    unit_order_halt a2u6
    unit_set_morale a2u6 wavering
    battle_wait 0.1
    unit_unset_morale a2u6
    release_unit a2u6
    set_counter a2u6_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 6
and ! I_UnitDestroyed a2u7

    if I_UnitStatus a2u7 moving
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 1
    end_if
    if I_CompareCounter a2u7_status != 1
    set_counter a2u7_status 0
    end_if
    end_if

    if I_UnitStatus a2u7 routing
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 2
    end_if
    if I_CompareCounter a2u7_status != 2
    set_counter a2u7_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u7 moving
    and ! I_UnitStatus a2u7 routing
    set_counter a2u7_status 0
    end_if

    if I_CompareCounter a2u7_status > 0

    if I_UnitDistanceFromPosition a2u7 0,0 >= 150
    and I_UnitDistanceFromPosition a2u7 0,0 < 175
    if I_CompareCounter a2u7_distance != 1
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 1
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 175
    and I_UnitDistanceFromPosition a2u7 0,0 < 200
    if I_CompareCounter a2u7_distance != 2
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 2
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 200
    and I_UnitDistanceFromPosition a2u7 0,0 < 225
    if I_CompareCounter a2u7_distance != 3
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 3
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 225
    and I_UnitDistanceFromPosition a2u7 0,0 < 250
    if I_CompareCounter a2u7_distance != 4
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 4
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 250
    and I_UnitDistanceFromPosition a2u7 0,0 < 275
    if I_CompareCounter a2u7_distance != 5
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 5
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 275
    and I_UnitDistanceFromPosition a2u7 0,0 < 300
    if I_CompareCounter a2u7_distance != 6
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 6
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 300
    and I_UnitDistanceFromPosition a2u7 0,0 < 325
    if I_CompareCounter a2u7_distance != 7
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 7
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 325
    and I_UnitDistanceFromPosition a2u7 0,0 < 350
    if I_CompareCounter a2u7_distance != 8
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 8
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 350
    and I_UnitDistanceFromPosition a2u7 0,0 < 375
    if I_CompareCounter a2u7_distance != 9
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 9
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 375
    and I_UnitDistanceFromPosition a2u7 0,0 < 400
    if I_CompareCounter a2u7_distance != 10
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 10
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 400
    and I_UnitDistanceFromPosition a2u7 0,0 < 425
    if I_CompareCounter a2u7_distance != 11
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 11
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 425
    and I_UnitDistanceFromPosition a2u7 0,0 < 450
    if I_CompareCounter a2u7_distance != 12
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 12
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 450
    and I_UnitDistanceFromPosition a2u7 0,0 < 500
    if I_CompareCounter a2u7_distance != 13
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 13
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 500
    and I_UnitDistanceFromPosition a2u7 0,0 < 550
    if I_CompareCounter a2u7_distance != 14
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 14
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 550
    and I_UnitDistanceFromPosition a2u7 0,0 < 600
    if I_CompareCounter a2u7_distance != 15
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 15
    inc_counter a2u7_stuck 1
    end_if

    if I_CompareCounter a2u7_stuck = 4
    unit_order_halt a2u7
    unit_set_morale a2u7 wavering
    battle_wait 0.1
    unit_unset_morale a2u7
    release_unit a2u7
    set_counter a2u7_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 7
and ! I_UnitDestroyed a2u8

    if I_UnitStatus a2u8 moving
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 1
    end_if
    if I_CompareCounter a2u8_status != 1
    set_counter a2u8_status 0
    end_if
    end_if

    if I_UnitStatus a2u8 routing
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 2
    end_if
    if I_CompareCounter a2u8_status != 2
    set_counter a2u8_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u8 moving
    and ! I_UnitStatus a2u8 routing
    set_counter a2u8_status 0
    end_if

    if I_CompareCounter a2u8_status > 0

    if I_UnitDistanceFromPosition a2u8 0,0 >= 150
    and I_UnitDistanceFromPosition a2u8 0,0 < 175
    if I_CompareCounter a2u8_distance != 1
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 1
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 175
    and I_UnitDistanceFromPosition a2u8 0,0 < 200
    if I_CompareCounter a2u8_distance != 2
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 2
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 200
    and I_UnitDistanceFromPosition a2u8 0,0 < 225
    if I_CompareCounter a2u8_distance != 3
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 3
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 225
    and I_UnitDistanceFromPosition a2u8 0,0 < 250
    if I_CompareCounter a2u8_distance != 4
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 4
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 250
    and I_UnitDistanceFromPosition a2u8 0,0 < 275
    if I_CompareCounter a2u8_distance != 5
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 5
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 275
    and I_UnitDistanceFromPosition a2u8 0,0 < 300
    if I_CompareCounter a2u8_distance != 6
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 6
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 300
    and I_UnitDistanceFromPosition a2u8 0,0 < 325
    if I_CompareCounter a2u8_distance != 7
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 7
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 325
    and I_UnitDistanceFromPosition a2u8 0,0 < 350
    if I_CompareCounter a2u8_distance != 8
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 8
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 350
    and I_UnitDistanceFromPosition a2u8 0,0 < 375
    if I_CompareCounter a2u8_distance != 9
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 9
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 375
    and I_UnitDistanceFromPosition a2u8 0,0 < 400
    if I_CompareCounter a2u8_distance != 10
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 10
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 400
    and I_UnitDistanceFromPosition a2u8 0,0 < 425
    if I_CompareCounter a2u8_distance != 11
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 11
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 425
    and I_UnitDistanceFromPosition a2u8 0,0 < 450
    if I_CompareCounter a2u8_distance != 12
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 12
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 450
    and I_UnitDistanceFromPosition a2u8 0,0 < 500
    if I_CompareCounter a2u8_distance != 13
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 13
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 500
    and I_UnitDistanceFromPosition a2u8 0,0 < 550
    if I_CompareCounter a2u8_distance != 14
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 14
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 550
    and I_UnitDistanceFromPosition a2u8 0,0 < 600
    if I_CompareCounter a2u8_distance != 15
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 15
    inc_counter a2u8_stuck 1
    end_if

    if I_CompareCounter a2u8_stuck = 4
    unit_order_halt a2u8
    unit_set_morale a2u8 wavering
    battle_wait 0.1
    unit_unset_morale a2u8
    release_unit a2u8
    set_counter a2u8_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 8
and ! I_UnitDestroyed a2u9

    if I_UnitStatus a2u9 moving
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 1
    end_if
    if I_CompareCounter a2u9_status != 1
    set_counter a2u9_status 0
    end_if
    end_if

    if I_UnitStatus a2u9 routing
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 2
    end_if
    if I_CompareCounter a2u9_status != 2
    set_counter a2u9_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u9 moving
    and ! I_UnitStatus a2u9 routing
    set_counter a2u9_status 0
    end_if

    if I_CompareCounter a2u9_status > 0

    if I_UnitDistanceFromPosition a2u9 0,0 >= 150
    and I_UnitDistanceFromPosition a2u9 0,0 < 175
    if I_CompareCounter a2u9_distance != 1
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 1
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 175
    and I_UnitDistanceFromPosition a2u9 0,0 < 200
    if I_CompareCounter a2u9_distance != 2
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 2
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 200
    and I_UnitDistanceFromPosition a2u9 0,0 < 225
    if I_CompareCounter a2u9_distance != 3
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 3
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 225
    and I_UnitDistanceFromPosition a2u9 0,0 < 250
    if I_CompareCounter a2u9_distance != 4
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 4
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 250
    and I_UnitDistanceFromPosition a2u9 0,0 < 275
    if I_CompareCounter a2u9_distance != 5
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 5
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 275
    and I_UnitDistanceFromPosition a2u9 0,0 < 300
    if I_CompareCounter a2u9_distance != 6
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 6
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 300
    and I_UnitDistanceFromPosition a2u9 0,0 < 325
    if I_CompareCounter a2u9_distance != 7
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 7
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 325
    and I_UnitDistanceFromPosition a2u9 0,0 < 350
    if I_CompareCounter a2u9_distance != 8
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 8
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 350
    and I_UnitDistanceFromPosition a2u9 0,0 < 375
    if I_CompareCounter a2u9_distance != 9
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 9
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 375
    and I_UnitDistanceFromPosition a2u9 0,0 < 400
    if I_CompareCounter a2u9_distance != 10
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 10
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 400
    and I_UnitDistanceFromPosition a2u9 0,0 < 425
    if I_CompareCounter a2u9_distance != 11
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 11
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 425
    and I_UnitDistanceFromPosition a2u9 0,0 < 450
    if I_CompareCounter a2u9_distance != 12
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 12
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 450
    and I_UnitDistanceFromPosition a2u9 0,0 < 500
    if I_CompareCounter a2u9_distance != 13
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 13
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 500
    and I_UnitDistanceFromPosition a2u9 0,0 < 550
    if I_CompareCounter a2u9_distance != 14
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 14
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 550
    and I_UnitDistanceFromPosition a2u9 0,0 < 600
    if I_CompareCounter a2u9_distance != 15
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 15
    inc_counter a2u9_stuck 1
    end_if

    if I_CompareCounter a2u9_stuck = 4
    unit_order_halt a2u9
    unit_set_morale a2u9 wavering
    battle_wait 0.1
    unit_unset_morale a2u9
    release_unit a2u9
    set_counter a2u9_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 9
and ! I_UnitDestroyed a2u10

    if I_UnitStatus a2u10 moving
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 1
    end_if
    if I_CompareCounter a2u10_status != 1
    set_counter a2u10_status 0
    end_if
    end_if

    if I_UnitStatus a2u10 routing
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 2
    end_if
    if I_CompareCounter a2u10_status != 2
    set_counter a2u10_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u10 moving
    and ! I_UnitStatus a2u10 routing
    set_counter a2u10_status 0
    end_if

    if I_CompareCounter a2u10_status > 0

    if I_UnitDistanceFromPosition a2u10 0,0 >= 150
    and I_UnitDistanceFromPosition a2u10 0,0 < 175
    if I_CompareCounter a2u10_distance != 1
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 1
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 175
    and I_UnitDistanceFromPosition a2u10 0,0 < 200
    if I_CompareCounter a2u10_distance != 2
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 2
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 200
    and I_UnitDistanceFromPosition a2u10 0,0 < 225
    if I_CompareCounter a2u10_distance != 3
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 3
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 225
    and I_UnitDistanceFromPosition a2u10 0,0 < 250
    if I_CompareCounter a2u10_distance != 4
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 4
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 250
    and I_UnitDistanceFromPosition a2u10 0,0 < 275
    if I_CompareCounter a2u10_distance != 5
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 5
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 275
    and I_UnitDistanceFromPosition a2u10 0,0 < 300
    if I_CompareCounter a2u10_distance != 6
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 6
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 300
    and I_UnitDistanceFromPosition a2u10 0,0 < 325
    if I_CompareCounter a2u10_distance != 7
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 7
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 325
    and I_UnitDistanceFromPosition a2u10 0,0 < 350
    if I_CompareCounter a2u10_distance != 8
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 8
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 350
    and I_UnitDistanceFromPosition a2u10 0,0 < 375
    if I_CompareCounter a2u10_distance != 9
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 9
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 375
    and I_UnitDistanceFromPosition a2u10 0,0 < 400
    if I_CompareCounter a2u10_distance != 10
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 10
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 400
    and I_UnitDistanceFromPosition a2u10 0,0 < 425
    if I_CompareCounter a2u10_distance != 11
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 11
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 425
    and I_UnitDistanceFromPosition a2u10 0,0 < 450
    if I_CompareCounter a2u10_distance != 12
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 12
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 450
    and I_UnitDistanceFromPosition a2u10 0,0 < 500
    if I_CompareCounter a2u10_distance != 13
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 13
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 500
    and I_UnitDistanceFromPosition a2u10 0,0 < 550
    if I_CompareCounter a2u10_distance != 14
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 14
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 550
    and I_UnitDistanceFromPosition a2u10 0,0 < 600
    if I_CompareCounter a2u10_distance != 15
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 15
    inc_counter a2u10_stuck 1
    end_if

    if I_CompareCounter a2u10_stuck = 4
    unit_order_halt a2u10
    unit_set_morale a2u10 wavering
    battle_wait 0.1
    unit_unset_morale a2u10
    release_unit a2u10
    set_counter a2u10_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 10
and ! I_UnitDestroyed a2u11

    if I_UnitStatus a2u11 moving
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 1
    end_if
    if I_CompareCounter a2u11_status != 1
    set_counter a2u11_status 0
    end_if
    end_if

    if I_UnitStatus a2u11 routing
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 2
    end_if
    if I_CompareCounter a2u11_status != 2
    set_counter a2u11_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u11 moving
    and ! I_UnitStatus a2u11 routing
    set_counter a2u11_status 0
    end_if

    if I_CompareCounter a2u11_status > 0

    if I_UnitDistanceFromPosition a2u11 0,0 >= 150
    and I_UnitDistanceFromPosition a2u11 0,0 < 175
    if I_CompareCounter a2u11_distance != 1
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 1
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 175
    and I_UnitDistanceFromPosition a2u11 0,0 < 200
    if I_CompareCounter a2u11_distance != 2
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 2
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 200
    and I_UnitDistanceFromPosition a2u11 0,0 < 225
    if I_CompareCounter a2u11_distance != 3
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 3
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 225
    and I_UnitDistanceFromPosition a2u11 0,0 < 250
    if I_CompareCounter a2u11_distance != 4
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 4
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 250
    and I_UnitDistanceFromPosition a2u11 0,0 < 275
    if I_CompareCounter a2u11_distance != 5
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 5
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 275
    and I_UnitDistanceFromPosition a2u11 0,0 < 300
    if I_CompareCounter a2u11_distance != 6
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 6
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 300
    and I_UnitDistanceFromPosition a2u11 0,0 < 325
    if I_CompareCounter a2u11_distance != 7
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 7
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 325
    and I_UnitDistanceFromPosition a2u11 0,0 < 350
    if I_CompareCounter a2u11_distance != 8
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 8
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 350
    and I_UnitDistanceFromPosition a2u11 0,0 < 375
    if I_CompareCounter a2u11_distance != 9
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 9
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 375
    and I_UnitDistanceFromPosition a2u11 0,0 < 400
    if I_CompareCounter a2u11_distance != 10
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 10
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 400
    and I_UnitDistanceFromPosition a2u11 0,0 < 425
    if I_CompareCounter a2u11_distance != 11
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 11
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 425
    and I_UnitDistanceFromPosition a2u11 0,0 < 450
    if I_CompareCounter a2u11_distance != 12
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 12
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 450
    and I_UnitDistanceFromPosition a2u11 0,0 < 500
    if I_CompareCounter a2u11_distance != 13
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 13
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 500
    and I_UnitDistanceFromPosition a2u11 0,0 < 550
    if I_CompareCounter a2u11_distance != 14
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 14
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 550
    and I_UnitDistanceFromPosition a2u11 0,0 < 600
    if I_CompareCounter a2u11_distance != 15
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 15
    inc_counter a2u11_stuck 1
    end_if

    if I_CompareCounter a2u11_stuck = 4
    unit_order_halt a2u11
    unit_set_morale a2u11 wavering
    battle_wait 0.1
    unit_unset_morale a2u11
    release_unit a2u11
    set_counter a2u11_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 11
and ! I_UnitDestroyed a2u12

    if I_UnitStatus a2u12 moving
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 1
    end_if
    if I_CompareCounter a2u12_status != 1
    set_counter a2u12_status 0
    end_if
    end_if

    if I_UnitStatus a2u12 routing
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 2
    end_if
    if I_CompareCounter a2u12_status != 2
    set_counter a2u12_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u12 moving
    and ! I_UnitStatus a2u12 routing
    set_counter a2u12_status 0
    end_if

    if I_CompareCounter a2u12_status > 0

    if I_UnitDistanceFromPosition a2u12 0,0 >= 150
    and I_UnitDistanceFromPosition a2u12 0,0 < 175
    if I_CompareCounter a2u12_distance != 1
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 1
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 175
    and I_UnitDistanceFromPosition a2u12 0,0 < 200
    if I_CompareCounter a2u12_distance != 2
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 2
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 200
    and I_UnitDistanceFromPosition a2u12 0,0 < 225
    if I_CompareCounter a2u12_distance != 3
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 3
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 225
    and I_UnitDistanceFromPosition a2u12 0,0 < 250
    if I_CompareCounter a2u12_distance != 4
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 4
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 250
    and I_UnitDistanceFromPosition a2u12 0,0 < 275
    if I_CompareCounter a2u12_distance != 5
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 5
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 275
    and I_UnitDistanceFromPosition a2u12 0,0 < 300
    if I_CompareCounter a2u12_distance != 6
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 6
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 300
    and I_UnitDistanceFromPosition a2u12 0,0 < 325
    if I_CompareCounter a2u12_distance != 7
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 7
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 325
    and I_UnitDistanceFromPosition a2u12 0,0 < 350
    if I_CompareCounter a2u12_distance != 8
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 8
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 350
    and I_UnitDistanceFromPosition a2u12 0,0 < 375
    if I_CompareCounter a2u12_distance != 9
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 9
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 375
    and I_UnitDistanceFromPosition a2u12 0,0 < 400
    if I_CompareCounter a2u12_distance != 10
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 10
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 400
    and I_UnitDistanceFromPosition a2u12 0,0 < 425
    if I_CompareCounter a2u12_distance != 11
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 11
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 425
    and I_UnitDistanceFromPosition a2u12 0,0 < 450
    if I_CompareCounter a2u12_distance != 12
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 12
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 450
    and I_UnitDistanceFromPosition a2u12 0,0 < 500
    if I_CompareCounter a2u12_distance != 13
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 13
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 500
    and I_UnitDistanceFromPosition a2u12 0,0 < 550
    if I_CompareCounter a2u12_distance != 14
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 14
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 550
    and I_UnitDistanceFromPosition a2u12 0,0 < 600
    if I_CompareCounter a2u12_distance != 15
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 15
    inc_counter a2u12_stuck 1
    end_if

    if I_CompareCounter a2u12_stuck = 4
    unit_order_halt a2u12
    unit_set_morale a2u12 wavering
    battle_wait 0.1
    unit_unset_morale a2u12
    release_unit a2u12
    set_counter a2u12_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 12
and ! I_UnitDestroyed a2u13

    if I_UnitStatus a2u13 moving
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 1
    end_if
    if I_CompareCounter a2u13_status != 1
    set_counter a2u13_status 0
    end_if
    end_if

    if I_UnitStatus a2u13 routing
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 2
    end_if
    if I_CompareCounter a2u13_status != 2
    set_counter a2u13_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u13 moving
    and ! I_UnitStatus a2u13 routing
    set_counter a2u13_status 0
    end_if

    if I_CompareCounter a2u13_status > 0

    if I_UnitDistanceFromPosition a2u13 0,0 >= 150
    and I_UnitDistanceFromPosition a2u13 0,0 < 175
    if I_CompareCounter a2u13_distance != 1
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 1
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 175
    and I_UnitDistanceFromPosition a2u13 0,0 < 200
    if I_CompareCounter a2u13_distance != 2
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 2
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 200
    and I_UnitDistanceFromPosition a2u13 0,0 < 225
    if I_CompareCounter a2u13_distance != 3
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 3
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 225
    and I_UnitDistanceFromPosition a2u13 0,0 < 250
    if I_CompareCounter a2u13_distance != 4
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 4
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 250
    and I_UnitDistanceFromPosition a2u13 0,0 < 275
    if I_CompareCounter a2u13_distance != 5
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 5
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 275
    and I_UnitDistanceFromPosition a2u13 0,0 < 300
    if I_CompareCounter a2u13_distance != 6
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 6
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 300
    and I_UnitDistanceFromPosition a2u13 0,0 < 325
    if I_CompareCounter a2u13_distance != 7
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 7
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 325
    and I_UnitDistanceFromPosition a2u13 0,0 < 350
    if I_CompareCounter a2u13_distance != 8
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 8
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 350
    and I_UnitDistanceFromPosition a2u13 0,0 < 375
    if I_CompareCounter a2u13_distance != 9
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 9
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 375
    and I_UnitDistanceFromPosition a2u13 0,0 < 400
    if I_CompareCounter a2u13_distance != 10
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 10
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 400
    and I_UnitDistanceFromPosition a2u13 0,0 < 425
    if I_CompareCounter a2u13_distance != 11
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 11
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 425
    and I_UnitDistanceFromPosition a2u13 0,0 < 450
    if I_CompareCounter a2u13_distance != 12
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 12
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 450
    and I_UnitDistanceFromPosition a2u13 0,0 < 500
    if I_CompareCounter a2u13_distance != 13
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 13
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 500
    and I_UnitDistanceFromPosition a2u13 0,0 < 550
    if I_CompareCounter a2u13_distance != 14
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 14
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 550
    and I_UnitDistanceFromPosition a2u13 0,0 < 600
    if I_CompareCounter a2u13_distance != 15
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 15
    inc_counter a2u13_stuck 1
    end_if

    if I_CompareCounter a2u13_stuck = 4
    unit_order_halt a2u13
    unit_set_morale a2u13 wavering
    battle_wait 0.1
    unit_unset_morale a2u13
    release_unit a2u13
    set_counter a2u13_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 13
and ! I_UnitDestroyed a2u14

    if I_UnitStatus a2u14 moving
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 1
    end_if
    if I_CompareCounter a2u14_status != 1
    set_counter a2u14_status 0
    end_if
    end_if

    if I_UnitStatus a2u14 routing
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 2
    end_if
    if I_CompareCounter a2u14_status != 2
    set_counter a2u14_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u14 moving
    and ! I_UnitStatus a2u14 routing
    set_counter a2u14_status 0
    end_if

    if I_CompareCounter a2u14_status > 0

    if I_UnitDistanceFromPosition a2u14 0,0 >= 150
    and I_UnitDistanceFromPosition a2u14 0,0 < 175
    if I_CompareCounter a2u14_distance != 1
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 1
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 175
    and I_UnitDistanceFromPosition a2u14 0,0 < 200
    if I_CompareCounter a2u14_distance != 2
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 2
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 200
    and I_UnitDistanceFromPosition a2u14 0,0 < 225
    if I_CompareCounter a2u14_distance != 3
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 3
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 225
    and I_UnitDistanceFromPosition a2u14 0,0 < 250
    if I_CompareCounter a2u14_distance != 4
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 4
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 250
    and I_UnitDistanceFromPosition a2u14 0,0 < 275
    if I_CompareCounter a2u14_distance != 5
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 5
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 275
    and I_UnitDistanceFromPosition a2u14 0,0 < 300
    if I_CompareCounter a2u14_distance != 6
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 6
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 300
    and I_UnitDistanceFromPosition a2u14 0,0 < 325
    if I_CompareCounter a2u14_distance != 7
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 7
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 325
    and I_UnitDistanceFromPosition a2u14 0,0 < 350
    if I_CompareCounter a2u14_distance != 8
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 8
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 350
    and I_UnitDistanceFromPosition a2u14 0,0 < 375
    if I_CompareCounter a2u14_distance != 9
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 9
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 375
    and I_UnitDistanceFromPosition a2u14 0,0 < 400
    if I_CompareCounter a2u14_distance != 10
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 10
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 400
    and I_UnitDistanceFromPosition a2u14 0,0 < 425
    if I_CompareCounter a2u14_distance != 11
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 11
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 425
    and I_UnitDistanceFromPosition a2u14 0,0 < 450
    if I_CompareCounter a2u14_distance != 12
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 12
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 450
    and I_UnitDistanceFromPosition a2u14 0,0 < 500
    if I_CompareCounter a2u14_distance != 13
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 13
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 500
    and I_UnitDistanceFromPosition a2u14 0,0 < 550
    if I_CompareCounter a2u14_distance != 14
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 14
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 550
    and I_UnitDistanceFromPosition a2u14 0,0 < 600
    if I_CompareCounter a2u14_distance != 15
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 15
    inc_counter a2u14_stuck 1
    end_if

    if I_CompareCounter a2u14_stuck = 4
    unit_order_halt a2u14
    unit_set_morale a2u14 wavering
    battle_wait 0.1
    unit_unset_morale a2u14
    release_unit a2u14
    set_counter a2u14_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 14
and ! I_UnitDestroyed a2u15

    if I_UnitStatus a2u15 moving
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 1
    end_if
    if I_CompareCounter a2u15_status != 1
    set_counter a2u15_status 0
    end_if
    end_if

    if I_UnitStatus a2u15 routing
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 2
    end_if
    if I_CompareCounter a2u15_status != 2
    set_counter a2u15_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u15 moving
    and ! I_UnitStatus a2u15 routing
    set_counter a2u15_status 0
    end_if

    if I_CompareCounter a2u15_status > 0

    if I_UnitDistanceFromPosition a2u15 0,0 >= 150
    and I_UnitDistanceFromPosition a2u15 0,0 < 175
    if I_CompareCounter a2u15_distance != 1
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 1
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 175
    and I_UnitDistanceFromPosition a2u15 0,0 < 200
    if I_CompareCounter a2u15_distance != 2
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 2
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 200
    and I_UnitDistanceFromPosition a2u15 0,0 < 225
    if I_CompareCounter a2u15_distance != 3
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 3
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 225
    and I_UnitDistanceFromPosition a2u15 0,0 < 250
    if I_CompareCounter a2u15_distance != 4
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 4
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 250
    and I_UnitDistanceFromPosition a2u15 0,0 < 275
    if I_CompareCounter a2u15_distance != 5
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 5
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 275
    and I_UnitDistanceFromPosition a2u15 0,0 < 300
    if I_CompareCounter a2u15_distance != 6
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 6
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 300
    and I_UnitDistanceFromPosition a2u15 0,0 < 325
    if I_CompareCounter a2u15_distance != 7
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 7
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 325
    and I_UnitDistanceFromPosition a2u15 0,0 < 350
    if I_CompareCounter a2u15_distance != 8
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 8
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 350
    and I_UnitDistanceFromPosition a2u15 0,0 < 375
    if I_CompareCounter a2u15_distance != 9
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 9
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 375
    and I_UnitDistanceFromPosition a2u15 0,0 < 400
    if I_CompareCounter a2u15_distance != 10
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 10
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 400
    and I_UnitDistanceFromPosition a2u15 0,0 < 425
    if I_CompareCounter a2u15_distance != 11
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 11
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 425
    and I_UnitDistanceFromPosition a2u15 0,0 < 450
    if I_CompareCounter a2u15_distance != 12
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 12
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 450
    and I_UnitDistanceFromPosition a2u15 0,0 < 500
    if I_CompareCounter a2u15_distance != 13
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 13
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 500
    and I_UnitDistanceFromPosition a2u15 0,0 < 550
    if I_CompareCounter a2u15_distance != 14
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 14
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 550
    and I_UnitDistanceFromPosition a2u15 0,0 < 600
    if I_CompareCounter a2u15_distance != 15
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 15
    inc_counter a2u15_stuck 1
    end_if

    if I_CompareCounter a2u15_stuck = 4
    unit_order_halt a2u15
    unit_set_morale a2u15 wavering
    battle_wait 0.1
    unit_unset_morale a2u15
    release_unit a2u15
    set_counter a2u15_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 15
and ! I_UnitDestroyed a2u16

    if I_UnitStatus a2u16 moving
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 1
    end_if
    if I_CompareCounter a2u16_status != 1
    set_counter a2u16_status 0
    end_if
    end_if

    if I_UnitStatus a2u16 routing
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 2
    end_if
    if I_CompareCounter a2u16_status != 2
    set_counter a2u16_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u16 moving
    and ! I_UnitStatus a2u16 routing
    set_counter a2u16_status 0
    end_if

    if I_CompareCounter a2u16_status > 0

    if I_UnitDistanceFromPosition a2u16 0,0 >= 150
    and I_UnitDistanceFromPosition a2u16 0,0 < 175
    if I_CompareCounter a2u16_distance != 1
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 1
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 175
    and I_UnitDistanceFromPosition a2u16 0,0 < 200
    if I_CompareCounter a2u16_distance != 2
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 2
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 200
    and I_UnitDistanceFromPosition a2u16 0,0 < 225
    if I_CompareCounter a2u16_distance != 3
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 3
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 225
    and I_UnitDistanceFromPosition a2u16 0,0 < 250
    if I_CompareCounter a2u16_distance != 4
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 4
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 250
    and I_UnitDistanceFromPosition a2u16 0,0 < 275
    if I_CompareCounter a2u16_distance != 5
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 5
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 275
    and I_UnitDistanceFromPosition a2u16 0,0 < 300
    if I_CompareCounter a2u16_distance != 6
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 6
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 300
    and I_UnitDistanceFromPosition a2u16 0,0 < 325
    if I_CompareCounter a2u16_distance != 7
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 7
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 325
    and I_UnitDistanceFromPosition a2u16 0,0 < 350
    if I_CompareCounter a2u16_distance != 8
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 8
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 350
    and I_UnitDistanceFromPosition a2u16 0,0 < 375
    if I_CompareCounter a2u16_distance != 9
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 9
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 375
    and I_UnitDistanceFromPosition a2u16 0,0 < 400
    if I_CompareCounter a2u16_distance != 10
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 10
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 400
    and I_UnitDistanceFromPosition a2u16 0,0 < 425
    if I_CompareCounter a2u16_distance != 11
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 11
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 425
    and I_UnitDistanceFromPosition a2u16 0,0 < 450
    if I_CompareCounter a2u16_distance != 12
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 12
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 450
    and I_UnitDistanceFromPosition a2u16 0,0 < 500
    if I_CompareCounter a2u16_distance != 13
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 13
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 500
    and I_UnitDistanceFromPosition a2u16 0,0 < 550
    if I_CompareCounter a2u16_distance != 14
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 14
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 550
    and I_UnitDistanceFromPosition a2u16 0,0 < 600
    if I_CompareCounter a2u16_distance != 15
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 15
    inc_counter a2u16_stuck 1
    end_if

    if I_CompareCounter a2u16_stuck = 4
    unit_order_halt a2u16
    unit_set_morale a2u16 wavering
    battle_wait 0.1
    unit_unset_morale a2u16
    release_unit a2u16
    set_counter a2u16_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 16
and ! I_UnitDestroyed a2u17

    if I_UnitStatus a2u17 moving
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 1
    end_if
    if I_CompareCounter a2u17_status != 1
    set_counter a2u17_status 0
    end_if
    end_if

    if I_UnitStatus a2u17 routing
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 2
    end_if
    if I_CompareCounter a2u17_status != 2
    set_counter a2u17_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u17 moving
    and ! I_UnitStatus a2u17 routing
    set_counter a2u17_status 0
    end_if

    if I_CompareCounter a2u17_status > 0

    if I_UnitDistanceFromPosition a2u17 0,0 >= 150
    and I_UnitDistanceFromPosition a2u17 0,0 < 175
    if I_CompareCounter a2u17_distance != 1
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 1
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 175
    and I_UnitDistanceFromPosition a2u17 0,0 < 200
    if I_CompareCounter a2u17_distance != 2
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 2
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 200
    and I_UnitDistanceFromPosition a2u17 0,0 < 225
    if I_CompareCounter a2u17_distance != 3
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 3
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 225
    and I_UnitDistanceFromPosition a2u17 0,0 < 250
    if I_CompareCounter a2u17_distance != 4
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 4
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 250
    and I_UnitDistanceFromPosition a2u17 0,0 < 275
    if I_CompareCounter a2u17_distance != 5
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 5
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 275
    and I_UnitDistanceFromPosition a2u17 0,0 < 300
    if I_CompareCounter a2u17_distance != 6
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 6
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 300
    and I_UnitDistanceFromPosition a2u17 0,0 < 325
    if I_CompareCounter a2u17_distance != 7
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 7
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 325
    and I_UnitDistanceFromPosition a2u17 0,0 < 350
    if I_CompareCounter a2u17_distance != 8
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 8
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 350
    and I_UnitDistanceFromPosition a2u17 0,0 < 375
    if I_CompareCounter a2u17_distance != 9
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 9
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 375
    and I_UnitDistanceFromPosition a2u17 0,0 < 400
    if I_CompareCounter a2u17_distance != 10
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 10
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 400
    and I_UnitDistanceFromPosition a2u17 0,0 < 425
    if I_CompareCounter a2u17_distance != 11
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 11
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 425
    and I_UnitDistanceFromPosition a2u17 0,0 < 450
    if I_CompareCounter a2u17_distance != 12
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 12
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 450
    and I_UnitDistanceFromPosition a2u17 0,0 < 500
    if I_CompareCounter a2u17_distance != 13
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 13
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 500
    and I_UnitDistanceFromPosition a2u17 0,0 < 550
    if I_CompareCounter a2u17_distance != 14
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 14
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 550
    and I_UnitDistanceFromPosition a2u17 0,0 < 600
    if I_CompareCounter a2u17_distance != 15
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 15
    inc_counter a2u17_stuck 1
    end_if

    if I_CompareCounter a2u17_stuck = 4
    unit_order_halt a2u17
    unit_set_morale a2u17 wavering
    battle_wait 0.1
    unit_unset_morale a2u17
    release_unit a2u17
    set_counter a2u17_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 17
and ! I_UnitDestroyed a2u18

    if I_UnitStatus a2u18 moving
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 1
    end_if
    if I_CompareCounter a2u18_status != 1
    set_counter a2u18_status 0
    end_if
    end_if

    if I_UnitStatus a2u18 routing
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 2
    end_if
    if I_CompareCounter a2u18_status != 2
    set_counter a2u18_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u18 moving
    and ! I_UnitStatus a2u18 routing
    set_counter a2u18_status 0
    end_if

    if I_CompareCounter a2u18_status > 0

    if I_UnitDistanceFromPosition a2u18 0,0 >= 150
    and I_UnitDistanceFromPosition a2u18 0,0 < 175
    if I_CompareCounter a2u18_distance != 1
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 1
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 175
    and I_UnitDistanceFromPosition a2u18 0,0 < 200
    if I_CompareCounter a2u18_distance != 2
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 2
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 200
    and I_UnitDistanceFromPosition a2u18 0,0 < 225
    if I_CompareCounter a2u18_distance != 3
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 3
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 225
    and I_UnitDistanceFromPosition a2u18 0,0 < 250
    if I_CompareCounter a2u18_distance != 4
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 4
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 250
    and I_UnitDistanceFromPosition a2u18 0,0 < 275
    if I_CompareCounter a2u18_distance != 5
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 5
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 275
    and I_UnitDistanceFromPosition a2u18 0,0 < 300
    if I_CompareCounter a2u18_distance != 6
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 6
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 300
    and I_UnitDistanceFromPosition a2u18 0,0 < 325
    if I_CompareCounter a2u18_distance != 7
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 7
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 325
    and I_UnitDistanceFromPosition a2u18 0,0 < 350
    if I_CompareCounter a2u18_distance != 8
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 8
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 350
    and I_UnitDistanceFromPosition a2u18 0,0 < 375
    if I_CompareCounter a2u18_distance != 9
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 9
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 375
    and I_UnitDistanceFromPosition a2u18 0,0 < 400
    if I_CompareCounter a2u18_distance != 10
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 10
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 400
    and I_UnitDistanceFromPosition a2u18 0,0 < 425
    if I_CompareCounter a2u18_distance != 11
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 11
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 425
    and I_UnitDistanceFromPosition a2u18 0,0 < 450
    if I_CompareCounter a2u18_distance != 12
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 12
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 450
    and I_UnitDistanceFromPosition a2u18 0,0 < 500
    if I_CompareCounter a2u18_distance != 13
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 13
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 500
    and I_UnitDistanceFromPosition a2u18 0,0 < 550
    if I_CompareCounter a2u18_distance != 14
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 14
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 550
    and I_UnitDistanceFromPosition a2u18 0,0 < 600
    if I_CompareCounter a2u18_distance != 15
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 15
    inc_counter a2u18_stuck 1
    end_if

    if I_CompareCounter a2u18_stuck = 4
    unit_order_halt a2u18
    unit_set_morale a2u18 wavering
    battle_wait 0.1
    unit_unset_morale a2u18
    release_unit a2u18
    set_counter a2u18_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 18
and ! I_UnitDestroyed a2u19

    if I_UnitStatus a2u19 moving
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 1
    end_if
    if I_CompareCounter a2u19_status != 1
    set_counter a2u19_status 0
    end_if
    end_if

    if I_UnitStatus a2u19 routing
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 2
    end_if
    if I_CompareCounter a2u19_status != 2
    set_counter a2u19_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u19 moving
    and ! I_UnitStatus a2u19 routing
    set_counter a2u19_status 0
    end_if

    if I_CompareCounter a2u19_status > 0

    if I_UnitDistanceFromPosition a2u19 0,0 >= 150
    and I_UnitDistanceFromPosition a2u19 0,0 < 175
    if I_CompareCounter a2u19_distance != 1
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 1
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 175
    and I_UnitDistanceFromPosition a2u19 0,0 < 200
    if I_CompareCounter a2u19_distance != 2
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 2
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 200
    and I_UnitDistanceFromPosition a2u19 0,0 < 225
    if I_CompareCounter a2u19_distance != 3
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 3
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 225
    and I_UnitDistanceFromPosition a2u19 0,0 < 250
    if I_CompareCounter a2u19_distance != 4
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 4
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 250
    and I_UnitDistanceFromPosition a2u19 0,0 < 275
    if I_CompareCounter a2u19_distance != 5
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 5
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 275
    and I_UnitDistanceFromPosition a2u19 0,0 < 300
    if I_CompareCounter a2u19_distance != 6
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 6
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 300
    and I_UnitDistanceFromPosition a2u19 0,0 < 325
    if I_CompareCounter a2u19_distance != 7
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 7
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 325
    and I_UnitDistanceFromPosition a2u19 0,0 < 350
    if I_CompareCounter a2u19_distance != 8
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 8
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 350
    and I_UnitDistanceFromPosition a2u19 0,0 < 375
    if I_CompareCounter a2u19_distance != 9
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 9
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 375
    and I_UnitDistanceFromPosition a2u19 0,0 < 400
    if I_CompareCounter a2u19_distance != 10
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 10
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 400
    and I_UnitDistanceFromPosition a2u19 0,0 < 425
    if I_CompareCounter a2u19_distance != 11
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 11
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 425
    and I_UnitDistanceFromPosition a2u19 0,0 < 450
    if I_CompareCounter a2u19_distance != 12
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 12
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 450
    and I_UnitDistanceFromPosition a2u19 0,0 < 500
    if I_CompareCounter a2u19_distance != 13
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 13
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 500
    and I_UnitDistanceFromPosition a2u19 0,0 < 550
    if I_CompareCounter a2u19_distance != 14
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 14
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 550
    and I_UnitDistanceFromPosition a2u19 0,0 < 600
    if I_CompareCounter a2u19_distance != 15
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 15
    inc_counter a2u19_stuck 1
    end_if

    if I_CompareCounter a2u19_stuck = 4
    unit_order_halt a2u19
    unit_set_morale a2u19 wavering
    battle_wait 0.1
    unit_unset_morale a2u19
    release_unit a2u19
    set_counter a2u19_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count = 20
and ! I_UnitDestroyed a2u20

    if I_UnitStatus a2u20 moving
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 1
    end_if
    if I_CompareCounter a2u20_status != 1
    set_counter a2u20_status 0
    end_if
    end_if

    if I_UnitStatus a2u20 routing
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 2
    end_if
    if I_CompareCounter a2u20_status != 2
    set_counter a2u20_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u20 moving
    and ! I_UnitStatus a2u20 routing
    set_counter a2u20_status 0
    end_if

    if I_CompareCounter a2u20_status > 0

    if I_UnitDistanceFromPosition a2u20 0,0 >= 150
    and I_UnitDistanceFromPosition a2u20 0,0 < 175
    if I_CompareCounter a2u20_distance != 1
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 1
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 175
    and I_UnitDistanceFromPosition a2u20 0,0 < 200
    if I_CompareCounter a2u20_distance != 2
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 2
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 200
    and I_UnitDistanceFromPosition a2u20 0,0 < 225
    if I_CompareCounter a2u20_distance != 3
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 3
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 225
    and I_UnitDistanceFromPosition a2u20 0,0 < 250
    if I_CompareCounter a2u20_distance != 4
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 4
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 250
    and I_UnitDistanceFromPosition a2u20 0,0 < 275
    if I_CompareCounter a2u20_distance != 5
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 5
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 275
    and I_UnitDistanceFromPosition a2u20 0,0 < 300
    if I_CompareCounter a2u20_distance != 6
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 6
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 300
    and I_UnitDistanceFromPosition a2u20 0,0 < 325
    if I_CompareCounter a2u20_distance != 7
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 7
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 325
    and I_UnitDistanceFromPosition a2u20 0,0 < 350
    if I_CompareCounter a2u20_distance != 8
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 8
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 350
    and I_UnitDistanceFromPosition a2u20 0,0 < 375
    if I_CompareCounter a2u20_distance != 9
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 9
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 375
    and I_UnitDistanceFromPosition a2u20 0,0 < 400
    if I_CompareCounter a2u20_distance != 10
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 10
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 400
    and I_UnitDistanceFromPosition a2u20 0,0 < 425
    if I_CompareCounter a2u20_distance != 11
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 11
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 425
    and I_UnitDistanceFromPosition a2u20 0,0 < 450
    if I_CompareCounter a2u20_distance != 12
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 12
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 450
    and I_UnitDistanceFromPosition a2u20 0,0 < 500
    if I_CompareCounter a2u20_distance != 13
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 13
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 500
    and I_UnitDistanceFromPosition a2u20 0,0 < 550
    if I_CompareCounter a2u20_distance != 14
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 14
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 550
    and I_UnitDistanceFromPosition a2u20 0,0 < 600
    if I_CompareCounter a2u20_distance != 15
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 15
    inc_counter a2u20_stuck 1
    end_if

    if I_CompareCounter a2u20_stuck = 4
    unit_order_halt a2u20
    unit_set_morale a2u20 wavering
    battle_wait 0.1
    unit_unset_morale a2u20
    release_unit a2u20
    set_counter a2u20_stuck 0
    end_if

    end_if
end_if

    battle_wait 10
end_monitor

;;;;;;;Anti-CTD
monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    wait 0.5
    simulate_mouse_click lclick_down
    simulate_mouse_click lclick_up
end_monitor

;################## Cleaning up ##################

monitor_event ScrollOpened ScrollOpened post_battle_scroll

    ;;;;;;;
    set_counter fire_labels 0
;    set_counter panel_check 0
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
;    suspend_unscripted_advice false
end_monitor

;=======================================================;
;================= ADDITIONAL SCRIPTS ==================;
;=======================================================;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
wait_monitors
end_script